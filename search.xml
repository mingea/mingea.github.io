<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>食分速递项目</title>
      <link href="/2025/01/03/%E9%A3%9F%E5%88%86%E9%80%9F%E9%80%92%E9%A1%B9%E7%9B%AE/"/>
      <url>/2025/01/03/%E9%A3%9F%E5%88%86%E9%80%9F%E9%80%92%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="一-环境搭建"><a href="#一-环境搭建" class="headerlink" title="一 环境搭建"></a>一 环境搭建</h2><p><img src="4.png"></p><h3 id="1-前端环境搭建"><a href="#1-前端环境搭建" class="headerlink" title="1.前端环境搭建"></a>1.前端环境搭建</h3><p><strong>前端工程基于 nginx 运行</strong></p><h4 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h4><p>在nginx安装的文件夹内，双击 nginx.exe 即可启动 nginx 服务，访问端口号为 80</p><h4 id="什么是nginx？"><a href="#什么是nginx？" class="headerlink" title="什么是nginx？"></a>什么是nginx？</h4><p>nginx 反向代理，就是将前端发送的<strong>动态请求</strong>由 nginx 转发到<strong>后端服务器</strong></p><ul><li><strong>位置</strong>：运行在你的<strong>服务器</strong>上。</li><li><strong>职责</strong>：<strong>接收、调度、分发</strong>请求。它是请求到达服务器后遇到的第一个“门卫”和“调度员”。它不处理核心业务逻辑（比如计算订单金额），但它决定把这个请求交给谁去处理，或者直接自己处理（比如直接返回一个图片文件）。</li></ul><h4 id="nginx-反向代理的好处"><a href="#nginx-反向代理的好处" class="headerlink" title="nginx 反向代理的好处"></a>nginx 反向代理的好处</h4><p>•提高访问速度</p><p>•进行负载均衡</p><p>•保证后端服务安全</p><p>所谓<strong>负载均衡</strong>,就是把大量的请求按照我们指定的方式均衡的分配给集群中的每台服务器</p><img src="5.png" style="zoom: 50%;"><h4 id="nginx-反向代理的配置方式"><a href="#nginx-反向代理的配置方式" class="headerlink" title="nginx 反向代理的配置方式"></a>nginx 反向代理的配置方式</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">listen <span class="number">80</span>;</span><br><span class="line">server_name localhost;</span><br><span class="line"></span><br><span class="line">location /api/ &#123;</span><br><span class="line">            proxy_pass   http:<span class="comment">//localhost:8080/admin/;  #反向代理</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**listen 80;**监听80端口</p><p><strong>逐行详解</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br></pre></td></tr></table></figure><ul><li><strong>定义一个虚拟服务器</strong>：Nginx 可以同时托管多个网站（虚拟主机），每个 <code>server {}</code> 块就是一个网站的配置。</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">listen 80;</span><br></pre></td></tr></table></figure><ul><li><strong>监听端口</strong>：这个虚拟服务器会监听来自 <strong>80 端口</strong> 的 HTTP 请求（80 是 HTTP 协议的默认端口）。</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server_name localhost;</span><br></pre></td></tr></table></figure><ul><li><strong>服务器名称</strong>：这个虚拟服务器对应的域名是 <code>localhost</code>。当你在浏览器里访问 <code>http://localhost</code> 时，就会由这个 server 块来处理。</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location /api/ &#123;</span><br></pre></td></tr></table></figure><ul><li><strong>位置块</strong>：这是最核心的配置。它定义了一个 <strong>URL 路径匹配规则</strong>。所有以 <code>/api/</code> 开头的请求（例如 <code>http://localhost/api/employee/login</code>），都会进入这个 <code>location</code> 块内的逻辑。</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxy_pass http://localhost:8080/admin/;</span><br></pre></td></tr></table></figure><ul><li><strong>反向代理指令</strong>：这是实现转发的关键命令。<ul><li>它告诉 Nginx，对于匹配到的请求，不要自己处理，而是将其 <strong>转发（代理）</strong> 到指定的地址。</li><li><code>http://localhost:8080/admin/</code> 是 <strong>目标地址</strong>。</li></ul></li></ul><img src="6.png" style="zoom:80%;"><h4 id="nginx-负载均衡的配置方式"><a href="#nginx-负载均衡的配置方式" class="headerlink" title="nginx 负载均衡的配置方式"></a>nginx 负载均衡的配置方式</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">upstream webservers&#123;</span><br><span class="line">server <span class="number">192.168</span><span class="number">.100</span><span class="number">.128</span>:<span class="number">8080</span>;</span><br><span class="line">server <span class="number">192.168</span><span class="number">.100</span><span class="number">.129</span>:<span class="number">8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">listen <span class="number">80</span>;</span><br><span class="line">server_name localhost;</span><br><span class="line"></span><br><span class="line">location /api/ &#123;</span><br><span class="line">            proxy_pass   http:<span class="comment">//webservers/admin/;  #负载均衡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>1. <code>upstream</code> 块 - 定义服务器池（后端集群）</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">upstream webservers &#123;</span><br><span class="line">    server 192.168.100.128:8080;</span><br><span class="line">    server 192.168.100.129:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong><code>upstream webservers {}</code></strong>：定义一个名为 <code>webservers</code> 的上游服务器组（也叫集群或服务器池）。</li><li><strong><code>server 192.168.100.128:8080;</code></strong>：在池中添加第一台后端服务器，IP 是 <code>192.168.100.128</code>，端口是 <code>8080</code>。</li><li><strong><code>server 192.168.100.129:8080;</code></strong>：在池中添加第二台后端服务器，IP 是 <code>192.168.100.129</code>，端口是 <code>8080</code>。</li></ul><p><strong>Nginx 默认的负载均衡策略是轮询</strong>，也就是说，第一个请求发给 128，第二个请求发给 129，第三个又发给 128，以此类推。</p><p><strong>2. <code>location</code> 块 - 流量分发</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location /api/ &#123;</span><br><span class="line">    proxy_pass http://webservers/admin/;  #负载均衡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>关键变化在这里：<code>proxy_pass</code> 的目标不再是单一的服务器地址，而是指向了我们定义的 upstream 池 <code>http://webservers</code>。</li><li>这意味着，所有匹配到的请求都会被分发到 <code>webservers</code> 池中的服务器上。</li></ul><p><img src="7.png"></p><h3 id="2-后端环境搭建"><a href="#2-后端环境搭建" class="headerlink" title="2.后端环境搭建"></a>2.后端环境搭建</h3><h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><p>后端工程基于 maven 进行项目构建，并且进行分模块开发</p><p><img src="8.png"></p><p><img src="9.png"></p><p><strong>sky-common</strong> 子模块中存放的是一些公共类，可以供其他模块使用</p><p><strong>sky-pojo</strong> 子模块中存放的是一些 entity、DTO、VO</p><img src="10.png" style="zoom: 67%;"><p><strong>sky-server</strong> 子模块中存放的是 配置文件、配置类、拦截器、controller、service、mapper、启动类等</p><h4 id="使用Git进行版本控制"><a href="#使用Git进行版本控制" class="headerlink" title="使用Git进行版本控制"></a>使用Git进行版本控制</h4><p>.gitingore文件是git的相关文件，目的是忽略推送到服务器的文件或文件夹</p><p><img src="11.png"></p><p>还没有被git版本控制的项目可以在idea配置，具体操作是上方操作菜单点击VSC，点击创建git仓库，最后在弹出窗中选择项目</p><img src="12.png" style="zoom:50%;"><p>之后就可以测试提交，注意第一次提交会提交到本地仓库</p><p>推送就是要推送到远程仓库，第一次会提示你配置远程仓库信息</p><p><strong>核心概念总结</strong></p><table><thead><tr><th align="left">动作</th><th align="left">作用域</th><th align="left">描述</th><th align="left">影响</th><th align="left">类比</th></tr></thead><tbody><tr><td align="left"><strong><code>commit</code></strong></td><td align="left"><strong>本地</strong></td><td align="left">将<strong>暂存区</strong>的快照永久记录到<strong>本地仓库</strong>的历史中。</td><td align="left">只更新你自己电脑上的 Git 仓库。团队其他成员看不到你的这次提交。</td><td align="left"><strong>保存到本地硬盘</strong></td></tr><tr><td align="left"><strong><code>push</code></strong></td><td align="left"><strong>本地 → 远程</strong></td><td align="left">将<strong>本地仓库</strong>中的新提交记录上传到<strong>远程仓库</strong>（如 GitHub, Gitee）。</td><td align="left">更新共享的远程仓库，团队其他成员可以通过 <code>pull</code> 获取你的更新。</td><td align="left"><strong>上传到网盘&#x2F;服务器</strong></td></tr></tbody></table><p><strong>工作流程图示</strong></p><p>一个标准的 Git 协作流程如下：</p><p><strong>你的电脑</strong><br><code>工作区</code> –(<code>git add</code>)–&gt; <code>暂存区</code> –(<code>git commit</code>)–&gt; <code>本地仓库</code> –(<code>git push</code>)–&gt; <strong>远程仓库</strong></p><p><strong>同事的电脑拉远程仓库代码</strong><br><strong>远程仓库</strong> –(<code>git fetch</code>)–&gt; <strong>本地仓库</strong> –(<code>git checkout</code>)–&gt; <strong>工作区</strong></p><ul><li><strong>合并（Merge）</strong>：<strong>“邀请别人的成果加入我的版本”</strong><ul><li>操作：我站在原地不动，把别人完成的新内容<strong>拉过来</strong>，和我当前的内容<strong>融合</strong>在一起。如果内容有重叠（冲突），我需要手动调解。</li><li>结果：历史记录会留下一次“合并”的痕迹，标明两条线在这里汇合了。</li></ul></li><li><strong>变基（Rebase）</strong>：<strong>“把我的工作挪到最新的成果之上”</strong><ul><li>操作：我先把我的工作暂时<strong>放到一边</strong>，然后<strong>把别人的新成果作为新的基础</strong>，最后我再把我的工作<strong>重新实施</strong>在这个崭新的、最新的基础之上。</li><li>结果：历史记录看起来就像是我从一开始就是在最新的代码基础上进行工作的，一条直线，非常整洁。</li></ul></li></ul><p><strong>比喻</strong></p><p><strong>合并</strong>：你正在拼A部分，同事拼好了B部分。你直接把同事拼好的B部分拿过来，和你的A部分对接在一起。如果对接不上（冲突），你就需要调整一下接口。</p><p><strong>变基</strong>：你发现同事不仅拼好了B部分，还把你们共同的底座C也升级了。于是，你先把你的A部分拆下来，把升级后的新底座C换上去，然后再把你的A部分重新拼到新底座C上。</p><h3 id="3-swagger接口文档"><a href="#3-swagger接口文档" class="headerlink" title="3.swagger接口文档"></a>3.swagger接口文档</h3><h4 id="Knife4j使用方式"><a href="#Knife4j使用方式" class="headerlink" title="Knife4j使用方式"></a>Knife4j使用方式</h4><p><a href="https://doc.xiaominfo.com/">K</a><a href="https://doc.xiaominfo.com/">nife4j</a><a href="https://doc.xiaominfo.com/"> </a>是为Java MVC框架集成Swagger生成Api文档的增强解决方案</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>WebMvcConfiguration</strong>文件配置</p><p>1.在配置类中加入 knife4j 相关配置</p><p>2.设置静态资源映射，否则接口文档页面无法访问</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置类，注册web层相关组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenAdminInterceptor jwtTokenAdminInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册自定义拦截器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;开始注册自定义拦截器...&quot;</span>);</span><br><span class="line">        registry.addInterceptor(jwtTokenAdminInterceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/admin/employee/login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过knife4j生成接口文档</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> docket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置静态资源映射</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/doc.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h4><table><thead><tr><th><strong>注解</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>@Api</td><td>用在类上，例如Controller，表示对类的说明</td></tr><tr><td>@ApiModel</td><td>用在类上，例如entity、DTO、VO</td></tr><tr><td>@ApiModelProperty</td><td>用在属性上，描述属性信息</td></tr><tr><td>@ApiOperation</td><td>用在方法上，例如Controller的方法，说明方法的用途、作用</td></tr></tbody></table><h2 id="二-后台管理模块开发"><a href="#二-后台管理模块开发" class="headerlink" title="二 后台管理模块开发"></a>二 后台管理模块开发</h2><h3 id="员工管理"><a href="#员工管理" class="headerlink" title="员工管理"></a>员工管理</h3><h4 id="1-新增员工"><a href="#1-新增员工" class="headerlink" title="1.新增员工"></a>1.新增员工</h4><p><strong>业务代码</strong></p><p><strong>注意</strong>：当前端提交的数据和实体类中对应的属性差别较大时（也就是实体类中会有多余的属性），建议使用DTO来封装（DTO里的数据字段和前端提交的数据字段都能对应上）。</p><p>在EmployeeController中新建一个方法save，传入的参数是employeeDTO</p><ol><li>首先编写如下代码，是网页端读入的字段数据，在这里传入employeeService对象。有2点注意事项：①前端传入的数据是json格式，要用@RequestBody注解转换为对象。②为了方便调试加一个log.info，花括号{}的内容在后面会被替换为employeeDTO的值。</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span><span class="comment">//post方式请求</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;新增员工&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123; </span><br><span class="line">      log.info(<span class="string">&quot;新增员工：&#123;&#125;&quot;</span>,employeeDTO);</span><br><span class="line">      employeeService.save(employeeDTO);</span><br><span class="line">      <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在EmployeeService中编写如下代码，思路是：先创建一个emloyee实体类，然后把DTO的数据拷贝到实体类中，然后对剩下的属性进行赋值。</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(EmployeeDTO employeeDTO)</span>&#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">    BeanUtils.copyProperties(employeeDTO,employee);<span class="comment">//对象属性拷贝</span></span><br><span class="line">    employee.setStatus(StatusConstant.ENABLE);</span><br><span class="line">    employee.setPassword(DigestUtils.md5DigestAsHex(PasswordConstant.DEFAULT_PASSWORD.getBytes()));</span><br><span class="line">    employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">    employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    employee.setCreateUser(<span class="number">10L</span>); <span class="comment">//TODO 后续需要改为当前登录用户的id</span></span><br><span class="line">    employee.setUpdateUser(<span class="number">10L</span>);</span><br><span class="line">    employeeMapper.insert(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有2个注意事项：①可以用BeanUtils工具类中的copyProperties方法来对对象进行拷贝，前提是对象的属性有一部分是相同的。②不应该直接用数字数字，否则会是硬编码，应该使用StatusConstant常量类。 </p><ol start="3"><li>在EmployeeMapper中编写SQL语句，来将数据插入数据库：</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into employee(name,username,password,phone,sex,id_number,status,create_time,update_time,create_user,update_user)&quot;+</span></span><br><span class="line"><span class="meta">    &quot;values&quot;+</span></span><br><span class="line"><span class="meta">    &quot;(#(name),#(username),#(password),#(phone),#(sex),#(idNumber),#(status),#(createTime),#(updateTime),#(createUser),#(updateUser))&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><p>为了使java属性字段对应数据库字段，这里需要开启Mybatis的驼峰命名，需要在配置文件application.yml文件中进行配置</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="comment">#mapper配置文件</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.sky.entity</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#开启驼峰命名</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><strong>问题一</strong></p><p>在开发阶段，前端界面可能没有开发好，所以不能进行前后端联调测试，只能用接口文档进行测试。</p><p>下面进行测试出现401，是因为有拦截器进行了拦截，原因是缺少token令牌：</p><p><img src="13.png"></p><p>所以我们先在员工登录页面获取一个令牌：</p><p><img src="14.png"></p><p>全局参数设置-输入参数名称+参数值，然后关闭页面：</p><p><img src="15.png"></p><p>然后带着参数值发送：</p><p><img src="16.png"></p><p>最后可以在数据库查看已经新增成功</p><p>问题二</p><p>录入的用户名已存在，抛出异常后没有处理，没处理的话，控制台会抛出错误P19。（因为在数据库里面设计的用户名字段是唯一）</p><p>用全局的异常处理器sky-server&#x2F;handler&#x2F;GlobalExceptionHandler，创建exceptionHandler方法，在方法里添加如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> ex.getMessage();</span><br><span class="line">        <span class="keyword">if</span>(message.contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">            String[] split = message.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> split[<span class="number">2</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> username + MessageConstant.ALREADY_EXISTS;</span><br><span class="line">            <span class="keyword">return</span> Result.error(msg);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.error(MessageConstant.UNKNOWN_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>目的是输出：xxx已经存在的提示。核心思想是：提取错误那段话的第3个词，然后拼接后输出。</p><p>效果如图：</p><p><img src="17.png"></p><p><strong>问题三</strong></p><p>新增员工时，创建人id和修改人id设置为了固定值P20。程序中将创建者和更新者的id写死为10：</p><p><img src="18.png"></p><p><strong>JWT认证机制</strong>：用户发起请求发送用户名和密码，后端进行校验，如果验证通过就生成JWT Token，将Token返回给客户端，客户端会保存Token，在后续请求的请求头中都会携带JWT Token，请求会被拦截器拦截到，会检查Token，如果通过就会展示数据，如果没有通过就会返回错误信息。</p><p><img src="19.png"></p><p>在拦截请求验证的时候可以获得JWT令牌</p><p>问题是：在解析出登录员工id后如何传递给Service的save方法？</p><p>答：通过ThreadLocal，它是Thread的局部变量，为每个线程提供单独一份的存储空间，具有线程隔离的效果，只有在线程内才能获取到对应的值，在线程外则不能访问。</p><p>可以通过在controller、service和拦截器中输出线程的id来看是否单次请求是同一个线程，经实验验证是同一个线程。 </p><p><code>System.out.println(&quot;当前线程的id:&quot;+Thread.currentThread().getId());</code></p><p><img src="20.png"></p><p>在sky-common&#x2F;src&#x2F;main&#x2F;java&#x2F;context&#x2F;BaseContext下封装了ThreadLocal的操作。 </p><p>先在拦截器JwtTokenAdminInterceptor里将ID存到存储空间里（set），因为每次请求线程不变，所以存储空间的值不会被更改，因此可以在EmployeeServiceImpl类中取到该值（get），进而输出，很妙！</p><p><img src="21.png"></p><h4 id="2-分页查询"><a href="#2-分页查询" class="headerlink" title="2.分页查询"></a>2.分页查询</h4><p>下面是PageResult和EmployeePageQueryDTO的实体类定义：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装分页查询结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> total; <span class="comment">//总记录数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List records; <span class="comment">//当前页数据集合</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeePageQueryDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//员工姓名</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//页码</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> page;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//每页显示记录数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pageSize;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在EmployeeService接口中编写方法：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">PageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><p>在EmployeeServiceImpl中实现方法：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">PageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span> &#123; <span class="comment">//DTO已将页码和每页记录数传入，因此可以算出</span></span><br><span class="line">        <span class="comment">// select * from employee limit 0,10，通过Limit来控制</span></span><br><span class="line">    PageHelper.startPage(employeePageQueryDTO.getPage(),employeePageQueryDTO.getPageSize()); <span class="comment">//页码和每页记录数传入</span></span><br><span class="line">        <span class="comment">//Page是固定的，Employee是每个用户的信息</span></span><br><span class="line">        Page&lt;Employee&gt; page = employeeMapper.pageQuery(employeePageQueryDTO);<span class="comment">//</span></span><br><span class="line">        <span class="comment">//要将page对象处理为PageResult对象</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> page.getTotal();</span><br><span class="line">        List&lt;Employee&gt; result = page.getResult();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total,result);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>PageHelper的startPage方法可以通过传入的参数自动设置Limit，传入的是页码和每页的记录数，好处是：字符串的拼接不用自己做。底层实现是：它会给ThreadLocal设置上述参数，然后在执行SQL语句时会自动被取出，然后拼接成Limit。</p><p>Page是PageHelper插件定义的一个泛型类，是一个固定的返回类型。</p><p>pagehelper可以简化分页代码的编写：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;pagehelper&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在EmployeeMapper中编写方法：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Page&lt;Employee&gt; <span class="title function_">pageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><p>在application.yml配置文件中扫描了EmployeeMapper.xml配置文件：</p><p><img src="23.png"></p><p>在EmployeeMapper.xml中编写SQL语句，limit不用我们手写，pagehelper会自动帮我们追加拼接，order by是排序条件：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">        select * from employee</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by create_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在这里是模糊查询，用concat将name与%进行拼接，%的意思是匹配任意字符串&#x2F;字符。</p><p>标签的id是mapper中的对应方法名。resultType是传入的参数类型。</p><p><strong>代码完善，解决时间显示问题</strong></p><p>方法一：在Employee实体类中的LocalDateTime属性上加上@JsonFormat注解，格式化时间。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime updateTime;</span><br></pre></td></tr></table></figure><p>方法二：拓展Spring MVC的消息转换器，统一对后端返回给前端的数据进行转换处理：（推荐）</p><p>在sky-server下的com&#x2F;sky&#x2F;config&#x2F;WebMvcConfiguration下创建：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//托转Spring MVC框架的消息转换器</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        <span class="comment">//先创建一个消息转换器对象</span></span><br><span class="line">        <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">converter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">        <span class="comment">//为消息转换器设置一个对象转换器，对象转换器可以将Java对象序列化为json数据</span></span><br><span class="line">        converter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line">        <span class="comment">//消息转换器还没交给框架，需要把消息转换器加到容器里</span></span><br><span class="line">        converters.add(<span class="number">0</span>,converter); <span class="comment">//容器自带消息转换器，默认新加的排在末尾，0表示是首位，自己加的消息转换器排在首位</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>在JacksonObjectMapper里面有关于日期时间的序列化和反序列化器。</p><h4 id="3-启禁账号"><a href="#3-启禁账号" class="headerlink" title="3.启禁账号"></a>3.启禁账号</h4><p>{status}是路径参数，1为启用，0为禁用。地址栏传参传入员工id。</p><p>操作：传入status和id，将某一id的status从0改为1或从1改为0。</p><p>在EmployeeController中编写如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;启用禁用员工账号&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status,Long id)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;启用禁用员工账号：&#123;&#125;,&#123;&#125;&quot;</span>,status,id);</span><br><span class="line">        employeeService.startOrStop(status,id);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>取的是路径参数，加注解@PathVariable，如果和路径参数不同名，就要加括号双引号指明取的是哪个路径参数@PathVariable(“status”) ；如果同名，就不用加。</p><p>在EmployeeService接口中编入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//启用禁用员工账号</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span>;</span><br></pre></td></tr></table></figure><p>在EmployeeServiceImpl类中写入如下代码，注意下面的第2种书写方式：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//update employee set status = ? where id = ?</span></span><br><span class="line">       <span class="comment">/* Employee employee = new Employee();</span></span><br><span class="line"><span class="comment">        employee.setStatus(status);</span></span><br><span class="line"><span class="comment">        employee.setId(id); */</span></span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> Employee.builder()</span><br><span class="line">                .status(status)</span><br><span class="line">                .id(id)</span><br><span class="line">                .build();</span><br><span class="line">        employeeMapper.update(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在EmployeeMapper中写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><p>在EmployeeMapper.xml中写入如下代码，下面这个代码对全字段都可以进行修改，所以不仅仅适用于对status的修改：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;/select&gt;</span><br><span class="line">    &lt;update id=<span class="string">&quot;update&quot;</span> parameterType=<span class="string">&quot;Employee&quot;</span>&gt;</span><br><span class="line">        update employee</span><br><span class="line">        &lt;set&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;name != null&quot;</span>&gt; name = #&#123;name&#125;,&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;username != null&quot;</span>&gt; username = #&#123;username&#125;,&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;password != null&quot;</span>&gt; password = #&#123;password&#125;,&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;phone != null&quot;</span>&gt; phone = #&#123;phone&#125;,&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;sex != null&quot;</span>&gt; sex = #&#123;sex&#125;,&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;idNumber != null&quot;</span>&gt; id_Number = #&#123;idNumber&#125;,&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;updateTime != null&quot;</span>&gt; update_Time = #&#123;updateTime&#125;,&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;updateUser != null&quot;</span>&gt; update_User = #&#123;updateUser&#125;,&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt; status = #&#123;status&#125;,&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/set&gt;</span><br><span class="line">        <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line">    &lt;/update&gt;</span><br></pre></td></tr></table></figure><h4 id="4-编辑员工"><a href="#4-编辑员工" class="headerlink" title="4.编辑员工"></a>4.编辑员工</h4><p>①回显数据操作：用查询语句把Employee对象查出来，然后显示。</p><p>EmployeeController编写如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据id查询员工信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Employee&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EmployeeService接口编写如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id查询员工</span></span><br><span class="line">Employee <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p>EmployeeServiceImpl实现类编写如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Employee <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeMapper.getById(id);</span><br><span class="line">        employee.setPassword(<span class="string">&quot;****&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> employee;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>EmployeeMapper中编写如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id查询员工信息</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from employee where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">Employee <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p>②接收提交的数据：调用之前mapper的update方法进行更新。</p><p>EmployeeController编写如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;编辑员工信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123;</span><br><span class="line">     log.info(<span class="string">&quot;编辑员工信息：&#123;&#125;&quot;</span>,employeeDTO);</span><br><span class="line">     employeeService.update(employeeDTO);</span><br><span class="line">     <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EmployeeService接口编写如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//编辑员工信息</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(EmployeeDTO employeeDTO)</span>;</span><br></pre></td></tr></table></figure><p>EmployeeServiceImpl实现类编写如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">    BeanUtils.copyProperties(employeeDTO,employee); <span class="comment">//属性拷贝</span></span><br><span class="line">    employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    employee.setUpdateUser(BaseContext.getCurrentId());</span><br><span class="line">    employeeMapper.update(employee); <span class="comment">//需要传入Employee参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EmployeeMapper中编写如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><h4 id="5-字段填充"><a href="#5-字段填充" class="headerlink" title="5.字段填充"></a>5.字段填充</h4><p>在多个业务表中都有公共字段，如create_time、create_user（insert时用到）；update_time，update_user（insert和update时用到）这些。</p><p>插入数据的时候需要为这些字段赋值，会有大量重复的冗余set方法代码，后期如果表结构发生变化，代码需要跟着修改，此时就不方便修改（如果后期进行修改要重复一个个进行修改）。</p><table><thead><tr><th><strong>序号</strong></th><th><strong>字段名</strong></th><th><strong>含义</strong></th><th><strong>数据类型</strong></th><th><strong>操作类型</strong></th></tr></thead><tbody><tr><td>1</td><td>create_time</td><td>创建时间</td><td>datetime</td><td>insert</td></tr><tr><td>2</td><td>create_user</td><td>创建人id</td><td>bigint</td><td>insert</td></tr><tr><td>3</td><td>update_time</td><td>修改时间</td><td>datetime</td><td>insert、update</td></tr><tr><td>4</td><td>update_user</td><td>修改人id</td><td>bigint</td><td>insert、update</td></tr></tbody></table><p>实现思路：自定义注解AutoFill，用于标识需要进行公共字段自动填充的方法。然后自定义切面类AutoFillAspect，统一拦截加入了AutoFill注解的方法，通过反射为公共字段赋值。在Mapper的方法上加入AutoFill注解。</p><p>技术点：枚举，注解，AOP，反射。</p><p>在com.sky下创建annotation包，创造一个AutoFill的Annotation注解。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//自定义注解，用于标识某个方法需要进行功能字段自动填充处理</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoFill &#123;</span><br><span class="line">    <span class="comment">//数据库操作类型：UPDATE INSERT</span></span><br><span class="line">    OperationType <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Target注解指定加上什么上面，Retention注解指定什么时候用，</p><p>在com.sky下创建aspect包，创建类AutoFillAspect，写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//自定义切面，实现公共字段自动填充处理逻辑</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoFillAspect</span> &#123;</span><br><span class="line">    <span class="comment">//切入点</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&quot;)</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFillPointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="comment">//前置通知，在通知中进行公共字段的赋值</span></span><br><span class="line">    <span class="meta">@Before(&quot;autoFillPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFill</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;开始进行公共字段自动填充...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>切入点：对哪些类的哪些方法进行拦截。@Pointcut里面写的是对哪些方法进行拦截，要满足2点：①必须是mapper下的所有类的方法，②还要有AutoFill这个注解。</p><p>通知：前置通知，后置通知，环绕通知，异常通知。</p><p>然后在sky-server下的mapper中的EmployeeMapper类里，insert上加入@AutoFill(value&#x3D; OperationType.INSERT)注解，update上加入@AutoFill(value&#x3D; OperationType.UPDATE)注解。</p><p>在sky-server的com.sky下的aspect的AutoFillAspect里的log.info(“开始进行公共字段自动填充…”);下添加如下代码：</p><p>1.获取到当前被拦截的方法上的数据库操作类型（比如是Insert还是Update，不同的类型需要给不同的参数赋值）</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();<span class="comment">//通过连接点对象来获取签名，向下转型为MethodSignature</span></span><br><span class="line"><span class="type">AutoFill</span> <span class="variable">autoFill</span> <span class="operator">=</span> signature.getMethod().getAnnotation(AutoFill.class);<span class="comment">//获得方法上的注解对象</span></span><br><span class="line"><span class="type">OperationType</span> <span class="variable">operationType</span> <span class="operator">=</span> autoFill.value();<span class="comment">//获得数据库操作类型（Insert or Update）</span></span><br></pre></td></tr></table></figure><p>2.获取到当前被拦截的方法的参数–实体对象（比如传入的参数是员工还是菜品还是其它的）</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object[] args = joinPoint.getArgs(); <span class="comment">//获得了方法所有的参数</span></span><br><span class="line"><span class="keyword">if</span>(args == <span class="literal">null</span> || args.length==<span class="number">0</span> )&#123; <span class="comment">//没有参数</span></span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Object</span> <span class="variable">entity</span> <span class="operator">=</span> args[<span class="number">0</span>];<span class="comment">//现在约定实体放在第1个位置,传入实体可能不同所以用Object</span></span><br></pre></td></tr></table></figure><p>3.准备赋值的数据（给公共字段赋值的数据，比如时间就是系统时间，用户ID是从ThreadLocal获取）</p><p>4.根据当前不同的操作类型，为对应的属性通过反射来赋值</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line"><span class="type">Long</span> <span class="variable">currentId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line"><span class="keyword">if</span>(operationType == OperationType.INSERT)&#123;</span><br><span class="line">    <span class="comment">//为4个公共字段赋值</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">setCreateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME, LocalDateTime.class); <span class="comment">//把方法名全部换成常量类，防止写错</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">setCreateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_USER, Long.class);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">setUpdateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME, LocalDateTime.class);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">setUpdateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER, Long.class);</span><br><span class="line">        <span class="comment">//4.根据当前不同的操作类型，为对应的属性通过反射来赋值</span></span><br><span class="line">        setCreateTime.invoke(entity,now);</span><br><span class="line">        setCreateUser.invoke(entity,currentId);</span><br><span class="line">        setUpdateTime.invoke(entity,now);</span><br><span class="line">        setUpdateUser.invoke(entity,currentId);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(operationType == OperationType.UPDATE)&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//为2个公共字段赋值</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">setUpdateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME, LocalDateTime.class);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">setUpdateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER, Long.class);</span><br><span class="line">        <span class="comment">//4.根据当前不同的操作类型，为对应的属性通过反射来赋值</span></span><br><span class="line">        setUpdateTime.invoke(entity, now);</span><br><span class="line">        setUpdateUser.invoke(entity, currentId);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后要在mapper层的CategoryMapper和EmployeeMapper中的Insert和Update方法上加上@AutoFill注解，注解内容用OperationType.INSERT或OperationType.Update。</p><p>最后把service层的那些手动赋值删除掉或者注释掉。</p><h3 id="菜品管理"><a href="#菜品管理" class="headerlink" title="菜品管理"></a>菜品管理</h3><h4 id="1-新增菜品"><a href="#1-新增菜品" class="headerlink" title="1.新增菜品"></a>1.新增菜品</h4><p>在controller下创建一个CommonController，写入如下代码</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/common&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;通用接口&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;sky.upload.local&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String uploadPath;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;文件上传&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;文件上传：&#123;&#125;&quot;</span>, file);</span><br><span class="line">        <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;上传文件不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 处理相对路径</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">absolutePath</span> <span class="operator">=</span> Paths.get(uploadPath).toAbsolutePath().toString();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建目录</span></span><br><span class="line">            <span class="type">File</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(absolutePath);</span><br><span class="line">            <span class="keyword">if</span> (!directory.exists()) &#123;</span><br><span class="line">                directory.mkdirs();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 生成唯一文件名</span></span><br><span class="line">            <span class="comment">// 获取源文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">            <span class="comment">// 获取文件后缀</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">            <span class="comment">// 生成文件名(当前时间戳+uuid+后缀)</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> System.currentTimeMillis() + <span class="string">&quot;_&quot;</span> +</span><br><span class="line">                    UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>) + extension;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存文件</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> absolutePath + File.separator + fileName;</span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(filePath));</span><br><span class="line"></span><br><span class="line">            log.info(<span class="string">&quot;文件上传成功，保存路径：&#123;&#125;&quot;</span>, filePath);</span><br><span class="line">            <span class="comment">// 返回完整路径</span></span><br><span class="line">            <span class="keyword">return</span> Result.success(filePath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;文件上传失败&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> Result.error(MessageConstant.UPLOAD_FAILED);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在sky-server的controller下创建DishController：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/dish&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags=&quot;菜品相关接口&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;新增菜品&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;新增菜品：&#123;&#125;&quot;</span>,dishDTO);</span><br><span class="line">        dishService.saveWithFlavor(dishDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的service下创建DishService：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line">    <span class="comment">//新增菜品和对应的口味</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDTO dishDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的service的impl下创建DishServiceImpl：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorMapper dishFlavorMapper;</span><br><span class="line">    <span class="comment">//新增菜品对应的口味</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDTO dishDTO)</span> &#123;</span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">        BeanUtils.copyProperties(dishDTO,dish);</span><br><span class="line">        <span class="comment">//想菜品表插入1条数据</span></span><br><span class="line">        dishMapper.insert(dish);</span><br><span class="line">        <span class="comment">//获取insert语句生成的主键值</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dish.getId();</span><br><span class="line">        <span class="comment">//向口味表插入n条数据</span></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();</span><br><span class="line">        <span class="keyword">if</span>(flavors != <span class="literal">null</span> &amp;&amp; flavors.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            flavors.forEach(dishFlavor -&gt; &#123;</span><br><span class="line">                dishFlavor.setDishId(dishId);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//向口味表插入n条数据</span></span><br><span class="line">            dishFlavorMapper.insertBatch(flavors);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>一个菜品有多个口味数据，向菜品表插入1条数据，向口味表插入n条数据。</strong></p><p><strong>因为涉及到多个表，所以添加@Transactional的注解（需要在启动类上添加@EnableTransactionManagement注解）</strong></p><p>在sky-server的mapper创建DishMapper类，写入insert方法的代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishMapper</span> &#123;</span><br><span class="line">    <span class="comment">//根据分类id查询菜品数量</span></span><br><span class="line">    <span class="meta">@Select(&quot;select count(id) from dish where category_id = #&#123;categoryId&#125;&quot;)</span></span><br><span class="line">    Integer <span class="title function_">countByCategoryId</span><span class="params">(Long categoryId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Dish dish)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的resources下的mapper下创建DishMapper.xml文件，写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sky.mapper.DishMapper&quot;</span>&gt;</span><br><span class="line">    &lt;insert id=<span class="string">&quot;insert&quot;</span>&gt;</span><br><span class="line">        insert into <span class="title function_">dish</span><span class="params">(name,category_id,price,image,description,create_time,update_time,create_user,update_user,status)</span></span><br><span class="line">        values (#&#123;name&#125;,#&#123;categoryId&#125;,#&#123;price&#125;,#&#123;image&#125;,#&#123;description&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;,#&#123;createUser&#125;,#&#123;updateUser&#125;,#&#123;status&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><p>在sky-server的mapper创建DishFlavorMapper类，写入insert方法的代码。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishFlavorMapper</span> &#123;</span><br><span class="line">    <span class="meta">@AutoFill(value= OperationType.INSERT)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insertBatch</span><span class="params">(List&lt;DishFlavor&gt; flavors)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的resources下的mapper下创建DishFlavorMapper.xml文件，写入如下代码。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sky.mapper.DishFlavorMapper&quot;</span>&gt;</span><br><span class="line">    &lt;insert id=<span class="string">&quot;insertBatch&quot;</span>&gt;</span><br><span class="line">        insert into <span class="title function_">dish_flavor</span> <span class="params">(dish_id,name,value)</span> VALUES</span><br><span class="line">        &lt;foreach collection=<span class="string">&quot;flavors&quot;</span> item=<span class="string">&quot;df&quot;</span> separator=<span class="string">&quot;,&quot;</span>&gt;</span><br><span class="line">            (#&#123;df.dishId&#125;,#&#123;df.name&#125;,#&#123;df.value&#125;)</span><br><span class="line">        &lt;/foreach&gt;</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><p>在DishMapper和DishFlavorMapper中的insert方法上添加@AutoFill(value&#x3D; OperationType.INSERT)注解。</p><h4 id="2-分页查询-1"><a href="#2-分页查询-1" class="headerlink" title="2.分页查询"></a>2.分页查询</h4><p>在sky-server的controller中已有的DishController类中添加如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;菜品分页查询&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;菜品分页查询：&#123;&#125;&quot;</span>,dishPageQueryDTO);</span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> dishService.pageQuery(dishPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的service中已有的DishService类中添加如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span>&#123;</span><br><span class="line">    PageHelper.startPage(dishPageQueryDTO.getPage(),dishPageQueryDTO.getPageSize());</span><br><span class="line">    Page&lt;DishVO&gt; page = dishMapper.pageQuery(dishPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(),page.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的mapper中已有的DishMapper类中添加如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Page&lt;DishVO&gt; <span class="title function_">pageQuery</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><p>在sky-server的resources下的mapper下已有的DishMapper.xml中写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;pageQuery&quot;</span> resultType=<span class="string">&quot;com.sky.vo.DishVO&quot;</span>&gt;</span><br><span class="line">    select d.* , c.name as categoryName from dish d left outer join category c on d.category_id = c.id</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;name != null&quot;</span>&gt;</span><br><span class="line">            and d.name like <span class="title function_">concat</span><span class="params">(<span class="string">&#x27;%&#x27;</span>,#&#123;name&#125;,<span class="string">&#x27;%&#x27;</span>)</span></span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span><br><span class="line">            and d.category_id = #&#123;categoryId&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt;</span><br><span class="line">            and d.status = #&#123;status&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><h4 id="3-删除菜品"><a href="#3-删除菜品" class="headerlink" title="3.删除菜品"></a>3.删除菜品</h4><p>批量删除是在地址栏写入要删除菜品的集合。</p><p>在sky-server的controller中已有的DishController类中添加如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;菜品批量删除&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;菜品批量删除：&#123;&#125;&quot;</span>,ids);</span><br><span class="line">        dishService.deleteBatch(ids);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要加一个注解@RequestParam，可以将地址栏中多个数字参数提取出来然后变成List集合。 </p><p>在sky-server的service中已有的DishService类中添加如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br></pre></td></tr></table></figure><p>在sky-server的service的Impl中已有的DishServiceImpl类中添加如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">    <span class="comment">//不能删除：存在起售中的菜品</span></span><br><span class="line">    <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(id);</span><br><span class="line">        <span class="keyword">if</span>(dish.getStatus()== StatusConstant.ENABLE)&#123; <span class="comment">//状态为1起售中</span></span><br><span class="line">            <span class="comment">//当前菜品处于起售中，不能删除</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_ON_SALE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//不能删除：菜品被套餐关联</span></span><br><span class="line">    List&lt;Long&gt; setmealIds = setmealDishMapper.getSetmealIdsByDishIds(ids);</span><br><span class="line">    <span class="keyword">if</span>(setmealIds != <span class="literal">null</span> &amp;&amp; setmealIds.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//当前菜品被套餐关联了，不能删除</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_BE_RELATED_BY_SETMEAL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除菜品表中的菜品数据</span></span><br><span class="line">    <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">        dishMapper.deleteById(id);</span><br><span class="line">        <span class="comment">//删除口味数据</span></span><br><span class="line">        dishFlavorMapper.deleteByDishId(id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>批量删除用foreach循环来遍历，删除被套餐关联的SQL语句比较复杂。 </p><p>删除菜品表中的菜品数据这里，每次循环需要执行2次SQL，可能会出现性能问题。应该采用如下的SQL形式：delete from dish where id in (?,?,?)。</p><p>在sky-server的mapper中已有的DishMapper类中添加如下代码（负责删除菜品）：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据主键删除菜品</span></span><br><span class="line"><span class="meta">@Delete(&quot;delete from dish where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p>在sky-server的mapper中创建DishFlavorMapper类中添加如下代码（负责删除关联的口味数据）：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据菜品id删除对应的口味数据</span></span><br><span class="line"><span class="meta">@Delete(&quot;delete from dish_flavor where dish_id = #&#123;dishId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteByDishId</span><span class="params">(Long dishId)</span>;</span><br></pre></td></tr></table></figure><p>在sky-server的mapper中创建SetmealDishMapper类中添加如下代码（负责查看是否有关联的套餐）：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealDishMapper</span> &#123;</span><br><span class="line">    <span class="comment">//根据菜品id查询对应的套餐id</span></span><br><span class="line">    <span class="comment">//select setmeal_id from setmeal_dish where dish_id in (1,2,3,4)</span></span><br><span class="line">    List&lt;Long&gt; <span class="title function_">getSetmealIdsByDishIds</span><span class="params">(List&lt;Long&gt; dishIds)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（上步SQL具体实现）在sky-server的resources的mapper中创建SetmealDishMapper类中添加如下代码（思路是去查询套餐表，看套餐菜品id是否和当前传入的id相同）：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.SetmealDishMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getSetmealIdsByDishIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span></span><br><span class="line">        select setmeal_id from setmeal_dish where dish_id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;dishIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;dishId&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">            #&#123;dishId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里比较巧妙的是foreach循环，collection是集合，item是一个个项，separator是分割符号，open是开始符号，close是结束符号。每个元素用逗号分割，然后用大括号括起来。</p><h4 id="4-修改菜品"><a href="#4-修改菜品" class="headerlink" title="4.修改菜品"></a>4.修改菜品</h4><p>在sky-server的controller中已有的DishController类中添加代码如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;根据id查询菜品&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;DishVO&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;根据id查询菜品：&#123;&#125;&quot;</span>,id);</span><br><span class="line">    <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> dishService.getByIdWithFlavor(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(dishVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的service中已有的DishService类中添加代码如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id查询菜品</span></span><br><span class="line">DishVO <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p>在sky-server的service的Impl中已有的DishServiceImpl类中添加代码如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id查询菜品和对应的口味数据</span></span><br><span class="line"><span class="keyword">public</span> DishVO <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">    <span class="comment">//根据id查询菜品数据</span></span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(id);</span><br><span class="line">    <span class="comment">//根据菜品id查询口味数据</span></span><br><span class="line">    List&lt;DishFlavor&gt; dishFlavors = dishFlavorMapper.getByDishId(id);</span><br><span class="line">    <span class="comment">//将查询到的数据封装到VO</span></span><br><span class="line">    <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishVO</span>() ;</span><br><span class="line">    BeanUtils.copyProperties(dish,dishVO);</span><br><span class="line">    dishVO.setFlavors(dishFlavors);</span><br><span class="line">    <span class="keyword">return</span> dishVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的mapper中已有的dishFlavorMapper类中添加代码如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from dish_flavor where dish_id=#&#123;dishId&#125;&quot;)</span></span><br><span class="line">List&lt;DishFlavor&gt; <span class="title function_">getByDishId</span><span class="params">(Long dishId)</span>;</span><br></pre></td></tr></table></figure><p>在sky-server的controller中已有的DishController类中添加代码如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//修改菜品</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;修改菜品&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;修改菜品；&#123;&#125;&quot;</span>,dishDTO);</span><br><span class="line">    dishService.updateWithFlavor(dishDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的service中已有的DishService类中添加代码如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id修改菜品基本信息和对应的口味信息</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDTO dishDTO)</span>;</span><br></pre></td></tr></table></figure><p>在sky-server的service的Impl中已有的DishServiceImpl类中添加代码如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id修改菜品基本信息和对应的口味信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDTO dishDTO)</span>&#123;</span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">    BeanUtils.copyProperties(dishDTO,dish);</span><br><span class="line">    <span class="comment">//修改菜品表基本信息</span></span><br><span class="line">    dishMapper.update(dish);</span><br><span class="line">    <span class="comment">//删除原有的口味数据</span></span><br><span class="line">    dishFlavorMapper.deleteByDishId(dishDTO.getId());</span><br><span class="line">    <span class="comment">//重新插入口味数据</span></span><br><span class="line">    List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();</span><br><span class="line">    <span class="keyword">if</span>(flavors != <span class="literal">null</span> &amp;&amp; flavors.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        flavors.forEach(dishFlavor -&gt;&#123;</span><br><span class="line">            dishFlavor.setDishId(dishDTO.getId());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    dishFlavorMapper.insertBatch(flavors);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>口味的修改比较麻烦，有可能是删除了再新增，有可能不删除，有可能没删除直接新增。</p><p>处理方法：直接把菜品原先关联的口味数据删掉，然后再按照当前传来的口味重新插入数据。</p><p>传入DTO不合适，因为DTO里有口味数据，而修改菜品不应该包含口味，所以应该只传入一个Dish数据。</p><p>  在sky-server的mapper中已有的dishFlavorMapper类中添加代码如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据id动态修改菜品</span></span><br><span class="line"><span class="meta">@AutoFill(value=OperationType.UPDATE)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Dish dish)</span>;</span><br></pre></td></tr></table></figure><p>在sky-server的resources下的mapper中已有的dishFlavorMapper.xml类中添加代码如下：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">    update dish</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span> name = #&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span>category_id = #&#123;categoryId&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price != null&quot;</span>&gt;</span>price = #&#123;price&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;image != null&quot;</span>&gt;</span>image = #&#123;image&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;description != null&quot;</span>&gt;</span>description = #&#123;description&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span>status = #&#123;status&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span>update_Time = #&#123;updateTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span>update_User = #&#123;updateUser&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里用的是动态SQL。</p><h3 id="套餐管理"><a href="#套餐管理" class="headerlink" title="套餐管理"></a>套餐管理</h3><h4 id="1-新增套餐"><a href="#1-新增套餐" class="headerlink" title="1. 新增套餐"></a>1. 新增套餐</h4><p>1.2.1 DishController</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据分类id查询菜品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;根据分类id查询菜品&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;Dish&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span>&#123;</span><br><span class="line">    List&lt;Dish&gt; list = dishService.list(categoryId);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.2.2 DishService</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据分类id查询菜品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span>;</span><br></pre></td></tr></table></figure><p>1.2.3 DishServiceImpl</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据分类id查询菜品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Dish&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> Dish.builder()</span><br><span class="line">        .categoryId(categoryId)</span><br><span class="line">        .status(StatusConstant.ENABLE)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">return</span> dishMapper.list(dish);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.2.4 DishMapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态条件查询菜品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span>;</span><br></pre></td></tr></table></figure><p>1.2.5 DishMapper.xml</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Dish&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Dish&quot;</span>&gt;</span></span><br><span class="line">    select * from dish</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">            and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">            and category_id = #&#123;categoryId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            and status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>1.2.6 SetmealController</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 套餐管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/setmeal&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;套餐相关接口&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;新增套餐&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">        setmealService.saveWithDish(setmealDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.2.7 SetmealService</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增套餐，同时需要保存套餐和菜品的关联关系</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">(SetmealDTO setmealDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.2.8 SetmealServiceImpl</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 套餐业务实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealMapper setmealMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishMapper setmealDishMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增套餐，同时需要保存套餐和菜品的关联关系</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">(SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">        BeanUtils.copyProperties(setmealDTO, setmeal);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向套餐表插入数据</span></span><br><span class="line">        setmealMapper.insert(setmeal);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取生成的套餐id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">setmealId</span> <span class="operator">=</span> setmeal.getId();</span><br><span class="line"></span><br><span class="line">        List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();</span><br><span class="line">        setmealDishes.forEach(setmealDish -&gt; &#123;</span><br><span class="line">            setmealDish.setSetmealId(setmealId);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//保存套餐和菜品的关联关系</span></span><br><span class="line">        setmealDishMapper.insertBatch(setmealDishes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.2.9 SetmealMapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@AutoFill(OperationType.INSERT)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Setmeal setmeal)</span>;</span><br></pre></td></tr></table></figure><p>1.2.10 SetmealMapper.xml</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Setmeal&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    insert into setmeal</span><br><span class="line">    (category_id, name, price, status, description, image, create_time, update_time, create_user, update_user)</span><br><span class="line">    values (#&#123;categoryId&#125;, #&#123;name&#125;, #&#123;price&#125;, #&#123;status&#125;, #&#123;description&#125;, #&#123;image&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;,</span><br><span class="line">    #&#123;createUser&#125;, #&#123;updateUser&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p>1.2.11 SetmealDishMapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量保存套餐和菜品的关联关系</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDishes</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertBatch</span><span class="params">(List&lt;SetmealDish&gt; setmealDishes)</span>;</span><br></pre></td></tr></table></figure><p>1.2.12 SetmealDishMapper.xml</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    insert into setmeal_dish</span><br><span class="line">    (setmeal_id,dish_id,name,price,copies)</span><br><span class="line">    values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;setmealDishes&quot;</span> <span class="attr">item</span>=<span class="string">&quot;sd&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        (#&#123;sd.setmealId&#125;,#&#123;sd.dishId&#125;,#&#123;sd.name&#125;,#&#123;sd.price&#125;,#&#123;sd.copies&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-套餐分页查询"><a href="#2-套餐分页查询" class="headerlink" title="2. 套餐分页查询"></a>2. 套餐分页查询</h4><p>2.2.1 SetmealController</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;分页查询&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(SetmealPageQueryDTO setmealPageQueryDTO)</span> &#123;</span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> setmealService.pageQuery(setmealPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.2.2 SetmealService</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">PageResult <span class="title function_">pageQuery</span><span class="params">(SetmealPageQueryDTO setmealPageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><p>2.2.3 SetmealServiceImpl</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(SetmealPageQueryDTO setmealPageQueryDTO)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> setmealPageQueryDTO.getPage();</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> setmealPageQueryDTO.getPageSize();</span><br><span class="line"></span><br><span class="line">    PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">    Page&lt;SetmealVO&gt; page = setmealMapper.pageQuery(setmealPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), page.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.2.4 SetmealMapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Page&lt;SetmealVO&gt; <span class="title function_">pageQuery</span><span class="params">(SetmealPageQueryDTO setmealPageQueryDTO)</span>;</span><br></pre></td></tr></table></figure><p>2.2.5 SetmealMapper.xml</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.vo.SetmealVO&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">    s.*,c.name categoryName</span><br><span class="line">    from</span><br><span class="line">    setmeal s</span><br><span class="line">    left join</span><br><span class="line">    category c</span><br><span class="line">    on</span><br><span class="line">    s.category_id = c.id</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">            and s.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            and s.status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">            and s.category_id = #&#123;categoryId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by s.create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-删除套餐"><a href="#3-删除套餐" class="headerlink" title="3. 删除套餐"></a>3. 删除套餐</h4><p>3.2.1 SetmealController</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;批量删除套餐&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">    setmealService.deleteBatch(ids);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.2.2 SetmealService</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br></pre></td></tr></table></figure><p>3.2.3 SetmealServiceImpl</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    ids.forEach(id -&gt; &#123;</span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealMapper.getById(id);</span><br><span class="line">        <span class="keyword">if</span>(StatusConstant.ENABLE == setmeal.getStatus())&#123;</span><br><span class="line">            <span class="comment">//起售中的套餐不能删除</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.SETMEAL_ON_SALE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    ids.forEach(setmealId -&gt; &#123;</span><br><span class="line">        <span class="comment">//删除套餐表中的数据</span></span><br><span class="line">        setmealMapper.deleteById(setmealId);</span><br><span class="line">        <span class="comment">//删除套餐菜品关系表中的数据</span></span><br><span class="line">        setmealDishMapper.deleteBySetmealId(setmealId);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.2.4 SetmealMapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from setmeal where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">Setmeal <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Delete(&quot;delete from setmeal where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure><p>3.2.5 SetmealDishMapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据套餐id删除套餐和菜品的关联关系</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Delete(&quot;delete from setmeal_dish where setmeal_id = #&#123;setmealId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteBySetmealId</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure><h4 id="4-修改套餐"><a href="#4-修改套餐" class="headerlink" title="4. 修改套餐"></a>4. 修改套餐</h4><p>4.2.1 SetmealController</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询套餐，用于修改页面回显数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;根据id查询套餐&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SetmealVO&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">SetmealVO</span> <span class="variable">setmealVO</span> <span class="operator">=</span> setmealService.getByIdWithDish(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(setmealVO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改套餐</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;修改套餐&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">    setmealService.update(setmealDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.2.2 SetmealService</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询套餐和关联的菜品数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">SetmealVO <span class="title function_">getByIdWithDish</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(SetmealDTO setmealDTO)</span>;</span><br></pre></td></tr></table></figure><p>4.2.3 SetmealServiceImpl</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询套餐和套餐菜品关系</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> SetmealVO <span class="title function_">getByIdWithDish</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealMapper.getById(id);</span><br><span class="line">    List&lt;SetmealDish&gt; setmealDishes = setmealDishMapper.getBySetmealId(id);</span><br><span class="line"></span><br><span class="line">    <span class="type">SetmealVO</span> <span class="variable">setmealVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealVO</span>();</span><br><span class="line">    BeanUtils.copyProperties(setmeal, setmealVO);</span><br><span class="line">    setmealVO.setSetmealDishes(setmealDishes);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> setmealVO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改套餐</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">    BeanUtils.copyProperties(setmealDTO, setmeal);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1、修改套餐表，执行update</span></span><br><span class="line">    setmealMapper.update(setmeal);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//套餐id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">setmealId</span> <span class="operator">=</span> setmealDTO.getId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、删除套餐和菜品的关联关系，操作setmeal_dish表，执行delete</span></span><br><span class="line">    setmealDishMapper.deleteBySetmealId(setmealId);</span><br><span class="line"></span><br><span class="line">    List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();</span><br><span class="line">    setmealDishes.forEach(setmealDish -&gt; &#123;</span><br><span class="line">        setmealDish.setSetmealId(setmealId);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//3、重新插入套餐和菜品的关联关系，操作setmeal_dish表，执行insert</span></span><br><span class="line">    setmealDishMapper.insertBatch(setmealDishes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.2.4 SetmealDishMapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据套餐id查询套餐和菜品的关联关系</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Select(&quot;select * from setmeal_dish where setmeal_id = #&#123;setmealId&#125;&quot;)</span></span><br><span class="line">   List&lt;SetmealDish&gt; <span class="title function_">getBySetmealId</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure><h4 id="5-起售停售套餐"><a href="#5-起售停售套餐" class="headerlink" title="5. 起售停售套餐"></a>5. 起售停售套餐</h4><p>5.2.1 SetmealController</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 套餐起售停售</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;套餐起售停售&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, Long id)</span> &#123;</span><br><span class="line">    setmealService.startOrStop(status, id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.2.2 SetmealService</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 套餐起售、停售</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span>;</span><br></pre></td></tr></table></figure><p>5.2.3 SetmealServiceImpl</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 套餐起售、停售</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//起售套餐时，判断套餐内是否有停售菜品，有停售菜品提示&quot;套餐内包含未启售菜品，无法启售&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(status == StatusConstant.ENABLE)&#123;</span><br><span class="line">        <span class="comment">//select a.* from dish a left join setmeal_dish b on a.id = b.dish_id where b.setmeal_id = ?</span></span><br><span class="line">        List&lt;Dish&gt; dishList = dishMapper.getBySetmealId(id);</span><br><span class="line">        <span class="keyword">if</span>(dishList != <span class="literal">null</span> &amp;&amp; dishList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            dishList.forEach(dish -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span>(StatusConstant.DISABLE == dish.getStatus())&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SetmealEnableFailedException</span>(MessageConstant.SETMEAL_ENABLE_FAILED);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> Setmeal.builder()</span><br><span class="line">        .id(id)</span><br><span class="line">        .status(status)</span><br><span class="line">        .build();</span><br><span class="line">    setmealMapper.update(setmeal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.2.4 DishMapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据套餐id查询菜品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Select(&quot;select a.* from dish a left join setmeal_dish b on a.id = b.dish_id where b.setmeal_id = #&#123;setmealId&#125;&quot;)</span></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">getBySetmealId</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure><h2 id="三-Redis使用"><a href="#三-Redis使用" class="headerlink" title="三 Redis使用"></a>三 Redis使用</h2><h3 id="营业状态"><a href="#营业状态" class="headerlink" title="营业状态"></a>营业状态</h3><p>设置营业状态；管理端查询营业状态，用户端查询营业状态（管理端和用户端查询路径不同）。</p><p>营业状态存储在Redis中，不用在Mysql中单独创建一张表。</p><p>在controller&#x2F;admin下创建ShopController这个是管理端的，写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;adminShopController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/shop&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags=&quot;店铺相关接口&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY=<span class="string">&quot;SHOP_STATUS&quot;</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="comment">//设置店铺营业状态</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;设置店铺的营业状态&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setStatus</span><span class="params">( <span class="meta">@PathVariable</span> Integer status)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;设置店铺的营业状态为：&#123;&#125;&quot;</span>,status==<span class="number">1</span> ?<span class="string">&quot;营业中&quot;</span>:<span class="string">&quot;打烊中&quot;</span>);</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;SHOP_STATUS&quot;</span>,status);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取店铺的营业状态</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/status&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取店铺的营业状态&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Integer&gt; <span class="title function_">getStatus</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> (Integer) redisTemplate.opsForValue().get(KEY);</span><br><span class="line">        log.info(<span class="string">&quot;获取到店铺的营业状态为：&#123;&#125;&quot;</span>,status==<span class="number">1</span>?<span class="string">&quot;营业中&quot;</span>:<span class="string">&quot;打烊中&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.success(status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>在controller下创建user包，然后把amin的ShopController复制到这个下面，然后进行简单修改，只保留获取状态的。因为有2个类类名相同，会导致Bean冲突，所以我们要在@RestController中指定Bean的名称。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;userShopController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/shop&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags=&quot;店铺相关接口&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY=<span class="string">&quot;SHOP_STATUS&quot;</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="comment">//获取店铺的营业状态</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/status&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取店铺的营业状态&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Integer&gt; <span class="title function_">getStatus</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> (Integer) redisTemplate.opsForValue().get(KEY);</span><br><span class="line">        log.info(<span class="string">&quot;获取到店铺的营业状态为：&#123;&#125;&quot;</span>,status==<span class="number">1</span>?<span class="string">&quot;营业中&quot;</span>:<span class="string">&quot;打烊中&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.success(status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="四-客户端"><a href="#四-客户端" class="headerlink" title="四 客户端"></a>四 客户端</h2><h3 id="1-HttpClient"><a href="#1-HttpClient" class="headerlink" title="1 HttpClient"></a>1 HttpClient</h3><h4 id="1-1-HttpClient-介绍"><a href="#1-1-HttpClient-介绍" class="headerlink" title="1.1 (HttpClient)介绍"></a>1.1 (HttpClient)介绍</h4><p>介绍：在Java中通过编码的方式发送HTTP请求。</p><p>HttpClient 是Apache Jakarta Common 下的子项目，可以用来提供高效的、最新的、功能丰富的支持 HTTP 协议的客户端编程工具包，并且它支持 HTTP 协议最新的版本和建议。</p><p>maven坐标：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-2-HttpClient-发GET请求"><a href="#1-2-HttpClient-发GET请求" class="headerlink" title="1.2 (HttpClient)发GET请求"></a>1.2 (HttpClient)发GET请求</h4><p>要保证当前项目已经提前启动好了。</p><p>在key-server&#x2F;src&#x2F;test&#x2F;java&#x2F;com&#x2F;sky&#x2F;test下面创建HttpClientTest类然后写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientTest</span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGET</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//创建httpclient对象</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">        <span class="comment">//创建请求对象</span></span><br><span class="line">        <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://localhost:8080/user/shop/status&quot;</span>);</span><br><span class="line">        <span class="comment">//发送请求</span></span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpGet);</span><br><span class="line">        <span class="comment">//获取服务端返回的状态码</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> response.getStatusLine().getStatusCode();</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端返回的状态码为：&quot;</span>+statusCode);</span><br><span class="line">        <span class="comment">//获取服务端返回的数据</span></span><br><span class="line">        <span class="type">HttpEntity</span> <span class="variable">entity</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> EntityUtils.toString(entity);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端返回的数据为：&quot;</span>+body);</span><br><span class="line">        <span class="comment">//关闭资源</span></span><br><span class="line">        response.close();</span><br><span class="line">        httpClient.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-3-HttpClient-发POST请求"><a href="#1-3-HttpClient-发POST请求" class="headerlink" title="1.3 (HttpClient)发POST请求"></a>1.3 (HttpClient)发POST请求</h4><p>要保证当前项目已经提前启动好了。POST需要提前传入参数。</p><p>在上一节的HttpClientTest类中写入如下的代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPOST</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">//创建httpclient对象</span></span><br><span class="line">    <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">    <span class="comment">//创建请求对象</span></span><br><span class="line">    <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://localhost:8080/admin/employee/login&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    jsonObject.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    jsonObject.put(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="type">StringEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(jsonObject.toString());</span><br><span class="line">    <span class="comment">//指定请求编码方式</span></span><br><span class="line">    entity.setContentEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">//数据格式</span></span><br><span class="line">    entity.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">    httpPost.setEntity(entity);</span><br><span class="line">    <span class="comment">//发送请求</span></span><br><span class="line">    <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpPost);</span><br><span class="line">    <span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> response.getStatusLine().getStatusCode();</span><br><span class="line">    System.out.println(<span class="string">&quot;响应码为：&quot;</span>+statusCode);</span><br><span class="line">    <span class="type">HttpEntity</span> <span class="variable">entity1</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">    <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> EntityUtils.toString(entity1);</span><br><span class="line">    System.out.println(<span class="string">&quot;响应数据为：&quot;</span>+body);</span><br><span class="line">    <span class="comment">//关闭资源</span></span><br><span class="line">    response.close();</span><br><span class="line">    httpClient.close();</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>与Get不同的是，这里添加了登录的参数以及请求编码的方式和数据的格式，其它的基本都是相同的。</p><p>这个其实是调用了登录的API，最后会返回一个Token。</p><h3 id="2-缓存商品和购物车"><a href="#2-缓存商品和购物车" class="headerlink" title="2 缓存商品和购物车"></a>2 缓存商品和购物车</h3><h4 id="2-1-本章内容介绍"><a href="#2-1-本章内容介绍" class="headerlink" title="2.1 本章内容介绍"></a>2.1 本章内容介绍</h4><p>菜品和套餐存储在数据库中，如果短期内有大量的人查询会导致数据库压力过大，用户体验不佳。现在把商品数据缓存到Redis中。</p><p>加入购物车，查看购物车，可以看到购物车中的商品，可以清空购物车，还可以添加商品到购物车。</p><p>缓存菜品 -&gt; 缓存套餐 -&gt; 添加购物车 -&gt; 查看购物车 -&gt; 清空购物车，从购物车中减去某个商品。</p><h4 id="2-2-缓存菜品-设计分析"><a href="#2-2-缓存菜品-设计分析" class="headerlink" title="2.2 (缓存菜品)设计分析"></a>2.2 (缓存菜品)设计分析</h4><p>问题说明：小程序菜品数据是通过数据库获得，如果用户端访问量过大，数据库的压力会增加。</p><p>实现思路：通过Redis来缓存菜品数据，减少数据库查询操作。内存操作的性能比磁盘IO性能更高。</p><p>每个分类下的菜品保存一份缓存数据。</p><p>数据库中菜品数据有变更时要清理缓存数据。</p><h4 id="2-3-缓存菜品-代码开发"><a href="#2-3-缓存菜品-代码开发" class="headerlink" title="2.3 (缓存菜品)代码开发"></a>2.3 (缓存菜品)代码开发</h4><p>在sky-server下的controller&#x2F;user下的DishController类中写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;userDishController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/dish&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;C端-菜品浏览接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="comment">// 根据分类id查询菜品</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据分类id查询菜品&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;DishVO&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">        <span class="comment">//构造redis中的key，规则：dish_分类id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + categoryId;</span><br><span class="line">        <span class="comment">//查询redis中是否存在菜品数据</span></span><br><span class="line">        List&lt;DishVO&gt; list = (List&lt;DishVO&gt;)redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span>(list != <span class="literal">null</span> &amp;&amp; list.size()&gt;<span class="number">0</span>)&#123;<span class="comment">//如果存在，直接返回，无须查询数据库</span></span><br><span class="line">            <span class="keyword">return</span> Result.success(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">        dish.setCategoryId(categoryId);</span><br><span class="line">        dish.setStatus(StatusConstant.ENABLE);<span class="comment">//查询起售中的菜品</span></span><br><span class="line">        <span class="comment">//如果不存在，查询数据库，将查询到的数据放入redis中</span></span><br><span class="line">        list = dishService.listWithFlavor(dish);</span><br><span class="line">        redisTemplate.opsForValue().set(key,list);</span><br><span class="line">        <span class="keyword">return</span> Result.success(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在小程序助手中编译，然后在不同的菜类间切换（比如蜀味烤鱼和蜀味牛蛙），效果是第一次IDEA的控制台会输出SQL语句，然后去看Redis会发现已经有了缓存。然后继续在前面已缓存的菜类间切换，会发现控制台不再输出SQL语句，说明走的是Redis缓存。</p><h4 id="2-4-缓存菜品-清理缓存"><a href="#2-4-缓存菜品-清理缓存" class="headerlink" title="2.4 (缓存菜品)清理缓存"></a>2.4 (缓存菜品)清理缓存</h4><p>不清理可能出现的问题：比如菜品的价格如果被修改，如果继续从Redis从取数据，会导致数据的不一致。</p><p>新增菜品、修改菜品、批量删除菜品、起售和停售菜品的时候需要清理缓存。</p><p>所以需要在controller下的admin中的DishController中修改代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//清理缓存数据</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cleanCache</span><span class="params">(String pattern)</span>&#123;</span><br><span class="line">    <span class="type">Set</span> <span class="variable">keys</span> <span class="operator">=</span> redisTemplate.keys(pattern);</span><br><span class="line">    redisTemplate.delete(keys);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在update、delete方法中调用完service的方法后：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">cleanCache(<span class="string">&quot;dish_*&quot;</span>);</span><br></pre></td></tr></table></figure><p>在save方法中调用service的方法后：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dishDTO.getCategoryId();</span><br><span class="line">cleanCache(key);<span class="comment">//清理缓存数据</span></span><br></pre></td></tr></table></figure><h4 id="2-5-缓存菜品-功能测试"><a href="#2-5-缓存菜品-功能测试" class="headerlink" title="2.5 (缓存菜品)功能测试"></a>2.5 (缓存菜品)功能测试</h4><p>首先把所有的菜类都缓存到Redis中（在小程序助手里把所有菜类都点一遍），然后在电脑管理端的前端平台修改某一道菜，然后再看Redis的可视化面板，看看是不是所有的Redis都被清空。</p><h4 id="2-6-SpringCache介绍"><a href="#2-6-SpringCache介绍" class="headerlink" title="2.6 SpringCache介绍"></a>2.6 SpringCache介绍</h4><p>SpringCache是Spring提供的缓存框架。提供了基于注解的缓存功能。</p><p>SpringCache提供了一层抽象，底层可以切换不同的缓存实现（只需要导入不同的Jar包即可），如EHCache，Caffeine，Redis。</p><table><thead><tr><th><strong>注解</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>@EnableCaching</td><td>开启缓存注解功能，通常加在启动类上</td></tr><tr><td>@Cacheable</td><td>在方法执行前先查询缓存中是否有数据，如果有数据，则直接返回缓存数据；如果没有缓存数据，调用方法并将方法返回值放到缓存中</td></tr><tr><td>@CachePut</td><td>将方法的返回值放到缓存中</td></tr><tr><td>@CacheEvict</td><td>将一条或多条数据从缓存中删除</td></tr></tbody></table><h4 id="2-7-SpringCache"><a href="#2-7-SpringCache" class="headerlink" title="2.7 SpringCache"></a>2.7 SpringCache</h4><p>依赖导入</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-8-SpringCache入门"><a href="#2-8-SpringCache入门" class="headerlink" title="2.8 SpringCache入门"></a>2.8 SpringCache入门</h4><p>在启动类上加@EnableCaching</p><p>在controller层的UserController下的save方法上写入如下的代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@CachePut(cacheNames=&quot;userCache&quot;,key=&quot;#user.id&quot;)</span> <span class="comment">//如果使用spring Cache缓存数据，key的生成：userCache::1。user是从参数取到的。</span></span><br><span class="line"><span class="comment">//@CachePut(cacheNames=&quot;userCache&quot;,key=&quot;#result.id&quot;) //result是从返回值return取到的</span></span><br><span class="line"><span class="comment">//@CachePut(cacheNames=&quot;userCache&quot;,key=&quot;#p0.id&quot;)</span></span><br><span class="line"><span class="comment">//@CachePut(cacheNames=&quot;userCache&quot;,key=&quot;#a0.id&quot;)</span></span><br><span class="line"><span class="comment">//@CachePut(cacheNames=&quot;userCache&quot;,key=&quot;#root.args[0].id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意key&#x3D;”#result.id”中的result取的是返回值返回的那个结果。 key&#x3D;”#user.id”的user取的是传入的参数。p0，a0，root.args[0]表示取的都是第1个参数。</p><p>在controller层的UserController下的getById方法上写入如下的代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cacheable(cacheNames=&quot;userCache&quot;,key=&quot;#id&quot;)</span></span><br></pre></td></tr></table></figure><p>然后在方法体的第1行打上断点，点击小虫，然后到localhost:8888&#x2F;doc.html中对get方法进行测试，发送1，效果是：直接从Redis中返回数据，压根不会触发断点。</p><p>现在手动删除id为1的数据，然后重新在doc.html中发送数据，然后会执行断点，放心后控制台输出SQL语句，然后Redis缓存中也有数据。</p><p>在controller层的UserController下的deleteById和deleteAll方法上加入如下注解：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = &quot;userCache&quot;,key=&quot;#id&quot;)</span> <span class="comment">//key的形式 userCache::10</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>&#123;userMapper.deleteById(id);&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/delAll&quot;)</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames=&quot;userCache&quot;,allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAll</span><span class="params">()</span>&#123;</span><br><span class="line">    userMapper.deleteAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试的话可以在两个方法内的第1行打上断点，点击小虫，然后到localhost:8888&#x2F;doc.html中对delete和deleteAll方法进行测试，先通过getById方法增加几个数据，然后再逐一删除。</p><p>可以这么理解cacheNames里的参数就是指定key的名字，只会删除相应的key。</p><h4 id="2-9-缓存套餐-代码开发"><a href="#2-9-缓存套餐-代码开发" class="headerlink" title="2.9 (缓存套餐)代码开发"></a>2.9 (缓存套餐)代码开发</h4><p>首先要在sky-server包下导入下面两个坐标：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后要在sky-server包下的启动类SkyApplication类上加如下注解：</p><p><code>@EnableCaching</code></p><p>首先是在controller&#x2F;user包下的SetmealController类中的list方法上加如下注解：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cacheable(cacheNames=&quot;setmealCache&quot;,key=&quot;#categoryId&quot;)</span> <span class="comment">//key: setmealCache::100</span></span><br></pre></td></tr></table></figure><p>然后是在controller&#x2F;admin包下的SetmealController类中的save方法上加如下注解：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CacheEvict(cacheNames=&quot;setmealCache&quot;,key=&quot;#setmealDTO.categoryId&quot;)</span></span><br></pre></td></tr></table></figure><p>最后是在controller&#x2F;admin包下的SetmealController类中的update、delete、startOrStop方法上加如下注解：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span></span><br></pre></td></tr></table></figure><h4 id="2-10-添购物车"><a href="#2-10-添购物车" class="headerlink" title="2.10 (添购物车)"></a>2.10 (添购物车)</h4><p>在sky-server的controller的user中创建一个名为ShoppingCartController类，写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/shoppingCart&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags=&quot;C端购物车相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShoppingCartService shoppingCartService;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;添加购物车&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCartDTO shoppingCartDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;添加购物车，商品信息为：&#123;&#125;&quot;</span>,shoppingCartDTO);</span><br><span class="line">        shoppingCartService.addShoppingCart(shoppingCartDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在sky-server的service下创建ShoppingCartService类，写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ShoppingCartService</span> &#123;</span><br><span class="line">    <span class="comment">//添加购物车</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addShoppingCart</span><span class="params">(ShoppingCartDTO shoppingCartDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在sky-server的service的Impl下创建ShoppingCartServiceImpl类：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ShoppingCartService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addShoppingCart</span><span class="params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">        <span class="comment">//判断当前加入购物车中的商品是否已经存在了</span></span><br><span class="line">        <span class="comment">//如果已经存在，只需要数量+1</span></span><br><span class="line">        <span class="comment">//如果不存在，则需要插入一条购物车数据</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完善sky-server的service的Impl下的ShoppingCartServiceImpl类：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ShoppingCartService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShoppingCartMapper shoppingCartMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addShoppingCart</span><span class="params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">        <span class="comment">//判断当前加入购物车中的商品是否已经存在了</span></span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">        BeanUtils.copyProperties(shoppingCartDTO,shoppingCart);</span><br><span class="line">        <span class="comment">//userid暂时还不知道，从ThreadLocal取</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">        shoppingCart.setUserId(userId);</span><br><span class="line">        List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);</span><br><span class="line">        <span class="comment">//如果已经存在，只需要数量+1</span></span><br><span class="line">        <span class="keyword">if</span>(list != <span class="literal">null</span> &amp;&amp; list.size()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> list.get(<span class="number">0</span>);</span><br><span class="line">            cart.setNumber(cart.getNumber()+<span class="number">1</span>);</span><br><span class="line">            shoppingCartMapper.updateNumberById(cart);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果不存在，则需要插入一条购物车数据</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的mapper下的ShoppingCartMapper类中写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ShoppingCartMapper</span> &#123;</span><br><span class="line">    List&lt;ShoppingCart&gt; <span class="title function_">list</span><span class="params">(ShoppingCart shoppingCart)</span>;</span><br><span class="line">    <span class="comment">//根据id修改商品数量</span></span><br><span class="line">    <span class="meta">@Update(&quot;update shopping_cart set number = #&#123;number&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateNumberById</span><span class="params">(ShoppingCart shoppingCart)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的resources下的mapper下的ShoppingCartMapper.xml类中写入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sky.mapper.ShoppingCartMapper&quot;</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;select id=<span class="string">&quot;list&quot;</span> resultType=<span class="string">&quot;com.sky.entity.ShoppingCart&quot;</span>&gt;</span><br><span class="line">        select * from shopping_cart</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;userId != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">user_id</span> <span class="operator">=</span> #&#123;userId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;setmealId != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">setmeal_id</span> <span class="operator">=</span> #&#123;setmealId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;dishId != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">dish_id</span> <span class="operator">=</span> #&#123;dishId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;dishFlavor != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">dish_flavor</span> <span class="operator">=</span> #&#123;dishFlavor&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/where&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><p>完善sky-server的service的Impl下的ShoppingCartServiceImpl类：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ShoppingCartService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShoppingCartMapper shoppingCartMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealMapper setmealMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addShoppingCart</span><span class="params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">        <span class="comment">//判断当前加入购物车中的商品是否已经存在了</span></span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">        BeanUtils.copyProperties(shoppingCartDTO,shoppingCart);</span><br><span class="line">        <span class="comment">//userid暂时还不知道，从ThreadLocal取</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">        shoppingCart.setUserId(userId);</span><br><span class="line">        List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);</span><br><span class="line">        <span class="comment">//如果已经存在，只需要数量+1</span></span><br><span class="line">        <span class="keyword">if</span>(list != <span class="literal">null</span> &amp;&amp; list.size()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> list.get(<span class="number">0</span>);</span><br><span class="line">            cart.setNumber(cart.getNumber()+<span class="number">1</span>);</span><br><span class="line">            shoppingCartMapper.updateNumberById(cart);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;<span class="comment">//如果不存在，则需要插入一条购物车数据</span></span><br><span class="line">            <span class="comment">//判断本次添加到购物车的是菜品还是套餐,因为要查询不同表</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCartDTO.getDishId();</span><br><span class="line">            <span class="keyword">if</span>(dishId!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//本次添加到购物车的是菜品</span></span><br><span class="line">                <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(dishId);</span><br><span class="line">                shoppingCart.setName(dish.getName());</span><br><span class="line">                shoppingCart.setImage(dish.getImage());</span><br><span class="line">                shoppingCart.setAmount(dish.getPrice());</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//本次添加到购物车的是套餐</span></span><br><span class="line">                <span class="type">Long</span> <span class="variable">setmealId</span> <span class="operator">=</span> shoppingCartDTO.getSetmealId();</span><br><span class="line">                <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealMapper.getById(setmealId);</span><br><span class="line">                shoppingCart.setName(setmeal.getName());</span><br><span class="line">                shoppingCart.setImage(setmeal.getImage());</span><br><span class="line">                shoppingCart.setAmount(setmeal.getPrice());</span><br><span class="line">            &#125;</span><br><span class="line">            shoppingCart.setNumber(<span class="number">1</span>);</span><br><span class="line">            shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line">            shoppingCartMapper.insert(shoppingCart);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在shoppingCartMapper中添加insert方法：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into shopping_cart(name,user_id,dish_id,setmeal_id,dish_flavor,number,amount,image,create_time)&quot; +</span></span><br><span class="line"><span class="meta">    &quot;value (#&#123;name&#125;,#&#123;userId&#125;,#&#123;dishId&#125;,#&#123;setmealId&#125;,#&#123;dishFlavor&#125;,#&#123;number&#125;,#&#123;amount&#125;,#&#123;image&#125;,#&#123;createTime&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(ShoppingCart shoppingCart)</span>;</span><br></pre></td></tr></table></figure><h4 id="2-11-查看购物车"><a href="#2-11-查看购物车" class="headerlink" title="2.11 查看购物车"></a>2.11 查看购物车</h4><p>在sky-server的controller下的ShoppingCartController类中加入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;查看购物车&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;ShoppingCart&gt;&gt; <span class="title function_">list</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;ShoppingCart&gt; list = shoppingCartService.showShoppingCart();</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的service下的ShoppingCartService类中加入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;ShoppingCart&gt; <span class="title function_">showShoppingCart</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>在sky-server的service的Impl下的ShoppingCartServiceImpl类中加入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ShoppingCart&gt; <span class="title function_">showShoppingCart</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">    <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> ShoppingCart.builder()</span><br><span class="line">                    .userId(userId)</span><br><span class="line">                    .build();</span><br><span class="line">    List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);<span class="comment">//只需要传userid即可</span></span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-12-清空购物车"><a href="#2-12-清空购物车" class="headerlink" title="2.12 清空购物车"></a>2.12 清空购物车</h4><p>在sky-server的controller下的ShoppingCartController类中加入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;清空购物车&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/clean&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">clean</span><span class="params">()</span>&#123;</span><br><span class="line">    shoppingCartService.clean();</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的service下的ShoppingCartService类中加入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//清空购物车</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">clean</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>在sky-server的service的Impl下的ShoppingCartServiceImpl类中加入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//清空购物车</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clean</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">    shoppingCartMapper.deleteByUserId(userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在sky-server的mapper的ShoppingCartMapper类中加入如下代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Delete(&quot;delete from shopping_cart where user_id=#&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteByUserId</span><span class="params">(Long userId)</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java开发 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>springboot学习</title>
      <link href="/2024/11/06/springboot%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/11/06/springboot%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>1 springboot基本介绍</p><h2 id="1-1-SpringBoot是什么"><a href="#1-1-SpringBoot是什么" class="headerlink" title="1.1 SpringBoot是什么"></a>1.1 SpringBoot是什么</h2><p><strong>两句话：</strong></p><ul><li>​<strong>Spring Boot 可以轻松创建独立的、生产级的基于Spring 的应用程序</strong></li><li>​    <strong>Spring Boot 直接嵌入 Tomcat、Jetty 或 Undertow ，可以”直接运行” SpringBoot 应用程序</strong></li></ul><h2 id="1-2-SpringBoot快速入门"><a href="#1-2-SpringBoot快速入门" class="headerlink" title="1.2 SpringBoot快速入门"></a>1.2 SpringBoot快速入门</h2><p>构建一个 SpringBoot 项目，浏览器发送&#x2F;hello 请求 <code>http://localhost:8080/hello</code>，响应Hello:</p><p>这里目前学的的版本是SpringBoot2.7，maven3.6.3，jdk8</p><img src="1.jpg" style="zoom:50%;"><img src="2.jpg" style="zoom: 50%;"><p>创建好之后在pom文件中引入SpringBoot相关依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.wzb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quickstart<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入springboot父工程--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入web项目场景启动器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在com.wzb.springboot包中创建启动类Main,需要注解<code>@SpringBootApplication</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wzb.springboot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 启动SpringBoot项目</span></span><br><span class="line">        SpringApplication.run(Main.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后创建controller包，创建包下HelloController类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动项目后，默认端口是8080，访问<code>http://localhost:8080/hello</code>，可以发现 <code>hello</code> 字符串输出在了浏览器页面。</p><h3 id="1-2-1-小结"><a href="#1-2-1-小结" class="headerlink" title="1.2.1 小结"></a>1.2.1 小结</h3><ol><li>SpringBoot 比较传统的 SSM 开发， 简化整合步骤, 提高开发效率</li><li>简化了 Maven 项目的 pom.xml 依赖导入, 可以说是一键导入，如图</li></ol><img src="3.jpg" style="zoom: 33%;"><p>​3.内置 Tomcat , 简化服务器的配置</p><h2 id="1-3-SpringBoot与SpringMVC关系"><a href="#1-3-SpringBoot与SpringMVC关系" class="headerlink" title="1.3 SpringBoot与SpringMVC关系"></a>1.3 SpringBoot与SpringMVC关系</h2><h3 id="1-3-1-梳理关系"><a href="#1-3-1-梳理关系" class="headerlink" title="1.3.1 梳理关系"></a>1.3.1 梳理关系</h3><ul><li>他们的关系大概是: Spring Boot &gt; Spring &gt; Spring MVC</li><li>Spring MVC 只是 Spring 处理 WEB 层请求的一个模块&#x2F;组件, Spring MVC 的基石是Servlet</li><li>Spring 的核心是 IOC 和 AOP, IOC 提供了依赖注入的容器, AOP 解决了面向切面编程</li><li>Spring Boot 是为了简化开发, 推出的封神框架(约定优于配置[COC]，简化了Spring项目的配置流程), SpringBoot 包含很多组件&#x2F;框架，Spring就是最核心的内容之一，也包含SpringMVC</li><li>Spring 家族，有众多衍生框架和组件例如 boot、security、jpa 等, 他们的基础都是Spring</li></ul><h3 id="1-3-2-如何理解-约定优于配置"><a href="#1-3-2-如何理解-约定优于配置" class="headerlink" title="1.3.2 如何理解 -约定优于配置"></a>1.3.2 如何理解 -约定优于配置</h3><ol><li>约定优于配置(Convention over Configuration&#x2F;COC)，又称按约定编程，是一种软件设计规范, 本质上是对系统、类库或框架中一些东西假定一个大众化合理的默认值(缺省值)</li><li>例如在模型中存在一个名为 User 的类，那么对应到数据库会存在一个名为user 的表，只有在偏离这个约定时才需要做相关的配置 (例如你想将表名命名为t_user 等非user 时才需要写关于这个名字的配置)</li><li>简单来说就是假如你所期待的配置与约定的配置一致，那么就可以不做任何配置，约定不符合期待时, 才需要对约定进行替换配置</li><li>约定其实就是一种规范，遵循了规范，那么就存在通用性，存在通用性，那么事情就会变得相对简单，程序员之间的沟通成本会降低，工作效率会提升，合作也会变得更加简单</li></ol><h1 id="2-依赖管理和自动配置"><a href="#2-依赖管理和自动配置" class="headerlink" title="2 依赖管理和自动配置"></a>2 依赖管理和自动配置</h1><h2 id="2-1-依赖管理"><a href="#2-1-依赖管理" class="headerlink" title="2.1 依赖管理"></a>2.1 依赖管理</h2><h3 id="2-1-1-什么是依赖管理"><a href="#2-1-1-什么是依赖管理" class="headerlink" title="2.1.1 什么是依赖管理"></a>2.1.1 什么是依赖管理</h3><p>spring-boot-starter-parent 还有父项目, 声明了开发中常用的依赖的版本号，并且进行 自动版本仲裁 , 即如果程序员没有指定某个依赖jar 的版本，则以父项目指定的版本为准</p><p><img src="4.jpg"></p><img src="5.jpg" style="zoom:50%;"><h3 id="2-1-2-修改自动仲裁-默认版本号"><a href="#2-1-2-修改自动仲裁-默认版本号" class="headerlink" title="2.1.2 修改自动仲裁&#x2F;默认版本号"></a>2.1.2 修改自动仲裁&#x2F;默认版本号</h3><p>需求说明: 将 SpringBoot mysql 驱动修改成 5.1.49</p><p><img src="6.jpg"></p><p>查看 spring-boot-dependencies.pom 里面规定当前依赖的版本对应的key , 这里是mysql.version</p><p><img src="7.jpg"></p><p>修改 springboot2\quickstart\pom.xml 重写配置, 当更新Maven 时，就依赖到新的mysql 驱动.</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 导入 web 项目场景启动器,会自动导入和 web 开发相关依赖,非常方便--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 根据依赖就近优先原则，以自己指定的为准 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-2-starter-场景启动器"><a href="#2-2-starter-场景启动器" class="headerlink" title="2.2 starter 场景启动器"></a>2.2 starter 场景启动器</h2><h3 id="2-2-1-starter场景启动器基本介绍"><a href="#2-2-1-starter场景启动器基本介绍" class="headerlink" title="2.2.1 starter场景启动器基本介绍"></a>2.2.1 starter<strong>场景启动器基本介绍</strong></h3><p>1.<strong>开发中我们引入了相关场景的</strong>starter**，这个场景中所有的相关依赖都引入进来了，比如我们做<strong>web</strong>开发引入了，该<strong>starter</strong>将导入与<strong>web</strong>开发相关的所有包**</p><p>2.<strong>依赖树:可以看到spring-boot-starter-web，帮我们引入了spring-webmvc，spring-web开发模块，还引入了spring-boot-starter-tomcat场景，spring-boot-starter-json场景，这些场景下面又引入了一大堆相关的包，这些依赖项可以快速启动和运行一个项目，提高开发效率.</strong></p><p><img src="springboot%E5%AD%A6%E4%B9%A0%5C8.jpg"></p><p><strong>3.所有场景启动器最基本的依赖就是spring-boot-starter</strong></p><h3 id="2-2-2-官方提供的starter"><a href="#2-2-2-官方提供的starter" class="headerlink" title="2.2.2 官方提供的starter"></a>2.2.2 <strong>官方提供的</strong>starter</h3><p>1.<strong>在开发中我们经常会用到</strong>spring-boot-starter-xxx**，比如<strong>spring-boot-starter-web</strong>，该场景是用作<strong>web</strong>开发，也就是说<strong>xxx</strong>是某种开发场景。**</p><p>2.我们只要引入starter，这个场景的所有常规需要的依赖我们都自动引入。</p><h3 id="2-2-3-第三方starter"><a href="#2-2-3-第三方starter" class="headerlink" title="2.2.3 第三方starter"></a>2.2.3 <strong>第三方</strong>starter</h3><p>1.SpringBoot<strong>也支持第三方</strong>starter</p><p>2.第三方starter不要从spring-boot开始，因为这是官方spring-boot保留的命名方式的。第三方启动程序通常以项目名称开头。例如，名为thirdpartyproject的第三方启动程序项目通常被命名为thirdpartyproject-spring-boot-starter。</p><p>3.也就是说：xxx-spring-boot-starter是第三方为我们提供的简化开发的场景启动器</p><h2 id="2-3-自动配置"><a href="#2-3-自动配置" class="headerlink" title="2.3 自动配置"></a><strong>2.3</strong> 自动配置</h2><h3 id="2-3-1-自动配置功能"><a href="#2-3-1-自动配置功能" class="headerlink" title="2.3.1 自动配置功能"></a>2.3.1 自动配置功能</h3><p>1.SpringBoot<strong>自动配置</strong>Tomcat、SpringMVC、Web常用功能:比如字符过滤器等等</p><p>2.默认主程序所在的包及其子包下会被扫描</p><p><img src="springboot%E5%AD%A6%E4%B9%A0%5C9.jpg"></p><h3 id="2-3-2-如何修改默认扫描包结构"><a href="#2-3-2-如何修改默认扫描包结构" class="headerlink" title="2.3.2 如何修改默认扫描包结构"></a>2.3.2 <strong>如何修改默认扫描包结构</strong></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span>.com.wzb;</span><br><span class="line">importorg.springframework.stereotype.Controller; </span><br><span class="line">importorg.springframework.web.bind.annotation.RequestMapping; importorg.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*<span class="doctag">@author</span> wzb</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HiController</span>&#123;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hi&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hi</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span><span class="string">&quot;hi~,spring boot&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>修改MainApp.java,增加扫描的包,并完成测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//直接在SpringBootApplication注解后指定</span></span><br><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages=&quot;com.wzb&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp</span>&#123;<span class="comment">//.....</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-3-3-resources-application-properties-配置"><a href="#2-3-3-resources-application-properties-配置" class="headerlink" title="2.3.3 resources\application.properties 配置"></a>2.3.3 resources\application.properties 配置</h3><p>- SpringBoot 项目最重要也是最核心的配置文件就是 application.properties，所有的框架配置都可以在这个配置文件中说明</p><p>● 各 种 配 置 都 有 默 认 , 可 以 在 resources\application.properties 修改, application.properties 文件我们可以手动创建</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#默认 server.port=8080</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">10000</span></span><br><span class="line"><span class="comment">#比如: 默认 spring.servlet.multipart.max-file-size=1MB</span></span><br><span class="line"><span class="comment">#该属性可以指定 springboot 上传文件大小的限制</span></span><br><span class="line"><span class="comment">#默认配置最终都是映射到某个类上,比如这里配置会映射到 MultipartProperties</span></span><br><span class="line"><span class="comment">#把光标放在该属性，ctrl+b 就可以定位该配置映射到的类</span></span><br><span class="line"><span class="attr">spring.servlet.multipart.max-file-size</span>=<span class="string">10MB</span></span><br></pre></td></tr></table></figure><p>常用配置</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#端口号</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">10000</span></span><br><span class="line"><span class="comment">#应用的上下文路径(项目路径)</span></span><br><span class="line"><span class="attr">server.servlet.context-path</span>=<span class="string">/allModel</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.cxs.allmodel.model</span></span><br><span class="line"><span class="comment">#指定 mapper.xml 的路径</span></span><br><span class="line"><span class="comment">#(application 上配置了@MapperScan(扫面 mapper 类的路径)和 pom.xml 中放行了mapper.xml 后，# 配 置 mapper-locations 没 有 意 义 。 如 果 mapper 类 和 mapper.xml 不 在 同 一个路径下时，mapper-locations 就有用了)</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:com/cxs/allmodel/mapper</span></span><br><span class="line"><span class="comment">#session 失效时间(单位 s)</span></span><br><span class="line"><span class="attr">spring.session.timeout</span>=<span class="string">18000</span></span><br><span class="line"><span class="comment">#数据库连接配置</span></span><br><span class="line"><span class="comment">#mysql 数据库 url</span></span><br><span class="line"><span class="attr">mysql.one.jdbc-url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/test?serverTimezone=Asia/Shanghai&amp;useSSL=false</span></span><br><span class="line"><span class="comment">#mysql 数据库用户名</span></span><br><span class="line"><span class="attr">mysql.one.username</span>=<span class="string"></span></span><br><span class="line"><span class="comment">#数据库密码</span></span><br><span class="line"><span class="attr">mysql.one.password</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">mysql.one.maximum-pool-size</span>=<span class="string">15</span></span><br><span class="line"><span class="comment">#日志打印:日志级别 trace&lt;debug&lt;info&lt;warn&lt;error&lt;fatal 默认级别为 info，即默认打印info 及其以上级别的日志</span></span><br><span class="line"><span class="comment">#logging.level 设置日志级别，后面跟生效的区域，比如 root 表示整个项目，也可以设置为某个包下，也可以具体到某个类名（日志级别的值不区分大小写）</span></span><br><span class="line"><span class="attr">logging.level.com.cxs.allmodel.</span>=<span class="string">debug</span></span><br><span class="line"><span class="attr">logging.level.com.cxs.allmodel.mapper</span>=<span class="string">debug</span></span><br><span class="line"><span class="attr">logging.level.org.springframework.web</span>=<span class="string">info</span></span><br><span class="line"><span class="attr">logging.level.org.springframework.transaction</span>=<span class="string">info</span></span><br><span class="line"><span class="attr">logging.level.org.apache.ibatis</span>=<span class="string">info</span></span><br><span class="line"><span class="attr">logging.level.org.mybatis</span>=<span class="string">info</span></span><br><span class="line"><span class="attr">logging.level.com.github.pagehelper</span> = <span class="string">info</span></span><br><span class="line"><span class="attr">logging.level.root</span>=<span class="string">info</span></span><br><span class="line"><span class="comment">#日志输出路径</span></span><br><span class="line"><span class="attr">logging.file</span>=<span class="string">/tmp/api/allmodel.log</span></span><br><span class="line"><span class="comment">#配置 pagehelper 分页插件</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pagehelper.reasonable</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">pagehelper.supportMethodsArguments</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">pagehelper.params</span>=<span class="string">count=countSql</span></span><br><span class="line"><span class="comment">#jackson 时间格式化</span></span><br><span class="line"><span class="attr">spring.jackson.serialization.fail-on-empty-beans</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#指定日期格式，比如 yyyy-MM-dd HH:mm:ss，或者具体的格式化类的全限定名</span></span><br><span class="line"><span class="attr">spring.jackson.date-format</span>=<span class="string">yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment">#指定日期格式化时区，比如 America/Los_Angeles 或者 GMT+10</span></span><br><span class="line"><span class="attr">spring.jackson.time-zone</span>=<span class="string">GMT+8</span></span><br><span class="line"><span class="comment">#设置统一字符集</span></span><br><span class="line"><span class="attr">spring.http.encoding.charset</span>=<span class="string">utf8</span></span><br><span class="line"><span class="comment">#redis 连接配置</span></span><br><span class="line"><span class="comment"># redis 所在主机 ip 地址</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string"></span></span><br><span class="line"><span class="comment">#redis 服务器密码</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#redis 服务器端口号</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string"></span></span><br><span class="line"><span class="comment">#redis 数据库的索引编号(0 到 15)</span></span><br><span class="line"><span class="attr">spring.redis.database</span>=<span class="string">14</span></span><br><span class="line"><span class="comment">## 连接池的最大活动连接数量，使用负值无限制</span></span><br><span class="line"><span class="comment">#spring.redis.pool.max-active=8</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## 连接池的最大空闲连接数量，使用负值表示无限数量的空闲连接</span></span><br><span class="line"><span class="comment">#spring.redis.pool.max-idle=8</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## 连接池最大阻塞等待时间，使用负值表示没有限制</span></span><br><span class="line"><span class="comment">#spring.redis.pool.max-wait=-1ms</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## 最小空闲连接数量，使用正值才有效果</span></span><br><span class="line"><span class="comment">#spring.redis.pool.min-idle=0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## 是否启用 SSL 连接. ##spring.redis.ssl=false</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## 连接超时，毫秒为单位</span></span><br><span class="line"><span class="comment">#spring.redis.timeout= 18000ms</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## 集群模式下，集群最大转发的数量</span></span><br><span class="line"><span class="comment">#spring.redis.cluster.max-redirects=</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## 集群模式下，逗号分隔的键值对（主机：端口）形式的服务器列表</span></span><br><span class="line"><span class="comment">#spring.redis.cluster.nodes=</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## 哨兵模式下，Redis 主服务器地址</span></span><br><span class="line"><span class="comment">#spring.redis.sentinel.master=</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## 哨兵模式下，逗号分隔的键值对（主机：端口）形式的服务器列表</span></span><br><span class="line"><span class="comment">#spring.redis.sentinel.nodes= 127.0.0.1:5050,127.0.0.1:5060</span></span><br></pre></td></tr></table></figure><p>自定义配置</p><p>● 还可以在 properties 文件中自定义配置，通过@Value(“${}”)获取对应属性值</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># application.properties 文件</span></span><br><span class="line"><span class="attr">my.website</span>=<span class="string">https://www.baidu.com</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//某个 Bean</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;my.website&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String bdUrl;</span><br></pre></td></tr></table></figure><p>SpringBoot 在哪配置读取 application.properites?打开 ConfigFileApplicationListener.java , 看一下源码</p><p><img src="springboot%E5%AD%A6%E4%B9%A0%5C10.jpg"></p><p>满足DEFAULT_SEARCH_LOCATIONS中的所有路径就可以了</p><h3 id="2-3-4-spring-boot-autoconfigure"><a href="#2-3-4-spring-boot-autoconfigure" class="headerlink" title="2.3.4 spring-boot-autoconfigure"></a>2.3.4 spring-boot-autoconfigure</h3><p>SpringBoot 所 有 的 自 动 配 置 功 能 都 在 spring-boot-autoconfigure 包</p><p>在 SpringBoot 的 自 动 配 置 包 , 一 般 是 XxxAutoConfiguration.java, 对应XxxxProperties.java</p><h1 id="3-容器功能"><a href="#3-容器功能" class="headerlink" title="3 容器功能"></a>3 容器功能</h1><h2 id="3-1-Spring-注入组件的注解"><a href="#3-1-Spring-注入组件的注解" class="headerlink" title="3.1 Spring 注入组件的注解"></a>3.1 Spring 注入组件的注解</h2><h3 id="3-1-1-Component、-Controller、-Service、-Repository"><a href="#3-1-1-Component、-Controller、-Service、-Repository" class="headerlink" title="3.1.1 @Component、@Controller、 @Service、@Repository"></a>3.1.1 @Component、@Controller、 @Service、@Repository</h3><p>这些在 Spring 中的传统注解仍然有效，通过这些注解可以给容器注入组件</p><h2 id="3-2-Configuration"><a href="#3-2-Configuration" class="headerlink" title="3.2 @Configuration"></a>3.2 @Configuration</h2><h3 id="3-2-1-应用实例"><a href="#3-2-1-应用实例" class="headerlink" title="3.2.1 应用实例"></a>3.2.1 应用实例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@Configuration 标识这是一个配置类: 等价 配置文件</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig</span> &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 1. <span class="doctag">@Bean</span> : 给容器中添加组件</span></span><br><span class="line"><span class="comment">* 2. monster01() : 默认方法名作为组件的 id</span></span><br><span class="line"><span class="comment">* 3. Monster: 返回类型就是组件类型, 返回的值就是 new Monster(100, &quot;牛魔王&quot;, 500, &quot;芭蕉扇&quot;)</span></span><br><span class="line"><span class="comment">* 4. <span class="doctag">@Bean</span>(&quot;monster_nmw&quot;): 重新指定组件的 id = “monster_nmw”</span></span><br><span class="line"><span class="comment">* 5. 配置类里面使用<span class="doctag">@Bean</span> 标注在方法上给容器注册组件，默认是单实例的*/</span></span><br><span class="line"><span class="comment">// @Bean(&quot;monster_nmw&quot;)</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Monster <span class="title function_">monster01</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">100</span>, <span class="string">&quot;牛魔王&quot;</span>, <span class="number">500</span>, <span class="string">&quot;芭蕉扇&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改 MainApp.java , 从配置文件&#x2F;容器获取 bean , 并完成测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//启动 SpringBoot 应用程序</span></span><br><span class="line"><span class="type">ConfigurableApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span></span><br><span class="line">SpringApplication.run(MainApp.class, args);</span><br><span class="line"><span class="comment">// //查看容器里面的组件</span></span><br><span class="line"><span class="comment">// String[] beanDefinitionNames = ioc.getBeanDefinitionNames();</span></span><br><span class="line"><span class="comment">// for (String beanDefinitionName : beanDefinitionNames) &#123;</span></span><br><span class="line"><span class="comment">// System.out.println(beanDefinitionName);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1. ioc.getBean(&quot;monster01&quot;, Monster.class) 是从 BeanConfig 配置类/容器获取bean实例</span></span><br><span class="line"><span class="comment">//2. 默认是单列模式, 所以 monster01 == monster02</span></span><br><span class="line"><span class="comment">//获取 BeanConfig 配置类的组件/bean 实例</span></span><br><span class="line"><span class="type">Monster</span> <span class="variable">monster01</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster01&quot;</span>, Monster.class);</span><br><span class="line">System.out.println(monster01);</span><br><span class="line"><span class="type">Monster</span> <span class="variable">monster02</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster01&quot;</span>, Monster.class);</span><br><span class="line">System.out.println(monster01 == monster02);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-2-Configuration-注意事项和细节"><a href="#3-2-2-Configuration-注意事项和细节" class="headerlink" title="3.2.2 @Configuration 注意事项和细节"></a>3.2.2 @Configuration 注意事项和细节</h3><ol><li>配置类本身也是组件， 因此也可以获取, 测试 修改</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">ConfigurableApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span></span><br><span class="line">SpringApplication.run(MainApp.class, args);</span><br><span class="line"></span><br><span class="line"><span class="comment">//1. ioc.getBean(&quot;monster01&quot;, Monster.class) 是从 BeanConfig 配置类/容器获取bean实例//2. 默认是单列模式, 所以 monster01 == monster02</span></span><br><span class="line"><span class="comment">//获取 BeanConfig 配置类的组件/bean 实例</span></span><br><span class="line"><span class="type">Monster</span> <span class="variable">monster01</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster01&quot;</span>, Monster.class);</span><br><span class="line">System.out.println(monster01);</span><br><span class="line">韩顺平Java 工程师<span class="type">Monster</span> <span class="variable">monster02</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster01&quot;</span>, Monster.class);</span><br><span class="line">System.out.println(monster01 == monster02);</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置类本身也是组件， 因此也可以获取</span></span><br><span class="line"><span class="type">BeanConfig</span> <span class="variable">beanConfig</span> <span class="operator">=</span> ioc.getBean(BeanConfig.class);</span><br><span class="line">System.out.println(<span class="string">&quot;beanConfig= &quot;</span> + beanConfig);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2.SpringBoot2 新增特性： proxyBeanMethods 指定 Full 模式和Lite 模式</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> wzb</span></span><br><span class="line"><span class="comment">* 1. proxyBeanMethods：代理 bean 的方法</span></span><br><span class="line"><span class="comment">* (1) Full(proxyBeanMethods = true)、【保证每个<span class="doctag">@Bean</span> 方法被调用多少次返回的组件都是单实例的, 是代理方式】</span></span><br><span class="line"><span class="comment">* (2) Lite(proxyBeanMethods = false)【每个<span class="doctag">@Bean</span> 方法被调用多少次返回的组件都是新创建的, 是非代理方式】</span></span><br><span class="line"><span class="comment">* (3) 特别说明: proxyBeanMethods 是在 调用<span class="doctag">@Bean</span> 方法 才生效，因此，需要先获取BeanConfig 组件，再调用方法</span></span><br><span class="line"><span class="comment">* 而不是直接通过 SpringBoot 主程序得到的容器来获取bean, 注意观察直接通过ioc.getBean() 获取 Bean, proxyBeanMethods 值并没有生效</span></span><br><span class="line"><span class="comment">* (4) 如何选择: 组件依赖必须使用 Full 模式默认。如果不需要组件依赖使用Lite 模* (5) Lite 模 也称为轻量级模式，因为不检测依赖关系，运行速度快*/</span></span><br><span class="line"><span class="comment">//@Configuration 标识这是一个配置类: 等价 配置文件</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig</span> &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 1. <span class="doctag">@Bean</span> : 给容器中添加组件</span></span><br><span class="line"><span class="comment">* 2. monster01() : 默认方法名作为组件的 id</span></span><br><span class="line"><span class="comment">* 3. Monster: 返回类型就是组件类型, 返回的值就是 new Monster(100, &quot;牛魔王&quot;, 500, &quot;芭蕉扇&quot;)</span></span><br><span class="line"><span class="comment"> 4. <span class="doctag">@Bean</span>(&quot;monster_nmw&quot;): 重新指定组件的 id = “monster_nmw” * 5. 配置类里面使用<span class="doctag">@Bean</span> 标注在方法上给容器注册组件，默认是单实例的*/</span></span><br><span class="line"><span class="comment">// @Bean(&quot;monster_nmw&quot;)</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Monster <span class="title function_">monster01</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">100</span>, <span class="string">&quot;牛魔王&quot;</span>, <span class="number">500</span>, <span class="string">&quot;芭蕉扇&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.hspedu.springboot;</span><br><span class="line"><span class="keyword">import</span> com.hspedu.springboot.bean.Monster;</span><br><span class="line"><span class="keyword">import</span> com.hspedu.springboot.config.BeanConfig;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &quot;com.hspedu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//启动 SpringBoot 应用程序</span></span><br><span class="line"><span class="type">ConfigurableApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span></span><br><span class="line">SpringApplication.run(MainApp.class, args);</span><br><span class="line"><span class="comment">// //查看容器里面的组件</span></span><br><span class="line"><span class="comment">// String[] beanDefinitionNames = ioc.getBeanDefinitionNames();</span></span><br><span class="line"><span class="comment">// for (String beanDefinitionName : beanDefinitionNames) &#123;</span></span><br><span class="line"><span class="comment">// System.out.println(beanDefinitionName);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1. ioc.getBean(&quot;monster01&quot;, Monster.class) 是从 BeanConfig 配置类/容器获取bean实例</span></span><br><span class="line"><span class="comment">//2. 默认是单列模式, 所以 monster01 == monster02</span></span><br><span class="line"><span class="comment">//获取 BeanConfig 配置类的组件/bean 实例</span></span><br><span class="line"><span class="type">Monster</span> <span class="variable">monster01</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster01&quot;</span>, Monster.class);</span><br><span class="line">System.out.println(monster01);</span><br><span class="line"><span class="type">Monster</span> <span class="variable">monster02</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster01&quot;</span>, Monster.class);</span><br><span class="line">System.out.println(monster01 == monster02);</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置类本身也是组件， 因此也可以获取</span></span><br><span class="line"><span class="type">BeanConfig</span> <span class="variable">beanConfig</span> <span class="operator">=</span> ioc.getBean(BeanConfig.class);</span><br><span class="line">System.out.println(<span class="string">&quot;beanConfig= &quot;</span> + beanConfig);</span><br><span class="line"><span class="type">Monster</span> <span class="variable">monster03</span> <span class="operator">=</span> beanConfig.monster01();</span><br><span class="line"><span class="type">Monster</span> <span class="variable">monster04</span> <span class="operator">=</span> beanConfig.monster01();</span><br><span class="line">System.out.println(<span class="string">&quot;monster03 == monster04 : &quot;</span> + (monster03 == monster04));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-3-Import"><a href="#3-3-Import" class="headerlink" title="3.3 @Import"></a>3.3 @Import</h2><p>@Import 方式注入的组件, 默认组件的名字就是全类名</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;Dog.class, Cat.class&#125;)</span></span><br><span class="line"><span class="comment">// @Configuration//标识这是一个配置类: 等价 配置文件</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-4-Conditional"><a href="#3-4-Conditional" class="headerlink" title="3.4 @Conditional"></a>3.4 @Conditional</h2><h3 id="3-4-1-Conditional-介绍"><a href="#3-4-1-Conditional-介绍" class="headerlink" title="3.4.1 @Conditional 介绍"></a>3.4.1 @Conditional 介绍</h3><p>​1. 条件装配：满足 Conditional 指定的条件，则进行组件注入</p><ol start="2"><li>@Conditional 是一个根注解，下面有很多扩展注解</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//@ConditionalOnBean(name=&quot;monster02&quot;) 如果是在类中，代表所有的Bean都满足条件，需要monster02这个Bean存在于spring容器中</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig2</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Monster <span class="title function_">monster02</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="string">&quot;小怪兽&quot;</span>, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建Dog对象，并返回给容器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ConditionalOnBean</span>(name=&quot;monster02&quot;)当容器中有 monster02 Bean时，就注入dog01这个bean</span></span><br><span class="line"><span class="comment">     *     <span class="doctag">@ConditionalOnMissingBean</span>,在容器中没有 monster02 Bean时，就注入dog01这个bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(name=&quot;monster02&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">dog01</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&quot;小狗&quot;</span>, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-5-ImportResource"><a href="#3-5-ImportResource" class="headerlink" title="3.5 @ImportResource"></a>3.5 @ImportResource</h2><p>作用：原生配置文件引入, 也就是可以直接导入 Spring 传统的beans.xml ，可以认为是 SpringBoot 对 Spring 容器文件的兼容</p><p>将 beans.xml 导入到 BeanConfig.java 配置类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wzb</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 可以获取beans.xml中的bean</span></span><br><span class="line"><span class="meta">@ImportResource(&quot;classpath:beans.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig3</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-6-配置绑定"><a href="#3-6-配置绑定" class="headerlink" title="3.6 配置绑定"></a>3.6 配置绑定</h2><p>一句话：使用 Java 读取到 SpringBoot 核心配置文件 application.properties 的内容，并且把它封装到 JavaBean 中</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 1. <span class="doctag">@Component</span> 将 Furn 注册为一个组件</span></span><br><span class="line"><span class="comment">* 2. <span class="doctag">@ConfigurationProperties</span>(prefix = &quot;furn01&quot;) 指定在 application.properties 前缀* 这样 Furn 组件就会属性文件中的 值绑定了</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;furn01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Furn</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> Double price;</span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Double <span class="title function_">getPrice</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> price;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(Double price)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.price = price;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3. 修改 HelloController.java</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">package</span> com.hspedu.springboot.controller;</span><br><span class="line"><span class="keyword">import</span> com.hspedu.springboot.bean.Furn;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;hello, spring boot&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Furn furn;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/furn&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Furn <span class="title function_">furn</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> furn;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置绑定还有第 2 种方式,效果一样，注意: 注销@Component 需 要 在 BeanConfig.java( 也可以是其它配置类) 配置@EnableConfigurationProperties(Furn.class), 否则会提示错误</p><p><img src="springboot%E5%AD%A6%E4%B9%A0%5C11.jpg"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@EnableConfigurationProperties(Furn.class)解读</span></span><br><span class="line"><span class="comment">//1、开启 Furn 配置绑定功能</span></span><br><span class="line"><span class="comment">//2、把 Furn 组件自动注册到容器中</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(Furn.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig</span> &#123;</span><br></pre></td></tr></table></figure><h1 id="4-Lombok"><a href="#4-Lombok" class="headerlink" title="4 Lombok"></a>4 Lombok</h1><h2 id="4-1-Lomkbok的作用"><a href="#4-1-Lomkbok的作用" class="headerlink" title="4.1 Lomkbok的作用"></a>4.1 Lomkbok的作用</h2><ol><li>简化 JavaBean 开发, 可以使用 Lombok 的注解让代码更加简洁</li><li>Java 项目中，很多没有技术含量又必须存在的代码：POJO 的getter&#x2F;setter&#x2F;toString；异常处理；I&#x2F;O 流的关闭操作等等，这些代码既没有技术含量，又影响着代码的美观，Lombok应运而生</li></ol><h2 id="4-2-Lomkbok常用注解"><a href="#4-2-Lomkbok常用注解" class="headerlink" title="4.2 Lomkbok常用注解"></a>4.2 Lomkbok常用注解</h2><ul><li><code>@Data</code>: 注解在类上;提供类所有属性的 aetting 和 seting 方法，此外还提供了equals、canEaual、hashCode、toString方法</li><li><code>@Setter</code>:注解在属性上;为属性提供 setting 方法</li><li><code>@Gettter</code> :注解在属性上;为属性提供 getting 方法</li><li><code>@Log4j</code>:注解在类上;为类提供一个 属性名为log 的 log4j日志对象</li><li><code>@NoArgsConstructor</code>:注解在类上;为类提供一个无参的构造方法</li><li><code>@AllArgsConstructor</code>:注解在类上;为类提供一个全参的构造方法</li><li><code>@Cleanup</code>:可以关闭流</li><li><code>@Builder</code>: 被注解的类加个构造者模式</li><li><code>@Synchronized</code> :加个同步锁</li><li><code>@SneakyThrows</code>:等同于try&#x2F;catch 捕获异常</li><li><code>@NonNull</code>:如果给参数加个这个注解 参数为null会抛出空指针异常</li><li><code>@Value</code>:注解和@Data类似，区别在于它会把所有成员变量默认定义为private final修饰，并且不会生成set方法。</li></ul><h2 id="4-3-Lombok应用"><a href="#4-3-Lombok应用" class="headerlink" title="4.3 Lombok应用"></a>4.3 Lombok应用</h2><p>在 pom.xml 引入 lombok，springboot会自动引入该依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引 入 lombok, 版 本 在 spring-boot-dependencies-2.5.3.pom指定了, 把光标放在lombok ctrl+b 可以看到--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@ToString : lombok 注解, 会在编译时生成 toString()</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="comment">//@Data: lombok 注解, 会在编译时生成 setter / getter</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">//@NoArgsConstructor:lombok 注解, 会在编译时生成无参构造器@NoArgsConstructor</span></span><br><span class="line"><span class="comment">//@AllArgsConstructor: lombok 注解, 会在编译时生成全参构造器@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;furn01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Furn</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> Double price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>支持日志输出，建议使用@Slf4j</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;hello, spring boot&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Furn furn;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/furn&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Furn <span class="title function_">furn</span><span class="params">()</span> &#123;</span><br><span class="line">log.info(<span class="string">&quot;furn = &quot;</span> + furn);</span><br><span class="line"><span class="comment">//占位用法</span></span><br><span class="line">log.info(<span class="string">&quot;furn = &#123;&#125; &quot;</span>, furn);</span><br><span class="line"><span class="keyword">return</span> furn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-yaml"><a href="#5-yaml" class="headerlink" title="5 yaml"></a>5 yaml</h1><h2 id="5-1-yaml介绍"><a href="#5-1-yaml介绍" class="headerlink" title="5.1 yaml介绍"></a>5.1 yaml介绍</h2><p>1、YAML 以数据做为中心，而不是以标记语言为重点</p><p>2、YAML 仍然是一种标记语言, 但是和传统的标记语言不一样, 是以数据为中心的标记语言.</p><p>3、YAML 非常适合用来做以数据为中心的配置文件 [springboot : application.yml]</p><h2 id="5-2-yaml基本语法"><a href="#5-2-yaml基本语法" class="headerlink" title="5.2 yaml基本语法"></a>5.2 yaml基本语法</h2><ol><li>形式为 key: value；注意: 后面有空格 </li><li>区分大小写 </li><li>使用缩进表示层级关系 </li><li>缩进不允许使用 tab，只允许空格 [有些地方也识别 tab , 推荐使用空格] </li><li>缩进的空格数不重要，只要相同层级的元素左对齐即可 </li><li>字符串无需加引号</li><li>yml 中, 注释使用 #</li></ol><h2 id="5-3-数据类型"><a href="#5-3-数据类型" class="headerlink" title="5.3 数据类型"></a>5.3 数据类型</h2><h3 id="5-3-1-字面量"><a href="#5-3-1-字面量" class="headerlink" title="5.3.1 字面量"></a>5.3.1 字面量</h3><p>字面量：单个的、不可再分的值。date、boolean、string、number、null</p><p>保存形式为 key: value</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">monster:</span></span><br><span class="line"><span class="attr">id:</span> <span class="number">100</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">age:</span> <span class="number">50</span></span><br></pre></td></tr></table></figure><h3 id="5-3-2-对象"><a href="#5-3-2-对象" class="headerlink" title="5.3.2 对象"></a>5.3.2 对象</h3><p>对象：键值对的集合, 比如 map、hash、set、object</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 行内写法： k: &#123;k1:v1,k2:v2,k3:v3&#125;</span></span><br><span class="line"><span class="attr">monster:</span> &#123;<span class="attr">id:</span> <span class="number">100</span>,<span class="attr">name:</span> <span class="string">牛魔王</span>&#125;</span><br><span class="line"><span class="comment">#或换行形式</span></span><br><span class="line"><span class="attr">k:</span></span><br><span class="line"><span class="attr">k1:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">k2:</span> <span class="string">v2</span></span><br><span class="line"><span class="attr">k3:</span> <span class="string">v3</span></span><br><span class="line"><span class="attr">monster:</span> <span class="comment"># 可以是对象</span></span><br><span class="line">    <span class="attr">id:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">牛魔王</span></span><br><span class="line"><span class="attr">skill:</span> <span class="comment"># 可以是String[]或者List&lt;String&gt;</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">飞</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">跑</span></span><br><span class="line"><span class="attr">hobby:</span> [<span class="string">喝酒，吃肉</span>]</span><br><span class="line"><span class="attr">brand:</span> &#123;<span class="attr">key01:</span> <span class="string">小米</span>,<span class="attr">key02:</span> <span class="string">比亚迪</span> &#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-3-数组"><a href="#5-3-3-数组" class="headerlink" title="5.3.3 数组"></a>5.3.3 数组</h3><p>数组：一组按次序排列的值, 比如 array、list、queue</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">行内写法：</span> <span class="attr">k:</span> [<span class="string">v1</span>,<span class="string">v2</span>,<span class="string">v3</span>]</span><br><span class="line"><span class="attr">hobby:</span> [<span class="string">打篮球</span>, <span class="string">打乒乓球</span>, <span class="string">踢足球</span>]</span><br><span class="line"><span class="comment">#或者换行格式</span></span><br><span class="line"><span class="attr">k:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">v3</span></span><br><span class="line"><span class="attr">hobby:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">打篮球</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">打乒乓球</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">踢足球</span></span><br></pre></td></tr></table></figure><h2 id="5-4-yaml-使用细节"><a href="#5-4-yaml-使用细节" class="headerlink" title="5.4 yaml 使用细节"></a>5.4 yaml 使用细节</h2><p>如 果 application.properties 和 application.yaml 有 相同的前缀值绑定，则application.properties 优先级高, 开发时，应当避免</p><h1 id="6-静态资源访问"><a href="#6-静态资源访问" class="headerlink" title="6 静态资源访问"></a>6 静态资源访问</h1><h3 id="6-1-基本介绍"><a href="#6-1-基本介绍" class="headerlink" title="6.1 基本介绍"></a>6.1 基本介绍</h3><p>只要静态资源放在类路径下： &#x2F;static 、 &#x2F;public 、 &#x2F;resources 、&#x2F;META-INF&#x2F;resources可以被直接访问- 对应文件 WebProperties.java</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS=&#123; <span class="string">&quot;classpath:/META-INF/resources/&quot;</span>, <span class="string">&quot;classpath:/resources/&quot;</span>, <span class="string">&quot;classpath:/static/&quot;</span>, <span class="string">&quot;classpath:/public/&quot;</span> &#125;;</span><br></pre></td></tr></table></figure><p>常见静态资源：JS、CSS 、图片（.jpg .png .gif .bmp .svg）、字体文件(Fonts)等</p><p>访问方式 ：默认: 项目根路径&#x2F; + 静态资源名 比如 <code>http://localhost:8080/hi.jpg .</code> </p><h3 id="6-2-使用注意"><a href="#6-2-使用注意" class="headerlink" title="6.2 使用注意"></a>6.2 使用注意</h3><p>问题：静态资源访问原理：静态映射是 &#x2F;** , 也就是对所有请求拦截，请求进来，先看Controller能不能处理，不能处理的请求交给静态资源处理器，如果静态资源找不到则响应404页面</p><p>改变静态资源访问前缀，比如我们希望 <code>http://localhost:8080/wzb/*</code> 去请求静态资源, 应用场景：静态资源访问前缀和控制器请求路径冲突</p><p>需要在配置文件中配置</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">mvc:</span></span><br><span class="line"><span class="attr">static-path-pattern:</span> <span class="string">/wzb/**</span></span><br></pre></td></tr></table></figure><p>改变默认的静态资源路径，比如希望在类路径下增加 wzbimg 目录作为静态资源路径, 也就是希望resources目录下可以访问wzbimg中的资源</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">mvc:</span></span><br><span class="line"><span class="attr">static-path-pattern:</span> <span class="string">/hspres/**</span></span><br><span class="line"><span class="attr">web:</span></span><br><span class="line"><span class="attr">resources:</span></span><br><span class="line"><span class="attr">static-locations:</span> [<span class="string">classpath:/wzbimg/</span>, <span class="string">classpath:/public/</span>, <span class="string">classpath:/static/</span>] <span class="comment"># 必须把public static目录带上，否则原来等等静态目录访问不上</span></span><br></pre></td></tr></table></figure><h1 id="7-Rest风格请求处理"><a href="#7-Rest风格请求处理" class="headerlink" title="7 Rest风格请求处理"></a>7 Rest风格请求处理</h1><h2 id="7-1-基本介绍"><a href="#7-1-基本介绍" class="headerlink" title="7.1 基本介绍"></a>7.1 基本介绍</h2><p>Rest 风格支持（使用 HTTP 请求方式动词来表示对资源的操作）</p><p>举例说明： </p><p>● 请求方式: &#x2F;monster </p><p>● GET-获取怪物 </p><p>● DELETE-删除怪物 </p><p>● PUT-修改怪物 </p><p>● POST-保存妖怪</p><p>7.2 应用实例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonsterController</span> &#123;</span><br><span class="line"><span class="comment">// @RequestMapping(value = &quot;/monster&quot;,method = RequestMethod.GET)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/monster&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getMonster</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;GET-查询妖怪&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @RequestMapping(value = &quot;/monster&quot;,method = RequestMethod.POST)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/monster&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">saveMonster</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;POST-添加妖怪&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @RequestMapping(value = &quot;/monster&quot;,method = RequestMethod.PUT)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/monster&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">putMonster</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;PUT-修改妖怪&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/monster&quot;)</span></span><br><span class="line"><span class="comment">// @RequestMapping(value = &quot;/monster&quot;,method = RequestMethod.DELETE)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">deleteMonster</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;DELETE-删除妖怪&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-2-注意事项和细节"><a href="#7-2-注意事项和细节" class="headerlink" title="7.2 注意事项和细节"></a>7.2 注意事项和细节</h2><p>1、客户端是 PostMan 可以直接发送 Put、delete 等方式请求，可不设置Filter </p><p>2、如果要 SpringBoot 支持 页面表单的 Rest 功能, 则需要注意如下细节</p><ul><li>Rest 风 格 请 求 核 心 Filter ； HiddenHttpMethodFilter ，表单请求会被HiddenHttpMethodFilter 拦截 , 获取到表单 _method 的值，再判断是PUT&#x2F;DELETE&#x2F;PATCH(注释: PATCH 方法是新引入的，是对 PUT 方法的补充，用来对已知资源进行局部更新) </li><li>如果要 SpringBoot 支持 页面表单的 Rest 功能, 需要在 application.yml 启用filter 功能, 否则无效 </li><li>修改 application.yml 启用 filter 功能</li></ul><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line"><span class="attr">mvc</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">static-path-pattern</span>: <span class="string">/wzb/**</span></span><br><span class="line">    <span class="attr">hiddenmethod</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">filter</span>:<span class="string"></span></span><br><span class="line"><span class="attr">enabled</span>: <span class="string">true #开启页面表单的 Rest 功能</span></span><br></pre></td></tr></table></figure><p>3、 @ResController 是一个复合注解, 含有@ResponseBody, 所以springboot 底层(springmvc), 在处理，如果单纯用@Controller注解，就不会返回数据给客户端，而是找视图解析器处理，比如return “test”，就会找<code>test.html</code>静态页面</p><p>解决方法：如果已经有了对应的test.html，可以在配置文件进行配置，返回“test”字符串也可以找到页面</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  mvc:</span><br><span class="line">    <span class="keyword">static</span>-path-pattern: /wzb<span class="comment">/**</span></span><br><span class="line"><span class="comment">    hiddenmethod:</span></span><br><span class="line"><span class="comment">      filter:</span></span><br><span class="line"><span class="comment">    enabled: true #开启页面表单的 Rest 功能</span></span><br><span class="line"><span class="comment">    view:</span></span><br><span class="line"><span class="comment">      prefix: / # 找根路径</span></span><br><span class="line"><span class="comment">      suffix: .html # 结尾是以.html结尾</span></span><br></pre></td></tr></table></figure><h1 id="8-接收参数相关注解"><a href="#8-接收参数相关注解" class="headerlink" title="8 接收参数相关注解"></a>8 接收参数相关注解</h1><h2 id="8-1-基本介绍"><a href="#8-1-基本介绍" class="headerlink" title="8.1 基本介绍"></a>8.1 基本介绍</h2><h3 id="1-PathVariable"><a href="#1-PathVariable" class="headerlink" title="1. @PathVariable"></a>1. @PathVariable</h3><p>作用：从URL路径中提取变量值。</p><p>使用示例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 基本使用</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 指定名称</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;userId&#125;/orders/&#123;orderId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">getOrder</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> Long uid, </span></span><br><span class="line"><span class="params">                         <span class="meta">@PathVariable(&quot;orderId&quot;)</span> Long oid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderService.findOrder(uid, oid);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用正则表达式</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;name:[a-z-]+&#125;-&#123;version:\\d\\.\\d\\.\\d&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getVersion</span><span class="params">(<span class="meta">@PathVariable</span> String name, </span></span><br><span class="line"><span class="params">                            <span class="meta">@PathVariable</span> String version)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">&quot;:&quot;</span> + version;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取所有路径变量</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;type&#125;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getAllPathVariables</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Map&lt;String, String&gt; pathVars)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pathVars;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-RequestHeader"><a href="#2-RequestHeader" class="headerlink" title="2. @RequestHeader"></a>2. @RequestHeader</h3><p>作用：从HTTP请求头中提取值。</p><p>使用示例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeaderController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取单个请求头</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/header&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHeader</span><span class="params">(<span class="meta">@RequestHeader(&quot;User-Agent&quot;)</span> String userAgent)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User-Agent: &quot;</span> + userAgent;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置默认值</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/language&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getLanguage</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader(value = &quot;Accept-Language&quot;, defaultValue = &quot;zh-CN&quot;)</span> String lang)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Language: &quot;</span> + lang;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取数值类型的请求头</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/content-length&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContentLength</span><span class="params">(<span class="meta">@RequestHeader(&quot;Content-Length&quot;)</span> <span class="type">long</span> contentLength)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Content-Length: &quot;</span> + contentLength;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取所有请求头</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/all-headers&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getAllHeaders</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader</span> Map&lt;String, String&gt; headers)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> headers;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取多值请求头</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/multi-header&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getMultiValueHeader</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader(&quot;Accept&quot;)</span> List&lt;String&gt; acceptHeaders)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> acceptHeaders;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ModelAttribute"><a href="#3-ModelAttribute" class="headerlink" title="3. @ModelAttribute"></a>3. @ModelAttribute</h3><p>作用：将请求参数绑定到模型对象。</p><p>使用示例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModelController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自动绑定到对象</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createUser</span><span class="params">(<span class="meta">@ModelAttribute</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User: &quot;</span> + user.getName() + <span class="string">&quot;, Age: &quot;</span> + user.getAge();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 在方法级别使用，为所有请求添加公共属性</span></span><br><span class="line">    <span class="meta">@ModelAttribute</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCommonAttributes</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;currentTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自定义属性名</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/product&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getProduct</span><span class="params">(<span class="meta">@ModelAttribute(&quot;prod&quot;)</span> Product product)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> product.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对应的实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造方法、getter、setter</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, Integer age, String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getter和setter方法</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123; <span class="keyword">return</span> name; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123; <span class="built_in">this</span>.name = name; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getAge</span><span class="params">()</span> &#123; <span class="keyword">return</span> age; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Integer age)</span> &#123; <span class="built_in">this</span>.age = age; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmail</span><span class="params">()</span> &#123; <span class="keyword">return</span> email; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmail</span><span class="params">(String email)</span> &#123; <span class="built_in">this</span>.email = email; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-RequestParam"><a href="#4-RequestParam" class="headerlink" title="4. @RequestParam"></a>4. @RequestParam</h3><p>作用：从URL查询参数或表单数据中提取值。</p><p>使用示例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParamController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 基本使用</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">search</span><span class="params">(<span class="meta">@RequestParam</span> String keyword)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Searching for: &quot;</span> + keyword;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 指定参数名和默认值</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPage</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;page&quot;, defaultValue = &quot;1&quot;)</span> <span class="type">int</span> page,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(value = &quot;size&quot;, defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;Page: %d, Size: %d&quot;</span>, page, size);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可选参数</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/optional&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">optionalParam</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> String filter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> filter != <span class="literal">null</span> ? <span class="string">&quot;Filter: &quot;</span> + filter : <span class="string">&quot;No filter&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取所有参数</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/all-params&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getAllParams</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> Map&lt;String, String&gt; allParams)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> allParams;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 多值参数</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/multi&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getMultiParams</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;String&gt; tags)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tags;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理数组参数</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/array&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String[] getArrayParams(<span class="meta">@RequestParam</span> String[] ids) &#123;</span><br><span class="line">        <span class="keyword">return</span> ids;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-MatrixVariable"><a href="#5-MatrixVariable" class="headerlink" title="5. @MatrixVariable"></a>5. @MatrixVariable</h3><p>作用：从URL路径的矩阵变量中提取值（需要额外配置）。</p><p>配置和使用示例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;</span><br><span class="line">        <span class="type">UrlPathHelper</span> <span class="variable">urlPathHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlPathHelper</span>();</span><br><span class="line">        urlPathHelper.setRemoveSemicolonContent(<span class="literal">false</span>);</span><br><span class="line">        configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MatrixController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 基本矩阵变量</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/cars/&#123;car&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCar</span><span class="params">(<span class="meta">@PathVariable</span> String car,</span></span><br><span class="line"><span class="params">                        <span class="meta">@MatrixVariable</span> String color,</span></span><br><span class="line"><span class="params">                        <span class="meta">@MatrixVariable</span> String year)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;Car: %s, Color: %s, Year: %s&quot;</span>, car, color, year);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// URL示例: /cars/BMW;color=red;year=2022</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 指定路径变量的矩阵变量</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/owners/&#123;ownerId&#125;/pets/&#123;petId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findPet</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable(pathVar = &quot;ownerId&quot;)</span> String q1,</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable(pathVar = &quot;petId&quot;)</span> String q2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Owner query: &quot;</span> + q1 + <span class="string">&quot;, Pet query: &quot;</span> + q2;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// URL示例: /owners/123;q=ownerQuery/pets/456;q=petQuery</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取所有矩阵变量</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/products/&#123;category&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getMatrixVars</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable</span> Map&lt;String, String&gt; matrixVars)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> matrixVars;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 多值矩阵变量</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/filter/&#123;criteria&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getMultiMatrix</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@MatrixVariable</span> List&lt;String&gt; filters)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> filters;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-CookieValue"><a href="#6-CookieValue" class="headerlink" title="6. @CookieValue"></a>6. @CookieValue</h3><p>作用：从HTTP Cookie中提取值。</p><p>使用示例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CookieController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取Cookie值</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/cookie&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCookie</span><span class="params">(<span class="meta">@CookieValue(&quot;JSESSIONID&quot;)</span> String sessionId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Session ID: &quot;</span> + sessionId;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置默认值</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/theme&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTheme</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@CookieValue(value = &quot;theme&quot;, defaultValue = &quot;light&quot;)</span> String theme)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Theme: &quot;</span> + theme;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取完整的Cookie对象</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/full-cookie&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFullCookie</span><span class="params">(<span class="meta">@CookieValue(&quot;JSESSIONID&quot;)</span> Cookie sessionCookie)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;Name: %s, Value: %s, Domain: %s&quot;</span>, </span><br><span class="line">                sessionCookie.getName(), </span><br><span class="line">                sessionCookie.getValue(),</span><br><span class="line">                sessionCookie.getDomain());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置Cookie的示例</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/set-cookie&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">setCookie</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ResponseCookie</span> <span class="variable">cookie</span> <span class="operator">=</span> ResponseCookie.from(<span class="string">&quot;user-token&quot;</span>, <span class="string">&quot;abc123&quot;</span>)</span><br><span class="line">                .httpOnly(<span class="literal">true</span>)</span><br><span class="line">                .secure(<span class="literal">true</span>)</span><br><span class="line">                .path(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">                .maxAge(Duration.ofHours(<span class="number">1</span>))</span><br><span class="line">                .build();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok()</span><br><span class="line">                .header(HttpHeaders.SET_COOKIE, cookie.toString())</span><br><span class="line">                .body(<span class="string">&quot;Cookie set&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-RequestBody"><a href="#7-RequestBody" class="headerlink" title="7. @RequestBody"></a>7. @RequestBody</h3><p>作用：将HTTP请求体绑定到方法参数，主要用于处理JSON&#x2F;XML等格式的数据。</p><p>使用示例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BodyController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绑定到简单对象</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理用户创建逻辑</span></span><br><span class="line">        <span class="keyword">return</span> userService.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绑定到Map</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/map&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">handleMap</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, Object&gt; payload)</span> &#123;</span><br><span class="line">        payload.put(<span class="string">&quot;processed&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        payload.put(<span class="string">&quot;timestamp&quot;</span>, LocalDateTime.now());</span><br><span class="line">        <span class="keyword">return</span> payload;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绑定到List</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/batch&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">batchCreate</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;User&gt; users)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Created &quot;</span> + users.size() + <span class="string">&quot; users&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绑定到字符串</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/raw&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleRawBody</span><span class="params">(<span class="meta">@RequestBody</span> String rawBody)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Received: &quot;</span> + rawBody;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用HttpEntity获取完整请求信息</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/entity&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleEntity</span><span class="params">(HttpEntity&lt;String&gt; entity)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> entity.getBody();</span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> entity.getHeaders();</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;Body: %s, Content-Type: %s&quot;</span>, </span><br><span class="line">                body, headers.getContentType());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 验证请求体</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/validate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; createValidUser(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> User user) &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">savedUser</span> <span class="operator">=</span> userService.save(user);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(savedUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证注解示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;姓名不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Min(value = 0, message = &quot;年龄不能小于0&quot;)</span></span><br><span class="line">    <span class="meta">@Max(value = 150, message = &quot;年龄不能大于150&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Email(message = &quot;邮箱格式不正确&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getter和setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-2-复杂参数接收请求数据"><a href="#8-2-复杂参数接收请求数据" class="headerlink" title="8.2 复杂参数接收请求数据"></a>8.2 复杂参数接收请求数据</h2><h3 id="1-常用复杂参数类型"><a href="#1-常用复杂参数类型" class="headerlink" title="1. 常用复杂参数类型"></a>1. 常用复杂参数类型</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonParamsController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 常用复杂参数</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleRequest</span><span class="params">(</span></span><br><span class="line"><span class="params">            Map&lt;String, Object&gt; map,                    // 数据存储</span></span><br><span class="line"><span class="params">            Model model,                                // 模型数据  </span></span><br><span class="line"><span class="params">            RedirectAttributes redirectAttributes,     // 重定向属性</span></span><br><span class="line"><span class="params">            HttpServletResponse response,              // HTTP响应</span></span><br><span class="line"><span class="params">            HttpSession session                        // Session</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;view&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-Map-和-Model-Request域数据"><a href="#2-Map-和-Model-Request域数据" class="headerlink" title="2. Map 和 Model - Request域数据"></a>2. Map 和 Model - Request域数据</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">(Map&lt;String, Object&gt; map, Model model)</span> &#123;</span><br><span class="line">        <span class="comment">// Map 和 Model 数据都会放在request域中（底层request.setAttribute()）</span></span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;age&quot;</span>, <span class="number">25</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 在模板中通过 $&#123;name&#125;、$&#123;age&#125; 获取</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 快捷方式 - 直接返回数据</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/data&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        data.put(<span class="string">&quot;code&quot;</span>, <span class="number">200</span>);</span><br><span class="line">        data.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-RedirectAttributes-重定向携带数据"><a href="#3-RedirectAttributes-重定向携带数据" class="headerlink" title="3. RedirectAttributes - 重定向携带数据"></a>3. RedirectAttributes - 重定向携带数据</h3><p>java</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedirectController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/addUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addUser</span><span class="params">(User user, RedirectAttributes redirectAttributes)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userService.save(user);</span><br><span class="line">            <span class="comment">// 添加flash属性 - 重定向后自动消失</span></span><br><span class="line">            redirectAttributes.addFlashAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;用户添加成功&quot;</span>);</span><br><span class="line">            redirectAttributes.addFlashAttribute(<span class="string">&quot;alertType&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            redirectAttributes.addFlashAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">            redirectAttributes.addFlashAttribute(<span class="string">&quot;alertType&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/user/list&quot;</span>;  <span class="comment">// 重定向到列表页</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 普通属性（会拼接到URL）</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">search</span><span class="params">(String keyword, RedirectAttributes redirectAttributes)</span> &#123;</span><br><span class="line">        redirectAttributes.addAttribute(<span class="string">&quot;keyword&quot;</span>, keyword); <span class="comment">// → /result?keyword=xxx</span></span><br><span class="line">        redirectAttributes.addAttribute(<span class="string">&quot;page&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/result&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-HttpServletResponse-响应控制"><a href="#4-HttpServletResponse-响应控制" class="headerlink" title="4. HttpServletResponse - 响应控制"></a>4. HttpServletResponse - 响应控制</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">downloadFile</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 设置响应头</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment; filename=file.txt&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 直接写入响应流</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        os.write(<span class="string">&quot;文件内容&quot;</span>.getBytes());</span><br><span class="line">        os.flush();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/json&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnJson</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        out.write(<span class="string">&quot;&#123;\&quot;status\&quot;:\&quot;success\&quot;&#125;&quot;</span>);</span><br><span class="line">        out.flush();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-HttpSession-会话管理"><a href="#5-HttpSession-会话管理" class="headerlink" title="5. HttpSession - 会话管理"></a>5. HttpSession - 会话管理</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(User user, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="comment">// 存储用户信息到session</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;currentUser&quot;</span>, user);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;loginTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置session超时时间（分钟）</span></span><br><span class="line">        session.setMaxInactiveInterval(<span class="number">30</span> * <span class="number">60</span>); <span class="comment">// 30分钟</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/home&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/profile&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">profile</span><span class="params">(HttpSession session, Model model)</span> &#123;</span><br><span class="line">        <span class="comment">// 从session获取数据</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) session.getAttribute(<span class="string">&quot;currentUser&quot;</span>);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;profile&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/logout&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">logout</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">        <span class="comment">// 销毁session</span></span><br><span class="line">        session.invalidate();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-实际应用示例"><a href="#6-实际应用示例" class="headerlink" title="6. 实际应用示例"></a>6. 实际应用示例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PracticalExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/submitOrder&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">submitOrder</span><span class="params">(Order order, </span></span><br><span class="line"><span class="params">                            HttpSession session,</span></span><br><span class="line"><span class="params">                            RedirectAttributes redirectAttributes)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. 从session获取用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) session.getAttribute(<span class="string">&quot;currentUser&quot;</span>);</span><br><span class="line">        order.setUserId(user.getId());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 业务处理</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            orderService.create(order);</span><br><span class="line">            redirectAttributes.addFlashAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;订单创建成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            redirectAttributes.addFlashAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;创建失败：&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 重定向到结果页</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/order/result&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportData</span><span class="params">(String type, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 设置响应</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/vnd.ms-excel&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment; filename=data.xlsx&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 导出逻辑</span></span><br><span class="line">        excelService.export(data, response.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-3-自定义对象参数自动封装"><a href="#8-3-自定义对象参数自动封装" class="headerlink" title="8.3 自定义对象参数自动封装"></a>8.3 自定义对象参数自动封装</h2><h3 id="1-基本介绍"><a href="#1-基本介绍" class="headerlink" title="1. 基本介绍"></a>1. 基本介绍</h3><ul><li><strong>自动封装</strong>：SpringBoot支持将请求参数自动封装到自定义对象</li><li><strong>类型转换</strong>：自动完成数据类型转换与格式化</li><li><strong>级联封装</strong>：支持对象属性的嵌套封装</li></ul><h3 id="2-基本使用"><a href="#2-基本使用" class="headerlink" title="2. 基本使用"></a>2. 基本使用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 用户实体</span></span><br><span class="line"><span class="meta">@Date</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Date birthDate;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Controller 使用</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自动封装对象参数</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// SpringBoot自动将请求参数封装到User对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;用户: &quot;</span> + user.getName() + <span class="string">&quot;, 年龄: &quot;</span> + user.getAge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>请求示例</strong>：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /user?name=张三&amp;age=25&amp;email=zhangsan@example.com&amp;birthDate=2023-01-01</span><br></pre></td></tr></table></figure><h3 id="3-级联封装（嵌套对象）"><a href="#3-级联封装（嵌套对象）" class="headerlink" title="3. 级联封装（嵌套对象）"></a>3. 级联封装（嵌套对象）</h3><p><strong>嵌套对象定义</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 地址类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String province;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户类（包含地址）</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Address address;  <span class="comment">// 嵌套对象</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>级联封装使用</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/userWithAddress&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createUserWithAddress</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// 自动级联封装</span></span><br><span class="line">        <span class="keyword">return</span> user.getName() + <span class="string">&quot; 住在 &quot;</span> + user.getAddress().getCity();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>请求示例</strong>：</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">POST</span> <span class="string">/userWithAddress?</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">李四&amp;</span></span><br><span class="line"><span class="attr">age</span>=<span class="string">30&amp;</span></span><br><span class="line"><span class="attr">address.province</span>=<span class="string">广东&amp;</span></span><br><span class="line"><span class="attr">address.city</span>=<span class="string">深圳&amp;</span></span><br><span class="line"><span class="attr">address.street</span>=<span class="string">科技园</span></span><br></pre></td></tr></table></figure><h3 id="4-列表和数组封装"><a href="#4-列表和数组封装" class="headerlink" title="4. 列表和数组封装"></a>4. 列表和数组封装</h3><p><strong>支持集合类型</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Date</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hobbies;     <span class="comment">// 列表</span></span><br><span class="line">    <span class="keyword">private</span> String[] skills;          <span class="comment">// 数组</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/userWithList&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">userWithList</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> user.getName() + <span class="string">&quot; 有 &quot;</span> + user.getHobbies().size() + <span class="string">&quot; 个爱好&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>请求示例</strong>：</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">POST</span> <span class="string">/userWithList?</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">王五&amp;</span></span><br><span class="line"><span class="attr">hobbies</span>=<span class="string">读书&amp;</span></span><br><span class="line"><span class="attr">hobbies</span>=<span class="string">游泳&amp;</span></span><br><span class="line"><span class="attr">hobbies</span>=<span class="string">编程&amp;</span></span><br><span class="line"><span class="attr">skills</span>=<span class="string">Java&amp;</span></span><br><span class="line"><span class="attr">skills</span>=<span class="string">Spring</span></span><br></pre></td></tr></table></figure><h3 id="5-实际应用示例"><a href="#5-实际应用示例" class="headerlink" title="5. 实际应用示例"></a>5. 实际应用示例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 订单相关实体</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderNo;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal amount;</span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; items;  <span class="comment">// 订单项列表</span></span><br><span class="line">    <span class="keyword">private</span> User user;              <span class="comment">// 用户信息</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String productName;</span><br><span class="line">    <span class="keyword">private</span> Integer quantity;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/createOrder&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 自动封装复杂对象结构</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;订单创建成功: &quot;</span> + order.getOrderNo() + </span><br><span class="line">               <span class="string">&quot;, 金额: &quot;</span> + order.getAmount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>请求示例</strong>：</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">POST</span> <span class="string">/createOrder?</span></span><br><span class="line"><span class="attr">orderNo</span>=<span class="string">ORD001&amp;</span></span><br><span class="line"><span class="attr">amount</span>=<span class="string">299.99&amp;</span></span><br><span class="line"><span class="attr">user.name</span>=<span class="string">张三&amp;</span></span><br><span class="line"><span class="attr">items[0].productName</span>=<span class="string">手机&amp;</span></span><br><span class="line"><span class="attr">items[0].quantity</span>=<span class="string">1&amp;</span></span><br><span class="line"><span class="attr">items[0].price</span>=<span class="string">2999&amp;</span></span><br><span class="line"><span class="attr">items[1].productName</span>=<span class="string">耳机&amp;</span></span><br><span class="line"><span class="attr">items[1].quantity</span>=<span class="string">2&amp;</span></span><br><span class="line"><span class="attr">items[1].price</span>=<span class="string">199</span></span><br></pre></td></tr></table></figure><h1 id="9-自定义转换器"><a href="#9-自定义转换器" class="headerlink" title="9 自定义转换器"></a>9 自定义转换器</h1><h2 id="1-基本介绍-1"><a href="#1-基本介绍-1" class="headerlink" title="1. 基本介绍"></a>1. 基本介绍</h2><p><strong>核心概念</strong></p><ul><li><strong>内置转换器</strong>：SpringBoot 使用内置转换器将请求数据封装成对象</li><li><strong>自定义转换器</strong>：支持开发自定义转换器处理特殊数据类型</li><li><strong>调试查看</strong>：在 debug 时可以看到内置转换器的工作过程</li></ul><h2 id="2-内置转换器示例"><a href="#2-内置转换器示例" class="headerlink" title="2. 内置转换器示例"></a>2. 内置转换器示例</h2><p><strong>自动类型转换</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// SpringBoot 内置转换器自动处理类型转换</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">(</span></span><br><span class="line"><span class="params">        Integer id,           // String → Integer</span></span><br><span class="line"><span class="params">        Boolean status,       // String → Boolean  </span></span><br><span class="line"><span class="params">        Date createTime,      // String → Date</span></span><br><span class="line"><span class="params">        BigDecimal amount     // String → BigDecimal</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ID: &quot;</span> + id + <span class="string">&quot;, Status: &quot;</span> + status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>请求示例</strong>：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /test?id=123&amp;status=true&amp;createTime=2023-01-01&amp;amount=99.99</span><br></pre></td></tr></table></figure><h2 id="3-自定义转换器场景"><a href="#3-自定义转换器场景" class="headerlink" title="3. 自定义转换器场景"></a>3. 自定义转换器场景</h2><p><strong>需要自定义的情况</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 场景1：特殊格式字符串转换</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; tags;  <span class="comment">// 需要将 &quot;java,spring,boot&quot; 转换为 List</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 场景2：自定义对象转换  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Coordinate</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double x;</span><br><span class="line">    <span class="keyword">private</span> Double y;</span><br><span class="line">    <span class="comment">// 需要将 &quot;10.5,20.3&quot; 转换为 Coordinate 对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-实现自定义转换器"><a href="#4-实现自定义转换器" class="headerlink" title="4. 实现自定义转换器"></a>4. 实现自定义转换器</h2><h4 id="方式1：Converter-接口"><a href="#方式1：Converter-接口" class="headerlink" title="方式1：Converter 接口"></a><strong>方式1：Converter 接口</strong></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字符串到List的转换器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringToListConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, List&lt;String&gt;&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (source == <span class="literal">null</span> || source.trim().isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将 &quot;java,spring,boot&quot; 转换为 List</span></span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(source.split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">                    .map(String::trim)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串到坐标对象的转换器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringToCoordinateConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, Coordinate&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Coordinate <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (source == <span class="literal">null</span> || !source.contains(<span class="string">&quot;,&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] parts = source.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="type">Coordinate</span> <span class="variable">coord</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Coordinate</span>();</span><br><span class="line">        coord.setX(Double.parseDouble(parts[<span class="number">0</span>].trim()));</span><br><span class="line">        coord.setY(Double.parseDouble(parts[<span class="number">1</span>].trim()));</span><br><span class="line">        <span class="keyword">return</span> coord;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="方式2：使用配置类注册"><a href="#方式2：使用配置类注册" class="headerlink" title="方式2：使用配置类注册"></a>方式2：使用配置类注册</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// 注册自定义转换器</span></span><br><span class="line">        registry.addConverter(<span class="keyword">new</span> <span class="title class_">StringToListConverter</span>());</span><br><span class="line">        registry.addConverter(<span class="keyword">new</span> <span class="title class_">StringToCoordinateConverter</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-使用自定义转换器"><a href="#5-使用自定义转换器" class="headerlink" title="5. 使用自定义转换器"></a>5. 使用自定义转换器</h2><p><strong>在Controller中使用</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomConverterController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用自定义转换器</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// SpringBoot会自动使用 StringToListConverter</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;用户: &quot;</span> + user.getName() + <span class="string">&quot;, 标签: &quot;</span> + user.getTags();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/point&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPoint</span><span class="params">(Coordinate coord)</span> &#123;</span><br><span class="line">        <span class="comment">// 自动使用 StringToCoordinateConverter</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;坐标: (&quot;</span> + coord.getX() + <span class="string">&quot;, &quot;</span> + coord.getY() + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>实体类定义</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; tags;  <span class="comment">// 自动转换 &quot;java,spring&quot; → List</span></span><br><span class="line">    <span class="keyword">private</span> Coordinate location; <span class="comment">// 自动转换 &quot;10.5,20.3&quot; → Coordinate</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>请求示例</strong>：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /user?</span><br><span class="line">name=张三&amp;</span><br><span class="line">tags=java,spring,boot&amp;</span><br><span class="line">location=116.40,39.90</span><br></pre></td></tr></table></figure><h2 id="6-调试查看转换器"><a href="#6-调试查看转换器" class="headerlink" title="6. 调试查看转换器"></a>6. 调试查看转换器</h2><p><strong>调试方法</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DebugController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/debug&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">debug</span><span class="params">(<span class="meta">@RequestParam</span> String data, WebDataBinder binder)</span> &#123;</span><br><span class="line">        <span class="comment">// 在debug时可以查看binder中的转换服务</span></span><br><span class="line">        <span class="comment">// 查看 ConversionService 中的注册的转换器</span></span><br><span class="line">        System.out.println(<span class="string">&quot;转换器数量: &quot;</span> + binder.getConversionService());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;调试信息&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="10-拦截器-HandlerInterceptor"><a href="#10-拦截器-HandlerInterceptor" class="headerlink" title="10 拦截器-HandlerInterceptor"></a>10 拦截器-HandlerInterceptor</h1><h2 id="10-1-基本介绍"><a href="#10-1-基本介绍" class="headerlink" title="10.1 基本介绍"></a>10.1 基本介绍</h2><p>在 Spring Boot 项目中， 拦截器是开发中常用手段，要来做登陆验证、性能检查、日志记录等。</p><h2 id="10-2-拦截器应用实例"><a href="#10-2-拦截器应用实例" class="headerlink" title="10.2 拦截器应用实例"></a>10.2 拦截器应用实例</h2><p>需求: 使用拦截器防止用户非法登录, 使用拦截器就不需要在每个方法验证了</p><p>浏览器输入 : <a href="http://localhost:8080/manage.html">http://localhost:8080/manage.html</a> , 如果用户没有登录，则返回登录界面.</p><p>代码实现：</p><p>创建 com&#x2F;wzb&#x2F;usersys&#x2F;interceptor&#x2F;LoginInterceptor.java</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 目标方法执行之前*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        log.info(<span class="string">&quot;preHandle 拦截的请求路径是&#123;&#125;&quot;</span>, requestURI);</span><br><span class="line">        <span class="comment">//登录检查逻辑</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">loginAdmin</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;loginAdmin&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (loginAdmin != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//放行</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//拦截</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;错误/重新登录&quot;</span>);</span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/&quot;</span>).forward(request, response);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 目标方法执行完成以后*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;postHandle 执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 页面渲染以后*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;afterCompletion 执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建 com&#x2F;wzb&#x2F;usersys&#x2F;config&#x2F;WebConfig.java</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这里实现 Spring-Boot 定制功能, 加入自己的配置</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/**&quot;</span>) <span class="comment">//拦截所有请求</span></span><br><span class="line">            .excludePathPatterns(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/login&quot;</span>, <span class="string">&quot;/images/**&quot;</span>); <span class="comment">//放行的请求, 可以根据需要增加&#125;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>注册拦截器, 依然可以使用如下方式</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="comment">/*implements WebMvcConfigurer*/</span> &#123;</span><br><span class="line">    <span class="comment">//将我们的拦截器, 注入到容器中</span></span><br><span class="line">    <span class="comment">//@Override</span></span><br><span class="line">    <span class="comment">//public void addInterceptors(InterceptorRegistry registry) &#123;</span></span><br><span class="line">    <span class="comment">// System.out.println(&quot;addInterceptors...&quot;);</span></span><br><span class="line">    <span class="comment">// //加入我们的拦截器</span></span><br><span class="line">    <span class="comment">// registry.addInterceptor(new LoginInterceptor())</span></span><br><span class="line">    <span class="comment">// .addPathPatterns(&quot;/**&quot;) //拦截所有请求</span></span><br><span class="line">    <span class="comment">// .excludePathPatterns(&quot;/&quot;,&quot;/login&quot;,&quot;/images/**&quot;);//</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;addInterceptors...~~~~:):)&quot;</span>);</span><br><span class="line">                <span class="comment">//加入我们的拦截器</span></span><br><span class="line">                registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                    .addPathPatterns(<span class="string">&quot;/**&quot;</span>) <span class="comment">//拦截所有请求.excludePathPatterns(&quot;/&quot;, &quot;/login&quot;, &quot;/images/**&quot;);//</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="11-文件上传"><a href="#11-文件上传" class="headerlink" title="11 文件上传"></a>11 文件上传</h1><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;#&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/upload&#125;&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span>用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:150px&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    电 邮:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:150px&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    年 龄:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:150px&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    职 位:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:150px&quot;</span> <span class="attr">name</span>=<span class="string">&quot;job&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    头 像:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:150px&quot;</span> <span class="attr">name</span>=<span class="string">&quot;header&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    宠 物:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:150px&quot;</span> <span class="attr">name</span>=<span class="string">&quot;photos&quot;</span> <span class="attr">multiple</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注册&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;重新填写&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>进行文件上传时要将enctype&#x3D;”multipart&#x2F;form-data”写成这样</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/upload.html&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;upload&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* MultipartFile 自动封装上传过来的文件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;email&quot;)</span> String email, <span class="meta">@RequestParam(&quot;name&quot;)</span>String name, <span class="meta">@RequestParam(&quot;age&quot;)</span> Integer age, <span class="meta">@RequestParam(&quot;job&quot;)</span></span></span><br><span class="line"><span class="params">                         String job, <span class="meta">@RequestPart(&quot;header&quot;)</span> MultipartFile header, <span class="meta">@RequestPart(&quot;photos&quot;)</span> MultipartFile[] photos)</span> throwsIOException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;上传的信息：email=&#123;&#125;，name=&#123;&#125;，age=&#123;&#125;, job=&#123;&#125;, header=&#123;&#125;，photos=&#123;&#125;&quot;</span>, email, name, age, job, header.getSize(), photos.length);</span><br><span class="line">        <span class="comment">// 也 可 以 自 己 动 态 的 创 建 上 传 文 件 目 录 , 来存放文件, 比如在resources/static/images/upload/</span></span><br><span class="line">        <span class="comment">// String path = ResourceUtils.getURL(&quot;classpath:&quot;).getPath();</span></span><br><span class="line">        <span class="comment">// File file = new File(path + &quot;static/images/upload/&quot;);</span></span><br><span class="line">        <span class="comment">// if (!file.exists()) file.mkdirs();</span></span><br><span class="line">        <span class="keyword">if</span> (!header.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">//保存到文件服务器或者 OSS 服务器//需要先创建好d:\\temp_upload 目录String originalFilename = header.getOriginalFilename();</span></span><br><span class="line">            <span class="comment">//方式 1: 指定某个目录存放上传文件</span></span><br><span class="line">            header.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:\\temp_upload\\&quot;</span> + originalFilename));</span><br><span class="line">            <span class="comment">//方式 2: 动态的创建文件存放文件</span></span><br><span class="line">            <span class="comment">//header.transferTo(new File(file.getAbsolutePath() + &quot;/&quot; + originalFilename));</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (photos.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (MultipartFile photo : photos) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!photo.isEmpty()) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> photo.getOriginalFilename();</span><br><span class="line">                    photo.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:\\temp_upload\\&quot;</span> + originalFilename));</span><br><span class="line">                    <span class="comment">//photo.transferTo(new File(file.getAbsolutePath() + &quot;/&quot; +originalFilename));</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;上传成功~~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>修改 WebConfig 配置，放行&#x2F;upload.html 和 &#x2F;upload 请求</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/**&quot;</span>) <span class="comment">//拦截所有请求</span></span><br><span class="line">            .excludePathPatterns(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/login&quot;</span>, <span class="string">&quot;/images/**&quot;</span>, <span class="string">&quot;/upload.html&quot;</span>, <span class="string">&quot;/upload&quot;</span>); <span class="comment">//放行的请求, 可以根据需要增加&#125;</span></span><br></pre></td></tr></table></figure><p>在配置文件中修改文件上传配置参数，max-file-size 单个文件大小, max-request-size 一次请求最大上传大小(多个文件.)</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">5MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">50MB</span></span><br></pre></td></tr></table></figure><h1 id="12-异常处理"><a href="#12-异常处理" class="headerlink" title="12 异常处理"></a>12 异常处理</h1><h2 id="12-1-基本介绍"><a href="#12-1-基本介绍" class="headerlink" title="12.1 基本介绍"></a>12.1 基本介绍</h2><p>默认情况下，Spring Boot 提供&#x2F;error 处理所有错误的映射</p><p>对于机器客户端，它将生成 JSON 响应，其中包含错误，HTTP 状态和异常消息的详细信息。对于浏览器客户端，响应一个”whitelabel”错误视图，以HTML 格式呈现相同的数据</p><p><img src="springboot%E5%AD%A6%E4%B9%A0%5C12.jpg"></p><h2 id="12-2-拦截器VS过滤器"><a href="#12-2-拦截器VS过滤器" class="headerlink" title="12.2 拦截器VS过滤器"></a>12.2 拦截器VS过滤器</h2><p>使用范围不同：</p><ul><li>过滤器 实现的是 javax.servlet.Filter 接口，而这个接口是在Servlet 规范中定义的，也就是说过滤器 Filter 的使用要依赖于 Tomcat 等容器，Filter 只能在web 程序中使用</li><li>拦截器(Interceptor) 它是一个 Spring 组件，并由 Spring 容器管理，并不依赖Tomcat 等容器，是可以单独使用的。不仅能应用在 web 程序中，也可以用于Application 等程序中</li></ul><p>过滤器 和 拦截器的触发时机也不同，看下边这张图</p><p><img src="springboot%E5%AD%A6%E4%B9%A0%5C13.jpg"></p><ul><li>过滤器 Filter 是在请求进入容器后, 但在进入 servlet 之前进行预处理, 请求结束是在servlet 处理完以后 </li><li>拦截器 Interceptor 是在请求进入 servlet 后, 在进入 Controller 之前进行预处理的, Controller 中渲染了对应的视图之后请求结束</li></ul><p><strong>过滤器不会处理请求转发, 拦截器会处理请求转发</strong>，这里举例说明：</p><p><strong>场景设定</strong></p><p>假设我们有一个请求：</p><ol><li>用户访问 <code>/start</code>。</li><li>Controller 处理 <code>/start</code>，然后<strong>转发</strong>到 <code>/forward</code>。</li><li>Controller 处理 <code>/forward</code>，返回结果。</li></ol><p>我们将创建一个<strong>过滤器</strong>和一个<strong>拦截器</strong>，并观察它们在这个流程中的行为。</p><hr><ol><li><strong>创建过滤器 (Filter)</strong></li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span> <span class="comment">// 过滤所有请求</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器 Filter: 进入 &quot;</span> + req.getRequestURI() + <span class="string">&quot; | 请求类型: &quot;</span> + getDispatcherType(req));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行后续过滤器或Servlet</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器 Filter: 退出 &quot;</span> + req.getRequestURI());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getDispatcherType</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取请求的派发类型</span></span><br><span class="line">        <span class="keyword">return</span> request.getDispatcherType().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>创建拦截器 (Interceptor)</strong></li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拦截器 Interceptor: preHandle  &quot;</span> + request.getRequestURI() + <span class="string">&quot; | 请求类型: &quot;</span> + request.getDispatcherType());</span><br><span class="line">        <span class="comment">// 在Controller方法执行前调用</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 继续流程</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拦截器 Interceptor: postHandle &quot;</span> + request.getRequestURI() + <span class="string">&quot; | 请求类型: &quot;</span> + request.getDispatcherType());</span><br><span class="line">        <span class="comment">// 在Controller方法执行后，视图渲染前调用</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拦截器 Interceptor: afterCompletion &quot;</span> + request.getRequestURI() + <span class="string">&quot; | 请求类型: &quot;</span> + request.getDispatcherType());</span><br><span class="line">        <span class="comment">// 在整个请求完成后调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>通过配置类注册这个拦截器：</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyInterceptor myInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(myInterceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>); <span class="comment">// 拦截所有路径</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>创建控制器 (Controller)</strong></li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/start&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--- Controller: 处理 /start，准备转发到 /forward ---&quot;</span>);</span><br><span class="line">        <span class="comment">// 关键：这里是服务器端转发</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;forward:/forward&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/forward&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">forward</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--- Controller: 处理 /forward ---&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>; <span class="comment">// 返回一个视图名</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ol start="4"><li><strong>运行并访问 <code>/start</code> 查看控制台输出</strong></li></ol><p>当你访问 <code>http://localhost:8080/start</code> 时，控制台的输出顺序和内容将非常说明问题：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 原始请求 /start 进入</span></span><br><span class="line">过滤器 Filter: 进入 /start | 请求类型: REQUEST</span><br><span class="line">拦截器 Interceptor: preHandle  /start | 请求类型: REQUEST</span><br><span class="line"></span><br><span class="line">--- Controller: 处理 /start，准备转发到 /forward ---</span><br><span class="line"></span><br><span class="line">拦截器 Interceptor: postHandle /start | 请求类型: REQUEST</span><br><span class="line">拦截器 Interceptor: afterCompletion /start | 请求类型: REQUEST</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 注意！过滤器没有为转发的请求再次执行！</span></span><br><span class="line"><span class="comment">// 但拦截器处理了！</span></span><br><span class="line">拦截器 Interceptor: preHandle  /forward | 请求类型: FORWARD</span><br><span class="line"></span><br><span class="line">--- Controller: 处理 /forward ---</span><br><span class="line"></span><br><span class="line">拦截器 Interceptor: postHandle /forward | 请求类型: FORWARD</span><br><span class="line">拦截器 Interceptor: afterCompletion /forward | 请求类型: FORWARD</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 最终，原始请求的过滤器退出</span></span><br><span class="line">过滤器 Filter: 退出 /start</span><br></pre></td></tr></table></figure><p><strong>关键分析</strong></p><p>从输出结果可以清晰地看到：</p><ol><li><strong>过滤器 (Filter)</strong>：<ul><li>只记录了 <strong><code>进入 /start</code></strong> 和 <strong><code>退出 /start</code></strong>。</li><li>对于从 <code>/start</code> 转发到 <code>/forward</code> 的这次<strong>内部请求，过滤器完全忽略了</strong>。它只处理了一次 <code>DispatcherType.REQUEST</code>。</li></ul></li><li><strong>拦截器 (Interceptor)</strong>：<ul><li>处理了两次请求：<ul><li>第一次：<code>/start</code>，请求类型为 <strong><code>REQUEST</code></strong>。</li><li>第二次：<code>/forward</code>，请求类型为 <strong><code>FORWARD</code></strong>。</li></ul></li><li>它完整地参与了Spring MVC的整个内部流程，包括请求转发。</li></ul></li></ol><p><strong>如何让过滤器也处理转发？</strong></p><p>如果你需要让过滤器也能处理转发请求，可以在注册过滤器时进行配置。在Spring Boot中，使用 <code>FilterRegistrationBean</code>：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean&lt;MyFilter&gt; <span class="title function_">myFilterRegistration</span><span class="params">()</span> &#123;</span><br><span class="line">        FilterRegistrationBean&lt;MyFilter&gt; registration = <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;();</span><br><span class="line">        registration.setFilter(<span class="keyword">new</span> <span class="title class_">MyFilter</span>());</span><br><span class="line">        registration.addUrlPatterns(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置派发类型，使其也处理转发</span></span><br><span class="line">        registration.setDispatcherTypes(DispatcherType.REQUEST, DispatcherType.FORWARD);</span><br><span class="line">        <span class="keyword">return</span> registration;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样配置后，过滤器也会对 <code>FORWARD</code> 类型的请求生效。</p><h2 id="12-3-自定义异常页面"><a href="#12-3-自定义异常页面" class="headerlink" title="12.3 自定义异常页面"></a>12.3 自定义异常页面</h2><p><strong>核心概念</strong><br>当应用程序抛出异常时，Spring Boot 默认会提供一个名为 “whitelabel error page” 的错误页面。要替换它，我们需要处理 &#x2F;error 路径。Spring Boot 自动将异常信息绑定到请求中，供错误页面使用。</p><h3 id="方法一：静态自定义错误页面（最简单）"><a href="#方法一：静态自定义错误页面（最简单）" class="headerlink" title="方法一：静态自定义错误页面（最简单）"></a>方法一：静态自定义错误页面（最简单）</h3><p>这种方式通过创建静态 HTML 页面来定义错误页面，适用于简单的、静态的错误提示。</p><p>在 src&#x2F;main&#x2F;resources&#x2F;static&#x2F;error&#x2F; 目录下创建对应的错误状态码 HTML 文件。</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">src/main/resources/</span></span><br><span class="line"><span class="attr">└──</span> <span class="string">static/</span></span><br><span class="line">    <span class="attr">└──</span> <span class="string">error/</span></span><br><span class="line">        <span class="attr">├──</span> <span class="string">404.html</span></span><br><span class="line">        <span class="attr">├──</span> <span class="string">500.html</span></span><br><span class="line">        <span class="attr">└──</span> <span class="string">5xx.html  # 通配符，匹配所有5xx错误</span></span><br></pre></td></tr></table></figure><h3 id="方法二：动态模板错误页面（推荐）"><a href="#方法二：动态模板错误页面（推荐）" class="headerlink" title="方法二：动态模板错误页面（推荐）"></a>方法二：动态模板错误页面（推荐）</h3><p>使用模板引擎（Thymeleaf、FreeMarker等）创建动态错误页面，可以显示异常信息。</p><p>使用 Thymeleaf 示例<br>在 src&#x2F;main&#x2F;resources&#x2F;templates&#x2F;error&#x2F; 目录下创建模板文件：</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">src/main/resources/</span></span><br><span class="line"><span class="attr">└──</span> <span class="string">templates/</span></span><br><span class="line">    <span class="attr">└──</span> <span class="string">error/</span></span><br><span class="line">        <span class="attr">├──</span> <span class="string">404.html</span></span><br><span class="line">        <span class="attr">├──</span> <span class="string">500.html</span></span><br><span class="line">        <span class="attr">└──</span> <span class="string">error.html  # 通用错误页面</span></span><br></pre></td></tr></table></figure><h3 id="方法三：使用-ControllerAdvice-全局异常处理（最灵活）"><a href="#方法三：使用-ControllerAdvice-全局异常处理（最灵活）" class="headerlink" title="方法三：使用 @ControllerAdvice 全局异常处理（最灵活）"></a>方法三：使用 @ControllerAdvice 全局异常处理（最灵活）</h3><p>这种方式可以完全控制异常处理逻辑，适合复杂的业务场景。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.NoHandlerFoundException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理404异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(NoHandlerFoundException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleNotFound</span><span class="params">(HttpServletRequest request, Exception ex, Model model)</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;页面不存在&quot;</span>);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;path&quot;</span>, request.getRequestURL());</span><br><span class="line">        model.addAttribute(<span class="string">&quot;timestamp&quot;</span>, java.time.LocalDateTime.now());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error/404&quot;</span>; <span class="comment">// 返回自定义的404页面</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理所有其他异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleAllExceptions</span><span class="params">(HttpServletRequest request, Exception ex, Model model)</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;服务器内部错误&quot;</span>);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;message&quot;</span>, ex.getMessage());</span><br><span class="line">        model.addAttribute(<span class="string">&quot;path&quot;</span>, request.getRequestURL());</span><br><span class="line">        model.addAttribute(<span class="string">&quot;timestamp&quot;</span>, java.time.LocalDateTime.now());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开发环境显示详细错误</span></span><br><span class="line">        <span class="keyword">if</span> (isDevEnvironment()) &#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;exception&quot;</span>, ex.getClass().getName());</span><br><span class="line">            model.addAttribute(<span class="string">&quot;trace&quot;</span>, getStackTrace(ex));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error/500&quot;</span>; <span class="comment">// 返回自定义的500页面</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isDevEnvironment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 这里可以检查当前环境是否是开发环境</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 实际应用中应该从配置中读取</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getStackTrace</span><span class="params">(Exception ex)</span> &#123;</span><br><span class="line">        java.io.<span class="type">StringWriter</span> <span class="variable">sw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.StringWriter();</span><br><span class="line">        java.io.<span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.PrintWriter(sw);</span><br><span class="line">        ex.printStackTrace(pw);</span><br><span class="line">        <span class="keyword">return</span> sw.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>为了让404异常能被捕获，需要在 <code>application.properties</code> 中配置：</strong></p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启用抛出NoHandlerFoundException而不是返回404页面</span></span><br><span class="line"><span class="attr">spring.mvc.throw-exception-if-no-handler-found</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 禁止静态资源映射，确保能抛出异常</span></span><br><span class="line"><span class="attr">spring.web.resources.add-mappings</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure><hr><h3 id="方法四：自定义-ErrorController（完全控制）"><a href="#方法四：自定义-ErrorController（完全控制）" class="headerlink" title="方法四：自定义 ErrorController（完全控制）"></a>方法四：自定义 ErrorController（完全控制）</h3><p>实现自定义的 <code>ErrorController</code> 来完全控制错误处理流程。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.error.ErrorController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCustomErrorController</span> <span class="keyword">implements</span> <span class="title class_">ErrorController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/error&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleError</span><span class="params">(HttpServletRequest request, Model model)</span> &#123;</span><br><span class="line">        <span class="comment">// 从请求中获取错误信息</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">statusCode</span> <span class="operator">=</span> (Integer) request.getAttribute(<span class="string">&quot;javax.servlet.error.status_code&quot;</span>);</span><br><span class="line">        <span class="type">Exception</span> <span class="variable">exception</span> <span class="operator">=</span> (Exception) request.getAttribute(<span class="string">&quot;javax.servlet.error.exception&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">requestUri</span> <span class="operator">=</span> (String) request.getAttribute(<span class="string">&quot;javax.servlet.error.request_uri&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (requestUri == <span class="literal">null</span>) &#123;</span><br><span class="line">            requestUri = <span class="string">&quot;Unknown&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        model.addAttribute(<span class="string">&quot;statusCode&quot;</span>, statusCode);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;requestUri&quot;</span>, requestUri);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;exception&quot;</span>, exception);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;timestamp&quot;</span>, java.time.LocalDateTime.now());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 根据状态码返回不同的页面</span></span><br><span class="line">        <span class="keyword">if</span> (statusCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error/404&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (statusCode == <span class="number">500</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error/500&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error/error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这个方法是过时的，但在新版本中仍然需要实现</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getErrorPath</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="13-注入-Servlet、Filter、Listener"><a href="#13-注入-Servlet、Filter、Listener" class="headerlink" title="13 注入 Servlet、Filter、Listener"></a>13 注入 Servlet、Filter、Listener</h1><h2 id="13-1-使用-Spring-Boot-注解（最推荐）"><a href="#13-1-使用-Spring-Boot-注解（最推荐）" class="headerlink" title="13.1 使用 Spring Boot 注解（最推荐）"></a>13.1 使用 Spring Boot 注解（最推荐）</h2><p>这是 Spring Boot 中最简单、最常用的方式。</p><h3 id="1-注入-Servlet"><a href="#1-注入-Servlet" class="headerlink" title="1. 注入 Servlet"></a>1. 注入 Servlet</h3><p><strong>注意注入的原生 Servlet 不会被 Spring-Boot 拦截器拦截</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/custom-servlet&quot;)</span>  <span class="comment">// 指定Servlet的访问路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        resp.getWriter().println(<span class="string">&quot;&lt;h1&gt;这是自定义Servlet&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        resp.getWriter().println(<span class="string">&quot;&lt;p&gt;当前时间: &quot;</span> + <span class="keyword">new</span> <span class="title class_">java</span>.util.Date() + <span class="string">&quot;&lt;/p&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-注入-Filter"><a href="#2-注入-Filter" class="headerlink" title="2. 注入 Filter"></a>2. 注入 Filter</h3><p><strong>过滤器配置的 urlPatterns 也会经过 Spring-Boot 拦截器</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span>  <span class="comment">// 过滤所有请求</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;自定义过滤器初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, </span></span><br><span class="line"><span class="params">                        FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器: 请求 &quot;</span> + req.getRequestURI());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 继续执行过滤器链</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器: 响应 &quot;</span> + req.getRequestURI() + <span class="string">&quot; 耗时: &quot;</span> + (endTime - startTime) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;自定义过滤器销毁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-注入-Listener"><a href="#3-注入-Listener" class="headerlink" title="3. 注入 Listener"></a>3. 注入 Listener</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=== 应用程序启动 ===&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ServletContext 初始化完成&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 可以在这里进行应用启动时的初始化工作</span></span><br><span class="line">        sce.getServletContext().setAttribute(<span class="string">&quot;appStartTime&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=== 应用程序关闭 ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Long</span> <span class="variable">startTime</span> <span class="operator">=</span> (Long) sce.getServletContext().getAttribute(<span class="string">&quot;appStartTime&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (startTime != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">runTime</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">            System.out.println(<span class="string">&quot;应用运行时间: &quot;</span> + runTime + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-启用注解扫描"><a href="#4-启用注解扫描" class="headerlink" title="4. 启用注解扫描"></a>4. 启用注解扫描</h3><p><strong>关键步骤</strong>：在 Spring Boot 主类上添加 <code>@ServletComponentScan</code> 注解：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.boot.web.servlet.ServletComponentScan;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">@ServletComponentScan  // 扫描 @WebServlet, @WebFilter, @WebListener 注解</span><br><span class="line">public class Application &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="13-2-使用-Java-Config-配置（灵活配置）"><a href="#13-2-使用-Java-Config-配置（灵活配置）" class="headerlink" title="13.2 使用 Java Config 配置（灵活配置）"></a>13.2 使用 Java Config 配置（灵活配置）</h2><p>这种方式更适合需要动态配置的场景。</p><h3 id="1-先创建-Servlet、Filter、Listener-类"><a href="#1-先创建-Servlet、Filter、Listener-类" class="headerlink" title="1. 先创建 Servlet、Filter、Listener 类"></a>1. 先创建 Servlet、Filter、Listener 类</h3><p><strong>CustomServlet.java</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.getWriter().println(<span class="string">&quot;Java Config 配置的 Servlet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>CustomFilter.java</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, </span></span><br><span class="line"><span class="params">                        FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Java Config Filter 执行前&quot;</span>);</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">        System.out.println(<span class="string">&quot;Java Config Filter 执行后&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>CustomListener.java</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Java Config Listener: 应用启动&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Java Config Listener: 应用关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-使用配置类注册"><a href="#2-使用配置类注册" class="headerlink" title="2. 使用配置类注册"></a>2. 使用配置类注册</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletListenerRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册 Servlet</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean&lt;CustomServlet&gt; <span class="title function_">customServlet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>&lt;&gt;(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CustomServlet</span>(), </span><br><span class="line">            <span class="string">&quot;/java-config-servlet&quot;</span>  <span class="comment">// 映射路径</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册 Filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean&lt;CustomFilter&gt; <span class="title function_">customFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        FilterRegistrationBean&lt;CustomFilter&gt; registrationBean = </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;();</span><br><span class="line">        registrationBean.setFilter(<span class="keyword">new</span> <span class="title class_">CustomFilter</span>());</span><br><span class="line">        registrationBean.addUrlPatterns(<span class="string">&quot;/*&quot;</span>);  <span class="comment">// 过滤所有请求</span></span><br><span class="line">        registrationBean.setOrder(<span class="number">1</span>);  <span class="comment">// 设置过滤器执行顺序</span></span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册 Listener</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletListenerRegistrationBean&lt;CustomListener&gt; <span class="title function_">customListener</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletListenerRegistrationBean</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">CustomListener</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="13-3-请求-Servlet-时，为什么不会到达拦截器"><a href="#13-3-请求-Servlet-时，为什么不会到达拦截器" class="headerlink" title="13.3 请求 Servlet 时，为什么不会到达拦截器"></a>13.3 请求 Servlet 时，为什么不会到达拦截器</h2><h3 id="1-请求处理流程的差异"><a href="#1-请求处理流程的差异" class="headerlink" title="1. 请求处理流程的差异"></a>1. 请求处理流程的差异</h3><p>首先，我们需要理解一个关键点：<strong>在Spring Boot应用中，实际上存在两套并行的请求处理机制</strong>。</p><p><strong>对于Spring MVC控制器（Controller）的请求：</strong></p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">HTTP</span> <span class="string">Request → Servlet Container → DispatcherServlet → 拦截器 → 控制器方法</span></span><br></pre></td></tr></table></figure><p><strong>对于直接映射的Servlet的请求：</strong></p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">HTTP</span> <span class="string">Request → Servlet Container → 自定义Servlet</span></span><br></pre></td></tr></table></figure><h3 id="2-详细原因分析"><a href="#2-详细原因分析" class="headerlink" title="2. 详细原因分析"></a>2. 详细原因分析</h3><h4 id="①-DispatcherServlet-的角色定位"><a href="#①-DispatcherServlet-的角色定位" class="headerlink" title="① DispatcherServlet 的角色定位"></a>① DispatcherServlet 的角色定位</h4><ul><li><code>DispatcherServlet</code> 是Spring MVC的<strong>前端控制器</strong>，它是所有Spring MVC请求的<strong>统一入口</strong></li><li>但它<strong>不是</strong>整个Web应用的唯一Servlet</li><li>在Spring Boot中，<code>DispatcherServlet</code> 默认被映射到根路径 <code>/</code>，但<strong>它也会处理更具体的路径匹配</strong></li></ul><h4 id="②-Servlet-容器的处理机制"><a href="#②-Servlet-容器的处理机制" class="headerlink" title="② Servlet 容器的处理机制"></a>② Servlet 容器的处理机制</h4><p>当请求到达时，Servlet容器会根据URL路径选择最精确匹配的Servlet：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 情况1：请求匹配到自定义Servlet的路径</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/api/servlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="comment">// 请求直接到达这里，绕过DispatcherServlet</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情况2：请求匹配到Controller的路径  </span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/api/controller&quot;)</span> <span class="comment">// 请求会经过DispatcherServlet → 拦截器 → 这里</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;controller response&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="③-拦截器的工作范围"><a href="#③-拦截器的工作范围" class="headerlink" title="③ 拦截器的工作范围"></a>③ 拦截器的工作范围</h4><p>Spring的拦截器是<strong>绑定在<code>DispatcherServlet</code>的处理流程中</strong>的：</p><p>java</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">MyInterceptor</span>())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>) <span class="comment">// 这个模式只对DispatcherServlet处理的请求有效</span></span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/api/servlet&quot;</span>); <span class="comment">// 排除Servlet路径实际上是不必要的</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-验证实验"><a href="#3-验证实验" class="headerlink" title="3. 验证实验"></a>3. 验证实验</h3><p>我们可以通过代码来验证这个现象：</p><p><strong>自定义Servlet</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/direct-servlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirectServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;✅ 直接访问Servlet - 请求到达&quot;</span>);</span><br><span class="line">        resp.getWriter().println(<span class="string">&quot;Response from Direct Servlet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>拦截器</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, </span></span><br><span class="line"><span class="params">                           HttpServletResponse response, Object handler)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;🔍 拦截器执行: &quot;</span> + request.getRequestURI());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>测试结果</strong></p><ul><li><p>访问 <code>http://localhost:8080/direct-servlet</code>：</p><p>text</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">✅ 直接访问Servlet - 请求到达</span><br><span class="line">// 控制台没有拦截器输出</span><br></pre></td></tr></table></figure></li><li><p>访问Controller路径时：</p><p>text</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">🔍 拦截器执行: /api/controller</span><br><span class="line">✅ Controller处理请求</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-解决方案"><a href="#4-解决方案" class="headerlink" title="4. 解决方案"></a>4. 解决方案</h3><p>如果希望Servlet请求也经过Spring的拦截器，有几种方式：</p><h4 id="方案1：使用Filter代替拦截器"><a href="#方案1：使用Filter代替拦截器" class="headerlink" title="方案1：使用Filter代替拦截器"></a>方案1：使用Filter代替拦截器</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, </span></span><br><span class="line"><span class="params">                        FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Filter处理: &quot;</span> + ((HttpServletRequest)request).getRequestURI());</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="方案2：通过DispatcherServlet转发到Servlet"><a href="#方案2：通过DispatcherServlet转发到Servlet" class="headerlink" title="方案2：通过DispatcherServlet转发到Servlet"></a>方案2：通过DispatcherServlet转发到Servlet</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RouterController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/router-to-servlet&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">routeToServlet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 这样会经过拦截器</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/direct-servlet&quot;</span>).forward(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="14-数据库操作"><a href="#14-数据库操作" class="headerlink" title="14 数据库操作"></a>14 数据库操作</h1><h2 id="14-1-JDBC-HikariDataSource"><a href="#14-1-JDBC-HikariDataSource" class="headerlink" title="14.1 JDBC+HikariDataSource"></a>14.1 JDBC+HikariDataSource</h2><p>演示 Spring Boot 如何通过 jdbc+HikariDataSource 完成对Mysql 操作说明: HikariDataSource : 目前市面上非常优秀的数据源, 是 springboot2 默认数据源</p><p>进 行 数 据 库 开 发 ， 在 pom.xml 引 入 data-jdbc starter</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="BlogkFile\source_posts\springboot学习\14.jpg"></p><p>Spring Boot 不知道项目要操作 Mysql 还是 Oracle ， 需要在pom.xml 指定导入数据库驱动， 并指定对应版本</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1. 引入操作 mysql 的驱动</span></span><br><span class="line"><span class="comment">2. 这个驱动版本要和你实际操作的 mysql 版本对应</span></span><br><span class="line"><span class="comment">3. 我们 spring-boot mysql 区别仲裁版本是&lt;mysql.version&gt;8.0.26&lt;/mysql.version&gt;,我们安装的是 mysql5 ,因此重新指定 mysql 驱动版本</span></span><br><span class="line"><span class="comment">4. 这个 mysql 驱动版本也可以在 pom.xml properties 指定</span></span><br><span class="line"><span class="comment">&lt;properties&gt;</span></span><br><span class="line"><span class="comment">&lt;mysql.version&gt;5.1.49&lt;/mysql.version&gt;</span></span><br><span class="line"><span class="comment">&lt;/properties&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>在 application.yml 配置操作数据源的信息</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">5MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">50MB</span></span><br><span class="line"><span class="comment">#数据源配置</span></span><br><span class="line">   <span class="attr">datasource:</span></span><br><span class="line"><span class="comment">#说明： 如果没有使用 useSSL=true, 会报红警告</span></span><br><span class="line"> <span class="attr">url:</span></span><br><span class="line">        <span class="string">jdbc:mysql://localhost:3306/spring_boot?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true</span></span><br><span class="line">     <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">     <span class="attr">password:</span> <span class="string">hsp</span></span><br><span class="line">     <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure><p><strong>创建</strong> 04_springboot_usersys\src\main\java\com\wzb\usersys\bean\Furn.java</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Furn</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String maker;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> Integer sales;</span><br><span class="line">    <span class="keyword">private</span> Integer stock;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">imgPath</span> <span class="operator">=</span> <span class="string">&quot;assets/images/product-image/1.jpg&quot;</span>;</span><br></pre></td></tr></table></figure><p>● test 目录下的 com&#x2F;hspedu&#x2F;usersys&#x2F;ApplicationTests.java , 完成测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        BeanPropertyRowMapper&lt;Furn&gt; rowMapper =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Furn.class);</span><br><span class="line">        List&lt;Furn&gt; furns = jdbcTemplate.query(<span class="string">&quot;select * from furn&quot;</span>, rowMapper);</span><br><span class="line">        <span class="keyword">for</span> (Furn furn : furns) &#123;</span><br><span class="line">            System.out.println(furn);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(jdbcTemplate.getDataSource().getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="14-2-整合Druid到springboot"><a href="#14-2-整合Druid到springboot" class="headerlink" title="14.2 整合Druid到springboot"></a>14.2 整合Druid到springboot</h2><h3 id="14-2-1-基本介绍"><a href="#14-2-1-基本介绍" class="headerlink" title="14.2.1 基本介绍"></a>14.2.1 基本介绍</h3><p>Druid： 性能优秀，Druid 提供性能卓越的连接池功能外【Java 基础】，还集成了SQL监控，黑名单拦截等功能，强大的监控特性，通过 Druid 提供的监控功能，可以清楚知道连接池和 SQL 的工作情况</p><h3 id="14-2-2-自定义整合"><a href="#14-2-2-自定义整合" class="headerlink" title="14.2.2 自定义整合"></a>14.2.2 自定义整合</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 druid 依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>创建 com&#x2F;wzb&#x2F;usersys&#x2F;config&#x2F;DruidDataSourceConfig.java 配置类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidDataSourceConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 默 认 的 自 动 配 置 是 判 断 容 器中没有才会配</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(DataSource.class)</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 1. 默认的数据源配置是 <span class="doctag">@ConditionalOnMissingBean</span>(DataSource.class)</span></span><br><span class="line"><span class="comment">* 2. 也就是当容器中没有 DataSource 组件时，才会注入，如果我们这里配置了DataSource, 就会使用我们配置的数据源</span></span><br><span class="line"><span class="comment">* 3. &quot;spring.datasource&quot; 会将 druid 数据源的配置绑定到application.yml, 就不需要setXxx</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        <span class="meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">druidDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="comment">// &quot;spring.datasource&quot; 会将 druid 数据源的配置绑定到application.yml, 就不需要setXxx</span></span><br><span class="line">        <span class="comment">// druidDataSource.setUrl();</span></span><br><span class="line">        <span class="comment">// druidDataSource.setUsername();</span></span><br><span class="line">        <span class="comment">// druidDataSource.setPassword();</span></span><br><span class="line">        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-Durid-监控功能-SQL-监控"><a href="#1-Durid-监控功能-SQL-监控" class="headerlink" title="1 Durid 监控功能-SQL 监控"></a>1 Durid 监控功能-SQL 监控</h4><p>修改 com&#x2F;wzb&#x2F;usersys&#x2F;config&#x2F;DruidDataSourceConfig.java , 增加druid 监控功能</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidDataSourceConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 默 认 的 自 动 配 置 是 判 断 容 器中没有才会配@ConditionalOnMissingBean(DataSource.class)</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 1. 默认的数据源配置是 <span class="doctag">@ConditionalOnMissingBean</span>(DataSource.class)</span></span><br><span class="line"><span class="comment">* 2. 也就是当容器中没有 DataSource 组件时，才会注入，如果我们这里配置了DataSource, 就会使用我们配置的数据源</span></span><br><span class="line"><span class="comment">* 3. &quot;spring.datasource&quot; 会将 druid 数据源的配置绑定到application.yml, 就不需要setXxx</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">druidDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="comment">// &quot;spring.datasource&quot; 会将 druid 数据源的配置绑定到application.yml, 就不需要setXxx</span></span><br><span class="line">        <span class="comment">// druidDataSource.setUrl();</span></span><br><span class="line">        <span class="comment">// druidDataSource.setUsername();</span></span><br><span class="line">        <span class="comment">// druidDataSource.setPassword();</span></span><br><span class="line">        druidDataSource.setFilters(<span class="string">&quot;stat&quot;</span>)<span class="comment">// sql监控功能</span></span><br><span class="line">        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 配置 druid 的监控页功能</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">statViewServlet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StatViewServlet</span> <span class="variable">statViewServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StatViewServlet</span>();</span><br><span class="line">        ServletRegistrationBean&lt;StatViewServlet&gt; registrationBean =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>&lt;&gt;(statViewServlet, <span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">        <span class="comment">//配置登录监控页面用户名和密码</span></span><br><span class="line">        registrationBean.addInitParameter(<span class="string">&quot;loginUsername&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        registrationBean.addInitParameter(<span class="string">&quot;loginPassword&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建 com&#x2F;wzb&#x2F;usersys&#x2F;controller&#x2F;DruidSqlController.java，模拟操作 DB 的请求</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidSqlController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sql&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Furn&gt; <span class="title function_">crudDB</span><span class="params">()</span>&#123;</span><br><span class="line">        BeanPropertyRowMapper&lt;Furn&gt; rowMapper =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Furn.class);</span><br><span class="line">        List&lt;Furn&gt; furns = jdbcTemplate.query(<span class="string">&quot;select * from furn&quot;</span>, rowMapper);</span><br><span class="line">        <span class="keyword">for</span> (Furn furn : furns) &#123;</span><br><span class="line">            System.out.println(furn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> furns;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SQL 监控数据-测试页面</p><p><img src="BlogkFile\source_posts\springboot学习\15.jpg"></p><h4 id="2-Durid-监控功能-Web-关联监控"><a href="#2-Durid-监控功能-Web-关联监控" class="headerlink" title="2 Durid 监控功能-Web 关联监控"></a>2 Durid 监控功能-Web 关联监控</h4><p>修 改 com&#x2F;wzb&#x2F;usersys&#x2F;config&#x2F;DruidDataSourceConfig.java ，注入&#x2F; 增加 WebStatFilter 用于采集 web-jdbc 关联监控的数据</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* WebStatFilter 用于采集 web-jdbc 关联监控的数据。</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">webStatFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">WebStatFilter</span> <span class="variable">webStatFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebStatFilter</span>();</span><br><span class="line">    FilterRegistrationBean&lt;WebStatFilter&gt; filterRegistrationBean =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;(webStatFilter);</span><br><span class="line">    <span class="comment">//默认对所有 URL 请求监控</span></span><br><span class="line">    filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/*&quot;</span>));</span><br><span class="line">    <span class="comment">//排除 URL</span></span><br><span class="line">    filterRegistrationBean.addInitParameter</span><br><span class="line">        (<span class="string">&quot;exclusions&quot;</span>, <span class="string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3-Durid-监控功能-SQL-防火墙"><a href="#3-Durid-监控功能-SQL-防火墙" class="headerlink" title="3 Durid 监控功能-SQL 防火墙"></a>3 Durid 监控功能-SQL 防火墙</h4><p>修改 com&#x2F;wzb&#x2F;usersys&#x2F;config&#x2F;DruidDataSourceConfig.java ，加入防火墙监控</p><p><img src="BlogkFile\source_posts\springboot学习\16.jpg"></p><h4 id="4-Durid-监控功能-其他监控"><a href="#4-Durid-监控功能-其他监控" class="headerlink" title="4 Durid 监控功能-其他监控"></a>4 Durid 监控功能-其他监控</h4><p>注册了 StatViewServlet 后，其他监控功能就已经包含了</p><p>✅ SQL监控 - SQL执行统计</p><p>✅ URL监控 - 请求URL统计</p><p>✅ Session监控 - Session管理</p><p>✅ Spring监控 - 方法执行监控（需额外配置）</p><p>✅ JSON API - 监控数据接口</p><p>✅ 基本监控信息 - JVM、系统信息等</p><h2 id="14-3-Druid-Spring-Boot-Starter"><a href="#14-3-Druid-Spring-Boot-Starter" class="headerlink" title="14.3 Druid Spring Boot Starter"></a>14.3 Druid Spring Boot Starter</h2><p>使用 <code>Druid Spring Boot Starter</code> 可以通过 YAML 配置更简洁地实现监控功能。</p><p><strong>基础依赖配置</strong></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>application.yml 完整配置</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/your_db?useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">your_username</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">your_password</span></span><br><span class="line">    <span class="comment"># Druid 连接池配置</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="comment"># 初始化大小、最小、最大</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="comment"># 配置获取连接等待超时的时间</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span></span><br><span class="line">      <span class="comment"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接</span></span><br><span class="line">      <span class="attr">time-between-eviction-runs-millis:</span> <span class="number">60000</span></span><br><span class="line">      <span class="comment"># 配置一个连接在池中最小生存的时间</span></span><br><span class="line">      <span class="attr">min-evictable-idle-time-millis:</span> <span class="number">300000</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># 监控配置</span></span><br><span class="line">      <span class="attr">web-stat-filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/*</span></span><br><span class="line">        <span class="attr">exclusions:</span> <span class="string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span></span><br><span class="line">        </span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="number">123456</span></span><br><span class="line">        <span class="attr">reset-enable:</span> <span class="literal">false</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># Session监控配置</span></span><br><span class="line">      <span class="attr">web-stat-filter:</span></span><br><span class="line">        <span class="attr">session-stat-enable:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">session-stat-max-count:</span> <span class="number">1000</span></span><br><span class="line">        </span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">stat:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">log-slow-sql:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">slow-sql-millis:</span> <span class="number">2000</span></span><br><span class="line">        <span class="attr">wall:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><strong>可选：自定义配置类</strong></p><p>如果需要进行更复杂的配置，可以添加配置类：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.druid&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>访问监控页面</strong></p><p>配置完成后，访问：<code>http://localhost:8080/druid</code></p><ul><li><strong>用户名</strong>: admin</li><li><strong>密码</strong>: 123456</li></ul><h1 id="15-springboot整合Mybatis"><a href="#15-springboot整合Mybatis" class="headerlink" title="15 springboot整合Mybatis"></a>15 springboot整合Mybatis</h1><h2 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h2><p><strong>Maven 配置</strong></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot Starter --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- MyBatis Spring Boot Starter --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 数据库驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- Druid 连接池 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-配置文件"><a href="#2-配置文件" class="headerlink" title="2. 配置文件"></a>2. 配置文件</h2><p><strong>application.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis_demo?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="comment"># 连接池配置</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># 监控配置</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">web-stat-filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MyBatis 配置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="comment"># mapper.xml 文件位置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="comment"># 实体类包路径</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.example.entity</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># 开启驼峰命名转换</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 日志实现</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><h2 id="3-实体类"><a href="#3-实体类" class="headerlink" title="3. 实体类"></a>3. 实体类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造方法、getter、setter、toString</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String username, String email, Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getter 和 setter 方法...</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, email=&#x27;&quot;</span> + email + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, createTime=&quot;</span> + createTime +</span><br><span class="line">                <span class="string">&quot;, updateTime=&quot;</span> + updateTime +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-Mapper-接口"><a href="#4-Mapper-接口" class="headerlink" title="4. Mapper 接口"></a>4. Mapper 接口</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM user&quot;)</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据ID查询用户</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM user WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入用户</span></span><br><span class="line">    <span class="meta">@Insert(&quot;INSERT INTO user(username, email, age, create_time, update_time) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;VALUES(#&#123;username&#125;, #&#123;email&#125;, #&#123;age&#125;, NOW(), NOW())&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新用户</span></span><br><span class="line">    <span class="meta">@Update(&quot;UPDATE user SET username=#&#123;username&#125;, email=#&#123;email&#125;, age=#&#123;age&#125;, update_time=NOW() &quot; +</span></span><br><span class="line"><span class="meta">            &quot;WHERE id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除用户</span></span><br><span class="line">    <span class="meta">@Delete(&quot;DELETE FROM user WHERE id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据用户名查询</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM user WHERE username LIKE CONCAT(&#x27;%&#x27;, #&#123;username&#125;, &#x27;%&#x27;)&quot;)</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">findByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-XML-Mapper-方式（可选）"><a href="#5-XML-Mapper-方式（可选）" class="headerlink" title="5. XML Mapper 方式（可选）"></a>5. XML Mapper 方式（可选）</h2><p><strong>resources&#x2F;mapper&#x2F;UserMapper.xml</strong></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta">    <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 结果映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;updateTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;update_time&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 复杂查询示例 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByCondition&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserResultMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM user </span><br><span class="line">        WHERE 1=1</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null and username != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND username LIKE CONCAT(&#x27;%&#x27;, #&#123;username&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND email LIKE CONCAT(&#x27;%&#x27;, #&#123;email&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;minAge != null&quot;</span>&gt;</span></span><br><span class="line">            AND age &gt;= #&#123;minAge&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;maxAge != null&quot;</span>&gt;</span></span><br><span class="line">            AND age &lt;= #&#123;maxAge&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        ORDER BY create_time DESC</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 批量插入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;batchInsert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO user(username, email, age, create_time, update_time) </span><br><span class="line">        VALUES</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;user&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (#&#123;user.username&#125;, #&#123;user.email&#125;, #&#123;user.age&#125;, NOW(), NOW())</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="6-Service-层"><a href="#6-Service-层" class="headerlink" title="6. Service 层"></a>6. Service 层</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">save</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (user.getId() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> userMapper.insert(user);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> userMapper.update(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.delete(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findByUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.findByUsername(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-Controller-层"><a href="#7-Controller-层" class="headerlink" title="7. Controller 层"></a>7. Controller 层</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        userService.save(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;用户创建成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        user.setId(id);</span><br><span class="line">        userService.save(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;用户更新成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        userService.delete(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;用户删除成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">searchUsers</span><span class="params">(<span class="meta">@RequestParam</span> String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findByUsername(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="16-springboot整合Mybatis-Plus"><a href="#16-springboot整合Mybatis-Plus" class="headerlink" title="16 springboot整合Mybatis-Plus"></a>16 springboot整合Mybatis-Plus</h1><h2 id="1-添加依赖-1"><a href="#1-添加依赖-1" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h2><p><strong>Maven 配置</strong></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot Starter --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- MyBatis-Plus Starter --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 数据库驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- Druid 连接池 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- Lombok 简化实体类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-配置文件-1"><a href="#2-配置文件-1" class="headerlink" title="2. 配置文件"></a>2. 配置文件</h2><p><strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis_plus_demo?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="comment"># 连接池配置</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># 监控配置</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">web-stat-filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MyBatis-Plus 配置</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment"># mapper.xml 文件位置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mapper/**/*.xml</span></span><br><span class="line">  <span class="comment"># 实体类包路径</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.example.entity</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># 开启驼峰命名转换</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 日志实现</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment"># 主键类型 AUTO:数据库自增 NONE:未设置 INPUT:手动输入 ASSIGN_ID:雪花算法 ASSIGN_UUID:UUID</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">ASSIGN_ID</span></span><br><span class="line">      <span class="comment"># 逻辑删除字段名</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">deleted</span></span><br><span class="line">      <span class="comment"># 逻辑删除值</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br><span class="line">      <span class="comment"># 表名策略</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">t_</span></span><br></pre></td></tr></table></figure><h2 id="3-实体类-1"><a href="#3-实体类-1" class="headerlink" title="3. 实体类"></a>3. 实体类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;user&quot;)</span>  <span class="comment">// 指定表名</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_ID)</span>  <span class="comment">// 雪花算法生成ID</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span>  <span class="comment">// 插入时自动填充</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>  <span class="comment">// 插入和更新时自动填充</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableLogic</span>  <span class="comment">// 逻辑删除注解</span></span><br><span class="line">    <span class="keyword">private</span> Integer deleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-Mapper-接口-1"><a href="#4-Mapper-接口-1" class="headerlink" title="4. Mapper 接口"></a>4. Mapper 接口</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="comment">// 继承 BaseMapper 就拥有了基本的 CRUD 方法</span></span><br><span class="line">    <span class="comment">// 无需编写 XML，也可以自定义方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-Service-层"><a href="#5-Service-层" class="headerlink" title="5. Service 层"></a>5. Service 层</h2><p><strong>接口</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="comment">// 可以自定义业务方法</span></span><br><span class="line">    User <span class="title function_">getByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">updateEmail</span><span class="params">(Long id, String email)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>实现类</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getByUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(User::getUsername, username);</span><br><span class="line">        <span class="keyword">return</span> baseMapper.selectOne(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateEmail</span><span class="params">(Long id, String email)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        user.setEmail(email);</span><br><span class="line">        <span class="keyword">return</span> updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-自动填充处理器"><a href="#6-自动填充处理器" class="headerlink" title="6. 自动填充处理器"></a>6. 自动填充处理器</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strictInsertFill(metaObject, <span class="string">&quot;createTime&quot;</span>, LocalDateTime.class, LocalDateTime.now());</span><br><span class="line">        <span class="built_in">this</span>.strictInsertFill(metaObject, <span class="string">&quot;updateTime&quot;</span>, LocalDateTime.class, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strictUpdateFill(metaObject, <span class="string">&quot;updateTime&quot;</span>, LocalDateTime.class, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-Controller-层-1"><a href="#7-Controller-层-1" class="headerlink" title="7. Controller 层"></a>7. Controller 层</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.list();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据ID查询用户</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 新增用户</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新用户</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        user.setId(id);</span><br><span class="line">        <span class="keyword">return</span> userService.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除用户（逻辑删除）</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分页查询</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;User&gt; <span class="title function_">getUserPage</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer current,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer size)</span> &#123;</span><br><span class="line">        Page&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line">        <span class="keyword">return</span> userService.page(page);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 条件查询</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">searchUsers</span><span class="params">(<span class="meta">@RequestParam</span> String username)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.like(User::getUsername, username)</span><br><span class="line">               .orderByDesc(User::getCreateTime);</span><br><span class="line">        <span class="keyword">return</span> userService.list(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 复杂条件查询</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/condition&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getUsersByCondition</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String username,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> Integer minAge,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> Integer maxAge)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (username != <span class="literal">null</span> &amp;&amp; !username.isEmpty()) &#123;</span><br><span class="line">            wrapper.like(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (minAge != <span class="literal">null</span>) &#123;</span><br><span class="line">            wrapper.ge(<span class="string">&quot;age&quot;</span>, minAge);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (maxAge != <span class="literal">null</span>) &#123;</span><br><span class="line">            wrapper.le(<span class="string">&quot;age&quot;</span>, maxAge);</span><br><span class="line">        &#125;</span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;create_time&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> userService.list(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-配置类（可选）"><a href="#8-配置类（可选）" class="headerlink" title="8. 配置类（可选）"></a>8. 配置类（可选）</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加分页插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-数据库表结构测试"><a href="#9-数据库表结构测试" class="headerlink" title="9. 数据库表结构测试"></a>9. 数据库表结构测试</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> mybatis_plus_demo;</span><br><span class="line"></span><br><span class="line">USE mybatis_plus_demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">    age <span class="type">INT</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">    deleted TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;逻辑删除 0:未删除 1:已删除&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> <span class="keyword">user</span> (id, username, email, age) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;zhangsan@example.com&#x27;</span>, <span class="number">25</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;lisi@example.com&#x27;</span>, <span class="number">30</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;wangwu@example.com&#x27;</span>, <span class="number">28</span>);</span><br></pre></td></tr></table></figure><h2 id="10-测试接口"><a href="#10-测试接口" class="headerlink" title="10. 测试接口"></a>10. 测试接口</h2><p>启动应用后，可以测试以下接口：</p><ul><li><code>GET /api/users</code> - 查询所有用户</li><li><code>GET /api/users/1</code> - 根据ID查询用户</li><li><code>POST /api/users</code> - 新增用户</li><li><code>PUT /api/users/1</code> - 更新用户</li><li><code>DELETE /api/users/1</code> - 删除用户（逻辑删除）</li><li><code>GET /api/users/page?current=1&amp;size=10</code> - 分页查询</li><li><code>GET /api/users/search?username=张</code> - 条件查询</li><li><code>GET /api/users/condition?username=张&amp;minAge=20&amp;maxAge=30</code> - 复杂条件查询</li></ul><h2 id="MyBatis-Plus-特性"><a href="#MyBatis-Plus-特性" class="headerlink" title="MyBatis-Plus 特性"></a>MyBatis-Plus 特性</h2><ol><li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响</li><li><strong>强大的 CRUD</strong>：内置通用 Mapper、通用 Service，少量配置即可实现单表 CRUD</li><li><strong>支持 Lambda</strong>：通过 Lambda 表达式，方便的编写各类查询条件</li><li><strong>主键策略</strong>：支持多种主键策略，可自由配置</li><li><strong>分页插件</strong>：内置分页插件，基于 MyBatis 物理分页</li><li><strong>性能分析</strong>：支持 SQL 性能分析插件</li><li><strong>全局拦截</strong>：提供全表删除、更新操作智能分析阻断</li><li><strong>逻辑删除</strong>：内置逻辑删除功能</li></ol>]]></content>
      
      
      <categories>
          
          <category> java开发 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>软件开发整体介绍</title>
      <link href="/2024/10/03/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%95%B4%E4%BD%93%E4%BB%8B%E7%BB%8D/"/>
      <url>/2024/10/03/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%95%B4%E4%BD%93%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<h2 id="1-软件开发流程"><a href="#1-软件开发流程" class="headerlink" title="1.软件开发流程"></a>1.软件开发流程</h2><img src="1.png" style="zoom: 33%;"><h2 id="2-角色分工"><a href="#2-角色分工" class="headerlink" title="2.角色分工"></a>2.角色分工</h2><img src="2.png" style="zoom:50%;"><h2 id="3-软件环境"><a href="#3-软件环境" class="headerlink" title="3.软件环境"></a>3.软件环境</h2><p><img src="3.png"></p>]]></content>
      
      
      <categories>
          
          <category> java开发 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis持久层框架</title>
      <link href="/2024/03/02/MyBatis%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/"/>
      <url>/2024/03/02/MyBatis%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<h2 id="MyBatis持久层框架"><a href="#MyBatis持久层框架" class="headerlink" title="MyBatis持久层框架"></a>MyBatis持久层框架</h2><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul><li><a href="#%E4%B8%80Mybatis%E7%AE%80%E4%BB%8B">一、Mybatis简介</a><ul><li><a href="#1-%E7%AE%80%E4%BB%8B">1. 简介</a></li><li><a href="#2-%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94">2. 持久层框架对比</a></li><li><a href="#3-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%9F%BA%E4%BA%8EMybatis3%E6%96%B9%E5%BC%8F">3. 快速入门（基于Mybatis3方式）</a></li></ul></li><li><a href="#%E4%BA%8C%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%E6%89%A9%E5%B1%95">二、日志框架扩展</a><ul><li><a href="#1-%E7%94%A8%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E6%9B%BF%E4%BB%A3sout">1. 用日志打印替代sout</a></li><li><a href="#2-Java%E6%97%A5%E5%BF%97%E4%BD%93%E7%B3%BB%E6%BC%94%E5%8F%98">2. Java日志体系演变</a></li><li><a href="#3-%E6%9C%80%E4%BD%B3%E6%8B%8D%E6%A1%A3%E7%94%A8%E6%B3%95">3. 最佳拍档用法</a></li><li><a href="#4-Lombok%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8">4. Lombok插件的使用</a><ul><li><a href="#41-Lombok%E7%AE%80%E4%BB%8B">4.1 Lombok简介</a></li><li><a href="#42-Lombok%E5%AE%89%E8%A3%85">4.2 Lombok安装</a></li><li><a href="#43-Lombok%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3">4.3 Lombok使用注解</a></li></ul></li></ul></li><li><a href="#%E4%B8%89MyBatis%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">三、MyBatis基本使用</a><ul><li><a href="#1-%E5%90%91SQL%E8%AF%AD%E5%8F%A5%E4%BC%A0%E5%8F%82">1. 向SQL语句传参</a><ul><li><a href="#11-mybatis%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA%E9%85%8D%E7%BD%AE">1.1 mybatis日志输出配置</a></li><li><a href="#12-%E5%BD%A2%E5%BC%8F">1.2 #{}形式</a></li><li><a href="#13-%E5%BD%A2%E5%BC%8F">1.3 ${}形式</a></li></ul></li><li><a href="#2-%E6%95%B0%E6%8D%AE%E8%BE%93%E5%85%A5">2. 数据输入</a><ul><li><a href="#21-Mybatis%E6%80%BB%E4%BD%93%E6%9C%BA%E5%88%B6%E6%A6%82%E6%8B%AC">2.1 Mybatis总体机制概括</a></li><li><a href="#22-%E6%A6%82%E5%BF%B5%E8%AF%B4%E6%98%8E">2.2 概念说明</a></li><li><a href="#23-%E5%8D%95%E4%B8%AA%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0">2.3 单个简单类型参数</a></li><li><a href="#24-%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0">2.4 实体类类型参数</a></li><li><a href="#25-%E9%9B%B6%E6%95%A3%E7%9A%84%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE">2.5 零散的简单类型数据</a></li><li><a href="#26-Map%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0">2.6 Map类型参数</a></li></ul></li><li><a href="#3-%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA">3. 数据输出</a><ul><li><a href="#31-%E8%BE%93%E5%87%BA%E6%A6%82%E8%BF%B0">3.1 输出概述</a></li><li><a href="#32-%E5%8D%95%E4%B8%AA%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B">3.2 单个简单类型</a></li><li><a href="#33-%E8%BF%94%E5%9B%9E%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AF%B9%E8%B1%A1">3.3 返回实体类对象</a></li><li><a href="#34-%E8%BF%94%E5%9B%9EMap%E7%B1%BB%E5%9E%8B">3.4 返回Map类型</a></li><li><a href="#35-%E8%BF%94%E5%9B%9EList%E7%B1%BB%E5%9E%8B">3.5 返回List类型</a></li><li><a href="#36-%E8%BF%94%E5%9B%9E%E4%B8%BB%E9%94%AE%E5%80%BC">3.6 返回主键值</a></li><li><a href="#37-%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB">3.7 实体类属性和数据库字段对应关系</a></li></ul></li><li><a href="#4-CRUD%E5%BC%BA%E5%8C%96%E7%BB%83%E4%B9%A0">4. CRUD强化练习</a></li><li><a href="#5-mapperXML%E6%A0%87%E7%AD%BE%E6%80%BB%E7%BB%93">5. mapperXML标签总结</a></li></ul></li><li><a href="#%E5%9B%9BMyBatis%E5%A4%9A%E8%A1%A8%E6%98%A0%E5%B0%84">四、MyBatis多表映射</a><ul><li><a href="#1-%E5%A4%9A%E8%A1%A8%E6%98%A0%E5%B0%84%E6%A6%82%E5%BF%B5">1. 多表映射概念</a></li><li><a href="#2-%E5%AF%B9%E4%B8%80%E6%98%A0%E5%B0%84">2. 对一映射</a></li><li><a href="#3-%E5%AF%B9%E5%A4%9A%E6%98%A0%E5%B0%84">3. 对多映射</a></li><li><a href="#4-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E6%98%A0%E5%B0%84">4. 多对多映射</a></li><li><a href="#5-%E5%A4%9A%E8%A1%A8%E6%98%A0%E5%B0%84%E6%80%BB%E7%BB%93">5. 多表映射总结</a><ul><li><a href="#51-%E5%A4%9A%E8%A1%A8%E6%98%A0%E5%B0%84%E4%BC%98%E5%8C%96">5.1 多表映射优化</a></li><li><a href="#52-%E5%A4%9A%E8%A1%A8%E6%98%A0%E5%B0%84%E6%80%BB%E7%BB%93">5.2 多表映射总结</a></li></ul></li></ul></li><li><a href="#%E4%BA%94MyBatis%E5%8A%A8%E6%80%81%E8%AF%AD%E5%8F%A5">五、MyBatis动态语句</a><ul><li><a href="#1-%E5%8A%A8%E6%80%81%E8%AF%AD%E5%8F%A5%E9%9C%80%E6%B1%82%E5%92%8C%E7%AE%80%E4%BB%8B">1. 动态语句需求和简介</a></li><li><a href="#2-if%E5%92%8Cwhere%E6%A0%87%E7%AD%BE">2. if和where标签</a></li><li><a href="#3-set%E6%A0%87%E7%AD%BE">3. set标签</a></li><li><a href="#4-trim%E6%A0%87%E7%AD%BE%E4%BA%86%E8%A7%A3">4. trim标签(了解)</a></li><li><a href="#5-choosewhenotherwise%E6%A0%87%E7%AD%BE">5. choose&#x2F;when&#x2F;otherwise标签</a></li><li><a href="#6-foreach%E6%A0%87%E7%AD%BE">6. foreach标签</a></li><li><a href="#7-sql%E7%89%87%E6%AE%B5">7. sql片段</a></li></ul></li><li><a href="#%E5%85%ADMyBatis%E9%AB%98%E7%BA%A7%E6%89%A9%E5%B1%95">六、MyBatis高级扩展</a><ul><li><a href="#1-Mapper%E6%89%B9%E9%87%8F%E6%98%A0%E5%B0%84%E4%BC%98%E5%8C%96">1. Mapper批量映射优化</a></li><li><a href="#2-%E6%8F%92%E4%BB%B6%E5%92%8C%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6PageHelper">2. 插件和分页插件PageHelper</a><ul><li><a href="#21-%E6%8F%92%E4%BB%B6%E6%9C%BA%E5%88%B6%E5%92%8CPageHelper%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D">2.1 插件机制和PageHelper插件介绍</a></li><li><a href="#22-PageHelper%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8">2.2 PageHelper插件使用</a></li></ul></li><li><a href="#3-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%92%8CMybatisX%E6%8F%92%E4%BB%B6">3. 逆向工程和MybatisX插件</a><ul><li><a href="#31-ORM%E6%80%9D%E7%BB%B4%E4%BB%8B%E7%BB%8D">3.1 ORM思维介绍</a></li><li><a href="#31-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B">3.1 逆向工程</a></li><li><a href="#32-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%8F%92%E4%BB%B6MyBatisX%E4%BD%BF%E7%94%A8">3.2 逆向工程插件MyBatisX使用</a></li></ul></li></ul></li><li><a href="#%E4%B8%83MyBatis%E6%80%BB%E7%BB%93">七、MyBatis总结</a></li></ul><h2 id="一、Mybatis简介"><a href="#一、Mybatis简介" class="headerlink" title="一、Mybatis简介"></a>一、Mybatis简介</h2><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h3><p><a href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></p><p>MyBatis最初是Apache的一个开源项目iBatis, 2010年6月这个项目由Apache Software Foundation迁移到了Google Code。随着开发团队转投Google Code旗下， iBatis3.x正式更名为MyBatis。代码于2013年11月迁移到Github。</p><p>MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyBatis是持久层的一个半自动化的ORM框架</span><br><span class="line">ORM：Object RelationalShip Mapping  对象关系映射</span><br><span class="line">BaseDao: executeUpdate(),executeQuery()-&gt;解析结果集-&gt;通过反射技术再封装成实体类</span><br></pre></td></tr></table></figure><p><img src="image_6z_rPg5vfi.png"></p><blockquote><p>社区会持续更新开源项目，版本会不断变化，我们不必每个小版本都追，关注重大更新的大版本升级即可。</p></blockquote><p>本课程使用：3.5.11版本</p><h3 id="2-持久层框架对比"><a href="#2-持久层框架对比" class="headerlink" title="2. 持久层框架对比"></a>2. 持久层框架对比</h3><ul><li>JDBC<ul><li>SQL 夹杂在Java代码中耦合度高，导致硬编码内伤</li><li>维护不易且实际开发需求中 SQL 有变化，频繁修改的情况多见</li><li>代码冗长，开发效率低</li></ul></li><li>Hibernate 和 JPA     SSH:Struts  spring  Hibernate<ul><li>操作简便，开发效率高</li><li>程序中的长难复杂 SQL 需要绕过框架</li><li>内部自动生成的 SQL，不容易做特殊优化</li><li>基于全映射的全自动框架，大量字段的 POJO 进行部分映射时比较困难。</li><li>反射操作太多，导致数据库性能下降</li></ul></li><li>MyBatis<ul><li>轻量级，性能出色</li><li>SQL 和 Java 编码分开，功能边界清晰。Java代码专注业务、SQL语句专注数据</li><li>开发效率稍逊于 Hibernate，但是完全能够接收</li></ul></li></ul><p>开发效率：Hibernate&gt;Mybatis&gt;JDBC</p><p>运行效率：JDBC&gt;Mybatis&gt;Hibernate</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">封装程度越高，开发效率就会越高，但是性能就会越差</span><br></pre></td></tr></table></figure><h3 id="3-快速入门（基于Mybatis3方式）"><a href="#3-快速入门（基于Mybatis3方式）" class="headerlink" title="3. 快速入门（基于Mybatis3方式）"></a>3. 快速入门（基于Mybatis3方式）</h3><ol><li><p>准备数据模型</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE `mybatis<span class="operator">-</span>example`;</span><br><span class="line"></span><br><span class="line">USE `mybatis<span class="operator">-</span>example`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> `t_emp`(</span><br><span class="line">  emp_id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">  emp_name <span class="type">CHAR</span>(<span class="number">100</span>),</span><br><span class="line">  emp_salary <span class="keyword">DOUBLE</span>(<span class="number">10</span>,<span class="number">5</span>),</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span>(emp_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> `t_emp`(emp_name,emp_salary) <span class="keyword">VALUES</span>(&quot;tom&quot;,<span class="number">200.33</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> `t_emp`(emp_name,emp_salary) <span class="keyword">VALUES</span>(&quot;jerry&quot;,<span class="number">666.66</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> `t_emp`(emp_name,emp_salary) <span class="keyword">VALUES</span>(&quot;andy&quot;,<span class="number">777.77</span>);</span><br></pre></td></tr></table></figure></li><li><p>项目搭建和准备</p><ol><li><p>项目搭建</p><p><img src="image_aTxxzrw9eO.png"></p></li><li><p>依赖导入</p><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- mybatis依赖 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- MySQL驱动 mybatis底层依赖jdbc驱动实现,本次不需要导入连接池,mybatis自带! --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--junit5测试--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>实体类准备</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer empId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String empName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double empSalary;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//getter | setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li><p>准备Mapper接口和MapperXML文件</p><p>MyBatis 框架下，SQL语句编写位置发生改变，从原来的Java类，改成XML或者注解定义！</p><p>推荐在XML文件中编写SQL语句，让用户能更专注于 SQL 代码，不用关注其他的JDBC代码。</p><p>如果拿它跟具有相同功能的 JDBC 代码进行对比，你会立即发现省掉了将近 95% 的代码！！</p><p>一般编写SQL语句的文件命名：XxxMapper.xml  Xxx一般取表名！！</p><p>Mybatis 中的 Mapper 接口相当于以前的 Dao。但是区别在于，Mapper 仅仅只是建接口即可，我们不需要提供实现类，具体的SQL写到对应的Mapper文件，该用法的思路如下图所示：</p><p><img src="image_b2QPM-sxTg.png"></p><ol><li><p>定义mapper接口</p><p>包：com.wzb.mapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wzb.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wzb.pojo.Employee;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * t_emp表对应数据库SQL语句映射接口!</span></span><br><span class="line"><span class="comment"> *    接口只规定方法,参数和返回值!</span></span><br><span class="line"><span class="comment"> *    mapper.xml中编写具体SQL语句!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据员工id查询员工数据方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> empId  员工id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 员工实体对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Employee <span class="title function_">selectEmployee</span><span class="params">(Integer empId)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>定义mapper xml</p><p>位置： resources&#x2F;mappers&#x2F;EmployeeMapper.xml</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace等于mapper接口类的全限定名,这样实现对应 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.wzb.mapper.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 查询使用 select标签</span></span><br><span class="line"><span class="comment">            id = 方法名</span></span><br><span class="line"><span class="comment">            resultType = 返回值类型</span></span><br><span class="line"><span class="comment">            标签内编写SQL语句</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployee&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wzb.pojo.Employee&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- #&#123;empId&#125;代表动态传入的参数,并且进行赋值!后面详细讲解 --&gt;</span></span><br><span class="line">        select emp_id empId,emp_name empName, emp_salary empSalary from </span><br><span class="line">           t_emp where emp_id = #&#123;empId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注意：</strong></p><ul><li>方法名和SQL的id一致</li><li>方法返回值和resultType一致</li><li>方法的参数和SQL的参数一致</li><li>接口的全类名和映射配置文件的名称空间一致</li></ul></li></ol></li><li><p>准备MyBatis配置文件</p><p>mybatis框架配置文件： 数据库连接信息，性能配置，mapper.xml配置等！</p><p>习惯上命名为 mybatis-config.xml，这个文件名仅仅只是建议，并非强制要求。将来整合 Spring 之后，这个配置文件可以省略，所以大家操作时可以直接复制、粘贴。</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- environments表示配置Mybatis的开发环境，可以配置多个环境，在众多具体环境中，使用default属性指定实际运行时使用的环境。default属性的取值是environment标签的id属性的值。 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- environment表示配置Mybatis的一个具体的环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Mybatis的内置的事务管理器 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 配置数据源 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 建立数据库连接的具体信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis-example&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Mapper注册：指定Mybatis映射文件的具体位置 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mapper标签：配置一个具体的Mapper映射文件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- resource属性：指定Mapper映射文件的实际存储位置，这里需要使用一个以类路径根目录为基准的相对路径 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    对Maven工程的目录结构来说，resources目录下的内容会直接放入类路径，所以这里我们可以以resources目录为基准 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/EmployeeMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>运行和测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * projectName: com.wzb.test</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * description: 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectEmployee</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.创建SqlSessionFactory对象</span></span><br><span class="line">        <span class="comment">// ①声明Mybatis全局配置文件的路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">mybatisConfigFilePath</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ②以输入流的形式加载Mybatis配置文件</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(mybatisConfigFilePath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ③基于读取Mybatis配置文件的输入流创建SqlSessionFactory对象</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.使用SqlSessionFactory对象开启一个会话</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.根据EmployeeMapper接口的Class对象获取Mapper接口类型的对象(动态代理技术)</span></span><br><span class="line">        <span class="type">EmployeeMapper</span> <span class="variable">employeeMapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 调用代理类方法既可以触发对应的SQL语句</span></span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeMapper.selectEmployee(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;employee = &quot;</span> + employee);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.关闭SqlSession</span></span><br><span class="line">        session.commit(); <span class="comment">//提交事务 [DQL不需要,其他需要]</span></span><br><span class="line">        session.close(); <span class="comment">//关闭会话</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>说明：</p><ul><li>SqlSession：代表Java程序和数据库之间的会话。（HttpSession是Java程序和浏览器之间的会话）</li><li>SqlSessionFactory：是“生产”SqlSession的“工厂”。</li><li>工厂模式：如果创建某一个对象，使用的过程基本固定，那么我们就可以把创建这个对象的相关代码封装到一个“工厂类”中，以后都使用这个工厂类来“生产”我们需要的对象。</li></ul></li><li><p>SqlSession和HttpSession区别</p><ul><li>HttpSession：工作在Web服务器上，属于表述层。<ul><li>代表浏览器和Web服务器之间的会话。</li></ul></li><li>SqlSession：不依赖Web服务器，属于持久化层。<ul><li>代表Java程序和数据库之间的会话。<br><img src="image_EhZwteiZyj.png"></li></ul></li></ul></li></ol><h2 id="二、日志框架扩展"><a href="#二、日志框架扩展" class="headerlink" title="二、日志框架扩展"></a>二、日志框架扩展</h2><h3 id="1-用日志打印替代sout"><a href="#1-用日志打印替代sout" class="headerlink" title="1. 用日志打印替代sout"></a>1. 用日志打印替代sout</h3><ol><li>sout有什么问题<ol><li><p>问题1：I&#x2F;O影响性能</p><p>System.out对象是一个输出流对象，所以控制台输出信息本质上是I&#x2F;O操作。而I&#x2F;O操作是项目运行过程中两大性能瓶颈之一。</p><p><img src="image_1eSjjIde_q.png"></p></li><li><p>问题2：无法统一管理</p><p>项目上线时，希望把所有（或一部分）sout打印关闭，但是只能手动一个一个查找，耗费开发人员的极大精力，因为sout的无度使用会使它分散在项目的各个角落。</p></li><li><p>问题3：显得你很low</p><p>想看某个变量的值，只会使用sout在控制台打印出来，不会debug，这只能被人鄙视。</p></li></ol></li><li>使用[日志框架]的好处<ol><li><p>设定级别，统一管理</p><p>日志框架会按照事件的严重程度来划分级别，例如：</p><ul><li>错误（Error）：表示程序运行出错，比如抛异常等情况。</li><li>警告（Warning）：表示程序运行过程中有潜在风险，但此时并没有报错。</li><li>信息（Info）：表示程序运行过程中完成了一个关键动作，需要以程序运行信息的形式告知开发者。</li><li>调试（Debug）：表示程序运行过程中更加细致的信息，协助程序员调试程序。<blockquote><p>📌Tips：各种不同的具体日志系统会使用不同的日志级别名称，也可能有更多个级别设定。但是思想是一致的。<br>通过在配置文件中指定某一个日志级别来控制系统要打印的内容。日志框架会打印<strong>当前指定级别</strong>的日志和比当前指定级别<strong>更严重</strong>的级别的日志。<br>例如在开发阶段，我们指定debug级别，项目上线修改成info级别，那么所有debug级别的日志就都不打印了，不需要到项目代码中一个一个修改，非常方便。</p></blockquote></li></ul></li><li><p>灵活指定输出位置</p><p>使用日志框架不一定是打印到控制台，也可以保存到文件中或者保存到数据库。这就看具体的项目维护需求。</p></li><li><p>自定义日志格式</p><p>打印日志数据可以使用日志框架的默认格式，也可以根据需要定制。</p><p><img src="image_1K6lhufTYa.png"></p></li><li><p>基于日志分析问题</p><p>将来我们开发的应用系统中，不仅包含Java代码，还有很多中间件服务器。任何子系统出现故障我们都是通过日志来定位问题、分析故障原因。甚至更复杂的系统还会专门开发日志子系统，在主系统出现问题时抓取日志数据供维护人员参考。</p><p>而日志数据必须要有确定格式才便于格式化和抓取，这肯定不是随意写sout就能实现的。</p></li></ol></li></ol><h3 id="2-Java日志体系演变"><a href="#2-Java日志体系演变" class="headerlink" title="2. Java日志体系演变"></a>2. Java日志体系演变</h3><p>1996年早期，欧洲安全电子市场项目组决定编写它自己的程序跟踪API(Tracing API)。经过不断的完善，这个API终于成为一个十分受欢迎的Java日志软件包，即Log4j（由Ceki创建）。后来Log4j成为Apache基金会项目中的一员,Ceki也加入Apache组织。​ 后来Log4j近乎成了Java社区的日志标准。据说Apache基金会还曾经建议Sun引入Log4j到java的标准库中，但Sun拒绝了。​ 2002年Java1.4发布，Sun推出了自己的日志库JUL(Java Util Logging),其实现基本模仿了Log4j的实现。在JUL出来以前，Log4j就已经成为一项成熟的技术，使得Log4j在选择上占据了一定的优势。​ 接着，Apache推出了Jakarta Commons Logging门面，看来Apache想统一日志江湖了，JCL只是定义了一套日志接口(其内部也提供一个Simple Log的简单实现)，支持运行时动态加载日志组件的实现，也就是说，在你应用代码里，只需调用Commons Logging的接口，底层实现可以是Log4j，也可以是JUL(Java实现)。​ 后来(2006年)，Ceki不适应Apache的工作方式，离开了Apache。然后先后创建了Slf4j(日志门面接口，类似于Commons Logging)和Logback(Slf4j的实现)两个项目，并回瑞典创建了QOS公司，QOS官网上是这样描述Logback的：The Generic，Reliable Fast&amp;Flexible Logging Framework(一个通用，可靠，快速且灵活的日志框架)。</p><p>门面：类似于标准层、接口层</p><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>JCL（Jakarta Commons Logging）</td><td>陈旧</td></tr><tr><td>SLF4J（Simple Logging Facade for Java）</td><td>适合（<strong>同一作者</strong>）</td></tr><tr><td>jboss-logging</td><td>特殊专业领域使用</td></tr></tbody></table><p>实现</p><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>log4j</td><td>最初版（<strong>同一作者</strong>）</td></tr><tr><td>JUL（java.util.logging）</td><td>JDK自带</td></tr><tr><td>log4j2</td><td>Apache收购log4j后全面重构，内部实现和log4j完全不同</td></tr><tr><td>logback</td><td>优雅、强大（<strong>同一作者</strong>）</td></tr></tbody></table><p><strong>最佳拍档</strong></p><ul><li>门面：SLF4J</li><li>实现：logback</li></ul><h3 id="3-最佳拍档用法"><a href="#3-最佳拍档用法" class="headerlink" title="3. 最佳拍档用法"></a>3. 最佳拍档用法</h3><ol><li><p>依赖导入</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 日志 ， 会自动传递slf4j门面--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>代码测试</p><p>代码图解</p><p><img src="image_HasKvwKkFt.png"></p><p>测试结果</p><p><img src="image_rM7o5_JxMx.png"></p></li><li><p>引入配置</p><p>Logback要求配置文件名称必须是logback.xml，存放路径在main&#x2F;resources目录下。</p><p><img src="image_1yTJ2l_3CU.png"></p><p>通过配置文件，可以配置输出格式、输出级别、输出位置等！</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定日志输出的位置，ConsoleAppender表示输出到控制台 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 日志输出的格式 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 按照顺序分别是：时间、日志级别、线程名称、打印日志的类、日志主体内容、换行 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>[%d&#123;HH:mm:ss.SSS&#125;] [%-5level] [%thread] [%logger] [%msg]%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 设置全局日志级别。日志级别按顺序分别是：TRACE、DEBUG、INFO、WARN、ERROR --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定任何一个日志级别都只打印当前级别和后面级别的日志。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定打印日志的appender，这里通过“STDOUT”引用了前面配置的appender --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据特殊需求指定局部日志级别，可以是包名或全类名。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.wzb.mybatis&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>mybatis日志输出配置</p><p>我们可以在mybatis的配置文件使用<strong>settings标签</strong>设置，输出运行过程SQL日志！</p><p>日志配置：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- SLF4J 选择slf4j输出！ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SLF4J&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="4-Lombok插件的使用"><a href="#4-Lombok插件的使用" class="headerlink" title="4. Lombok插件的使用"></a>4. Lombok插件的使用</h3><h4 id="4-1-Lombok简介"><a href="#4-1-Lombok简介" class="headerlink" title="4.1 Lombok简介"></a>4.1 Lombok简介</h4><p>传统实体类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer empId;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String empName;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Double empSalary;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getEmpId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> empId;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmpId</span><span class="params">(Integer empId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.empId = empId;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmpName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> empName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmpName</span><span class="params">(String empName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.empName = empName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getEmpSalary</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> empSalary;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmpSalary</span><span class="params">(Double empSalary)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.empSalary = empSalary;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Employee&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;empId=&quot;</span> + empId +</span><br><span class="line">                <span class="string">&quot;, empName=&#x27;&quot;</span> + empName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, empSalary=&quot;</span> + empSalary +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(Integer empId, String empName, Double empSalary)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.empId = empId;</span><br><span class="line">        <span class="built_in">this</span>.empName = empName;</span><br><span class="line">        <span class="built_in">this</span>.empSalary = empSalary;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用Lombok</p><p>既然getXxx()、setXxx()方法、toString()方法、构造器都是按照固定格式生成的，那能否由程序自动生成呢？</p><p><img src="image_etk1A3OTpm.png"></p><p>使用Lombok注解就可以省略生成getXxx()、setXxx()方法、toString()方法、构造器等固定格式代码的繁琐操作，提高开发效率。包括Logger日志对象。</p><p>Lombok原理</p><p>Lombok是将自动生成的代码织入字节码文件中，从而实现：源代码没有，但是字节码文件有——毕竟我们最终运行的是字节码文件，只要字节码文件中有即可。而这个过程因为要参与源文件编译，所以需要安装IDEA插件。</p><h4 id="4-2-Lombok安装"><a href="#4-2-Lombok安装" class="headerlink" title="4.2 Lombok安装"></a>4.2 Lombok安装</h4><p><img src="image_CCXiQR1OtY.png"></p><p><img src="image_KSrGd0biVQ.png"></p><p><img src="image_PoEh-9GVrR.png"></p><h4 id="4-3-Lombok使用注解"><a href="#4-3-Lombok使用注解" class="headerlink" title="4.3 Lombok使用注解"></a>4.3 Lombok使用注解</h4><p>加入依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注解功能</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>注解</td><td>作用</td></tr><tr><td>@Data</td><td>生成getXxx()方法、setXxx()方法、toString()、equals()、canEqual()、hashCode()方法</td></tr><tr><td>@AllArgsConstructor</td><td>生成全参构造器</td></tr><tr><td>@NoArgsConstructor</td><td>生成无参构造器</td></tr><tr><td>@Slf4j</td><td>生成日志对象</td></tr><tr><td>@Getter</td><td>生成getXxx()方法</td></tr><tr><td>@Setter</td><td>生成setXxx()方法</td></tr><tr><td>@ToString</td><td>生成toString()方法</td></tr></tbody></table><h2 id="三、MyBatis基本使用"><a href="#三、MyBatis基本使用" class="headerlink" title="三、MyBatis基本使用"></a>三、MyBatis基本使用</h2><h3 id="1-向SQL语句传参"><a href="#1-向SQL语句传参" class="headerlink" title="1. 向SQL语句传参"></a>1. 向SQL语句传参</h3><h4 id="1-2-形式"><a href="#1-2-形式" class="headerlink" title="1.2 #{}形式"></a>1.2 <strong>#{}形式</strong></h4><p>Mybatis会将SQL语句中的#{}转换为问号占位符。</p><p><img src="image_8RlmGCLaBQ.png"></p><h4 id="1-3-形式"><a href="#1-3-形式" class="headerlink" title="1.3 ${}形式"></a>1.3 <strong>${}形式</strong></h4><p>${}形式传参，底层Mybatis做的是字符串拼接操作。</p><p><img src="image__ojXNgTyaD.png"></p><p>通常不会采用${}的方式传值。一个特定的适用场景是：通过Java程序动态生成数据库表，表名部分需要Java程序通过参数传入；而JDBC对于表名部分是不能使用问号占位符的，此时只能使用</p><p>结论：实际开发中，能用#{}实现的，肯定不用${}。</p><p>特殊情况： 动态的不是值，是列名或者关键字，需要使用${}拼接</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//注解方式传入参数！！</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from user where $&#123;column&#125; = #&#123;value&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findByColumn</span><span class="params">(<span class="meta">@Param(&quot;column&quot;)</span> String column, </span></span><br><span class="line"><span class="params">                                <span class="meta">@Param(&quot;value&quot;)</span> String value)</span>;</span><br></pre></td></tr></table></figure><h3 id="2-数据输入"><a href="#2-数据输入" class="headerlink" title="2. 数据输入"></a>2. 数据输入</h3><h4 id="2-1-Mybatis总体机制概括"><a href="#2-1-Mybatis总体机制概括" class="headerlink" title="2.1 Mybatis总体机制概括"></a>2.1 <strong>Mybatis总体机制概括</strong></h4><p>MyBatis 是一个 ORM 框架，核心工作是做 Java对象 和 数据库数据 之间的映射和转换。它通过配置和映射，将 JDBC 的复杂操作封装起来，让你能像操作对象一样操作数据库。</p><h4 id="2-2-概念说明"><a href="#2-2-概念说明" class="headerlink" title="2.2 概念说明"></a>2.2 <strong>概念说明</strong></h4><p>这里数据输入具体是指上层方法（例如Service方法）调用Mapper接口时，数据传入的形式。</p><ul><li>简单类型：只包含一个值的数据类型<ul><li>基本数据类型：int、byte、short、double、……</li><li>基本数据类型的包装类型：Integer、Character、Double、……</li><li>字符串类型：String</li></ul></li><li>复杂类型：包含多个值的数据类型<ul><li>实体类类型：Employee、Department、……</li><li>集合类型：List、Set、Map、……</li><li>数组类型：int[]、String[]、……</li><li>复合类型：List&lt;Employee&gt;、实体类中包含集合……</li></ul></li></ul><h4 id="2-3-单个简单类型参数"><a href="#2-3-单个简单类型参数" class="headerlink" title="2.3 单个简单类型参数"></a>2.3 <strong>单个简单类型参数</strong></h4><p>Mapper接口中抽象方法的声明</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Employee <span class="title function_">selectEmployee</span><span class="params">(Integer empId)</span>;</span><br></pre></td></tr></table></figure><p>SQL语句</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployee&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wzb.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">  select emp_id empId,emp_name empName,emp_salary empSalary from t_emp where emp_id=#&#123;empId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>单个简单类型参数，在#{}中可以随意命名，但是没有必要。通常还是使用和接口方法参数同名。</p></blockquote><h4 id="2-4-实体类类型参数"><a href="#2-4-实体类类型参数" class="headerlink" title="2.4 实体类类型参数"></a>2.4 <strong>实体类类型参数</strong></h4><p>Mapper接口中抽象方法的声明</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">insertEmployee</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><p>SQL语句</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertEmployee&quot;</span>&gt;</span></span><br><span class="line">  insert into t_emp(emp_name,emp_salary) values(#&#123;empName&#125;,#&#123;empSalary&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p>对应关系</p><p><img src="http://heavy_code_industry.gitee.io/code_heavy_industry/assets/img/img006.f9958c52.png"></p><p>结论</p><p>Mybatis会根据#{}中传入的数据，加工成getXxx()方法，通过反射在实体类对象中调用这个方法，从而获取到对应的数据。填充到#{}解析后的问号占位符这个位置。</p><h4 id="2-5-零散的简单类型数据"><a href="#2-5-零散的简单类型数据" class="headerlink" title="2.5 零散的简单类型数据"></a>2.5 <strong>零散的简单类型数据</strong></h4><p>零散的多个简单类型参数，如果没有特殊处理，那么Mybatis无法识别自定义名称：</p><p><img src="image_eE-zzn7oRy.png"></p><p>Mapper接口中抽象方法的声明</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateEmployee</span><span class="params">(<span class="meta">@Param(&quot;empId&quot;)</span> Integer empId,<span class="meta">@Param(&quot;empSalary&quot;)</span> Double empSalary)</span>;</span><br></pre></td></tr></table></figure><p>SQL语句</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmployee&quot;</span>&gt;</span></span><br><span class="line">  update t_emp set emp_salary=#&#123;empSalary&#125; where emp_id=#&#123;empId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p>对应关系</p><p><img src="http://heavy_code_industry.gitee.io/code_heavy_industry/assets/img/img007.976da128.png"></p><h4 id="2-6-Map类型参数"><a href="#2-6-Map类型参数" class="headerlink" title="2.6 Map类型参数"></a>2.6 <strong>Map类型参数</strong></h4><p>Mapper接口中抽象方法的声明</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateEmployeeByMap</span><span class="params">(Map&lt;String, Object&gt; paramMap)</span>;</span><br></pre></td></tr></table></figure><p>SQL语句</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmployeeByMap&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  update t_emp set emp_salary=#&#123;empSalaryKey&#125; where emp_id=#&#123;empIdKey&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p>junit测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> SqlSession session;</span><br><span class="line"><span class="comment">//junit5会在每一个@Test方法前执行@BeforeEach方法</span></span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    session = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>()</span><br><span class="line">            .build(</span><br><span class="line">                    Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>))</span><br><span class="line">            .openSession();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateEmpNameByMap</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">  Map&lt;String, Object&gt; paramMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">  paramMap.put(<span class="string">&quot;empSalaryKey&quot;</span>, <span class="number">999.99</span>);</span><br><span class="line">  paramMap.put(<span class="string">&quot;empIdKey&quot;</span>, <span class="number">5</span>);</span><br><span class="line">  <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> mapper.updateEmployeeByMap(paramMap);</span><br><span class="line">  log.info(<span class="string">&quot;result = &quot;</span> + result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//junit5会在每一个@Test方法后执行@@AfterEach方法</span></span><br><span class="line"><span class="meta">@AfterEach</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">    session.commit();</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>对应关系</strong></p><p>#{}中写Map中的key</p><p><strong>使用场景</strong></p><p>有很多零散的参数需要传递，但是没有对应的实体类类型可以使用。使用@Param注解一个一个传入又太麻烦了。所以都封装到Map中。</p><h3 id="3-数据输出"><a href="#3-数据输出" class="headerlink" title="3. 数据输出"></a>3. 数据输出</h3><h4 id="3-1-输出概述"><a href="#3-1-输出概述" class="headerlink" title="3.1 输出概述"></a>3.1 输出概述</h4><p>数据输出总体上有两种形式：</p><ul><li>增删改操作返回的受影响行数：直接使用 int 或 long 类型接收即可</li><li>查询操作的查询结果</li></ul><p>我们需要做的是，指定查询的输出数据类型即可！</p><p>并且插入场景下，实现主键数据回显示！</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span> ;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">psmt</span> <span class="operator">=</span> <span class="literal">null</span> ;</span><br><span class="line">        <span class="comment">// Statement  PreparedStatement  CallableStatement</span></span><br><span class="line">        psmt = conn.prepareStatement(<span class="string">&quot;sql&quot;</span> , Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> psmt.executeUpdate(); <span class="comment">//返回的是影响行数</span></span><br><span class="line">        <span class="comment">//如果是insert，而且数据库是自增列。如何获取自增列的值呢？</span></span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> psmt.getGeneratedKeys();</span><br><span class="line">        <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> rs.getLong(<span class="number">1</span>); <span class="comment">//获取自增列的值</span></span><br><span class="line">        <span class="comment">//为什么需要获取自增列的值？</span></span><br><span class="line">        <span class="comment">//场景： 确认订单这个动作中，至少包含两大操作：1) 向订单表insert一条记录    2) 向订单详情表添加n条记录</span></span><br><span class="line">        <span class="comment">// 订单详情表中有一列：订单id号，是一个外键，指向订单表的id</span></span><br><span class="line">        <span class="comment">// 因此第二步操作时，必须知道第一步返回的自增列的值</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        订单表：</span></span><br><span class="line"><span class="comment">        id    userid    money   orderDate</span></span><br><span class="line"><span class="comment">        1     u001      99      2023-10-07 13:50:30</span></span><br><span class="line"><span class="comment">        2     u002      15      2023-10-07 13:51:35</span></span><br><span class="line"><span class="comment">        订单详情表：</span></span><br><span class="line"><span class="comment">        id    productId   price    productCount     orderId</span></span><br><span class="line"><span class="comment">        1     p001        9        2                1</span></span><br><span class="line"><span class="comment">        2     p002        5        1                1</span></span><br><span class="line"><span class="comment">        3     p006        8        5                1</span></span><br><span class="line"><span class="comment">         */</span></span><br></pre></td></tr></table></figure><h4 id="3-2-单个简单类型"><a href="#3-2-单个简单类型" class="headerlink" title="3.2 单个简单类型"></a>3.2 单个简单类型</h4><p>Mapper接口中的抽象方法</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">selectEmpCount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>SQL语句</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmpCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select count(*) from t_emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>Mybatis 内部给常用的数据类型设定了很多别名。 以 int 类型为例，可以写的名称有：int、integer、Integer、java.lang.Integer、Int、INT、INTEGER 等等。</p></blockquote><p>junit测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEmpCount</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">EmployeeMapper</span> <span class="variable">employeeMapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> employeeMapper.selectEmpCount();</span><br><span class="line"></span><br><span class="line">  log.info(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>细节解释：</strong></p><p>select标签，通过resultType指定查询返回值类型！</p><p>resultType &#x3D; “全限定符 ｜ 别名 ｜ 如果是返回集合类型，写范型类型即可”</p><p>别名问题：</p><p><a href="https://mybatis.org/mybatis-3/zh/configuration.html#typeAliases" title="https:&#x2F;&#x2F;mybatis.org&#x2F;mybatis-3&#x2F;zh&#x2F;configuration.html#typeAliases">https://mybatis.org/mybatis-3/zh/configuration.html#typeAliases</a></p><p>类型别名可为 Java 类型设置一个缩写名字。 它仅用于 XML 配置，意在降低冗余的全限定类名书写。例如：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Author&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Author&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Blog&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当这样配置时，<code>Blog</code> 可以用在任何使用 <code>domain.blog.Blog</code> 的地方。</p><p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，比如：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span> <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;domain.blog&quot;</span>/&gt;</span> <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>每一个在包 <code>domain.blog</code> 中的 Java Bean，在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名。 比如 <code>domain.blog.Author</code> 的别名为 <code>author</code>；若有注解，则别名为其注解值。见下面的例子：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;author&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Author</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面是Mybatis为常见的 Java 类型内建的类型别名。它们都是不区分大小写的，注意，为了应对原始类型的命名重复，采取了特殊的命名风格。</p><table><thead><tr><th>别名</th><th>映射的类型</th></tr></thead><tbody><tr><td>_byte</td><td>byte</td></tr><tr><td>_char (since 3.5.10)</td><td>char</td></tr><tr><td>_character (since 3.5.10)</td><td>char</td></tr><tr><td>_long</td><td>long</td></tr><tr><td>_short</td><td>short</td></tr><tr><td>_int</td><td>int</td></tr><tr><td>_integer</td><td>int</td></tr><tr><td>_double</td><td>double</td></tr><tr><td>_float</td><td>float</td></tr><tr><td>_boolean</td><td>boolean</td></tr><tr><td>string</td><td>String</td></tr><tr><td>byte</td><td>Byte</td></tr><tr><td>char (since 3.5.10)</td><td>Character</td></tr><tr><td>character (since 3.5.10)</td><td>Character</td></tr><tr><td>long</td><td>Long</td></tr><tr><td>short</td><td>Short</td></tr><tr><td>int</td><td>Integer</td></tr><tr><td>integer</td><td>Integer</td></tr><tr><td>double</td><td>Double</td></tr><tr><td>float</td><td>Float</td></tr><tr><td>boolean</td><td>Boolean</td></tr><tr><td>date</td><td>Date</td></tr><tr><td>decimal</td><td>BigDecimal</td></tr><tr><td>bigdecimal</td><td>BigDecimal</td></tr><tr><td>biginteger</td><td>BigInteger</td></tr><tr><td>object</td><td>Object</td></tr><tr><td>object[]</td><td>Object[]</td></tr><tr><td>map</td><td>Map</td></tr><tr><td>hashmap</td><td>HashMap</td></tr><tr><td>list</td><td>List</td></tr><tr><td>arraylist</td><td>ArrayList</td></tr><tr><td>collection</td><td>Collection</td></tr></tbody></table><h4 id="3-3-返回实体类对象"><a href="#3-3-返回实体类对象" class="headerlink" title="3.3 返回实体类对象"></a>3.3 返回实体类对象</h4><p>Mapper接口的抽象方法</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Employee <span class="title function_">selectEmployee</span><span class="params">(Integer empId)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>SQL语句</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 编写具体的SQL语句，使用id属性唯一的标记一条SQL语句 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- resultType属性：指定封装查询结果的Java实体类的全类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployee&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wzb.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Mybatis负责把SQL语句中的#&#123;&#125;部分替换成“?”占位符 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 给每一个字段设置一个别名，让别名和Java实体类中属性名一致 --&gt;</span></span><br><span class="line">  select emp_id empId,emp_name empName,emp_salary empSalary from t_emp where emp_id=#&#123;maomi&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过给数据库表字段加别名，让查询结果的每一列都和Java实体类中属性对应起来。</p><p>增加全局配置自动识别对应关系</p><p>在 Mybatis 全局配置文件中，做了下面的配置，select语句中可以不给字段设置别名</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在全局范围内对Mybatis进行配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 具体配置 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 从org.apache.ibatis.session.Configuration类中可以查看能使用的配置项 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 将mapUnderscoreToCamelCase属性配置为true，表示开启自动映射驼峰式命名规则 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 规则要求数据库表字段命名方式：单词_单词 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 规则要求Java实体类属性名命名方式：首字母小写的驼峰式命名 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-4-返回Map类型"><a href="#3-4-返回Map类型" class="headerlink" title="3.4 返回Map类型"></a>3.4 返回Map类型</h4><p>适用于SQL查询返回的各个字段综合起来并不和任何一个现有的实体类对应，没法封装到实体类对象中。能够封装成实体类类型的，就不使用Map类型。</p><p>Mapper接口的抽象方法</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String,Object&gt; <span class="title function_">selectEmpNameAndMaxSalary</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>SQL语句</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Map&lt;String,Object&gt; selectEmpNameAndMaxSalary(); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 返回工资最高的员工的姓名和他的工资 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmpNameAndMaxSalary&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  SELECT</span><br><span class="line">    emp_name 员工姓名,</span><br><span class="line">    emp_salary 员工工资,</span><br><span class="line">    (SELECT AVG(emp_salary) FROM t_emp) 部门平均工资</span><br><span class="line">  FROM t_emp WHERE emp_salary=(</span><br><span class="line">    SELECT MAX(emp_salary) FROM t_emp</span><br><span class="line">  )</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 或者：  查询部门ID号以及部门的平均薪资 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> select deptNo , avg(sal) as avg_sal from emp group by deptNo</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> deptNo , avg_sal</span></span><br><span class="line"><span class="comment"> d001     1500</span></span><br><span class="line"><span class="comment"> d002     1750</span></span><br><span class="line"><span class="comment"> d003     1600</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><p>junit测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQueryEmpNameAndSalary</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">EmployeeMapper</span> <span class="variable">employeeMapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line"></span><br><span class="line">  Map&lt;String, Object&gt; resultMap = employeeMapper.selectEmpNameAndMaxSalary();</span><br><span class="line"></span><br><span class="line">  Set&lt;Map.Entry&lt;String, Object&gt;&gt; entrySet = resultMap.entrySet();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : entrySet) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line"></span><br><span class="line">    <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line"></span><br><span class="line">    log.info(key + <span class="string">&quot;=&quot;</span> + value);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-5-返回List类型"><a href="#3-5-返回List类型" class="headerlink" title="3.5 返回List类型"></a>3.5 返回List类型</h4><p>查询结果返回多个实体类对象，希望把多个实体类对象放在List集合中返回。此时不需要任何特殊处理，在resultType属性中还是设置实体类类型即可。</p><p>Mapper接口中抽象方法</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Employee&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>SQL语句</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;Employee&gt; selectAll(); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wzb.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">  select emp_id empId,emp_name empName,emp_salary empSalary</span><br><span class="line">  from t_emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>junit测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectAll</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">EmployeeMapper</span> <span class="variable">employeeMapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">  List&lt;Employee&gt; employeeList = employeeMapper.selectAll();</span><br><span class="line">  <span class="keyword">for</span> (Employee employee : employeeList) &#123;</span><br><span class="line">    log.info(<span class="string">&quot;employee = &quot;</span> + employee);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-6-返回主键值"><a href="#3-6-返回主键值" class="headerlink" title="3.6 返回主键值"></a>3.6 返回主键值</h4><ol><li><p><strong>自增长类型主键</strong></p><p>Mapper接口中的抽象方法</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">insertEmployee</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><p>SQL语句</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- int insertEmployee(Employee employee); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- useGeneratedKeys属性字面意思就是“使用生成的主键” --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- keyProperty属性可以指定主键在实体类对象中对应的属性名，Mybatis会将拿到的主键值存入这个属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertEmployee&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;empId&quot;</span>&gt;</span></span><br><span class="line">  insert into t_emp(emp_name,emp_salary)</span><br><span class="line">  values(#&#123;empName&#125;,#&#123;empSalary&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p>junit测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSaveEmp</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">EmployeeMapper</span> <span class="variable">employeeMapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">  <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">  employee.setEmpName(<span class="string">&quot;john&quot;</span>);</span><br><span class="line">  employee.setEmpSalary(<span class="number">666.66</span>);</span><br><span class="line">  employeeMapper.insertEmployee(employee);</span><br><span class="line">  log.info(<span class="string">&quot;employee.getEmpId() = &quot;</span> + employee.getEmpId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意</p><p>Mybatis是将自增主键的值设置到实体类对象中，而不是以Mapper接口方法返回值的形式返回。</p></li><li><p><strong>非自增长类型主键</strong></p><p>而对于不支持自增型主键的数据库（例如 Oracle）或者字符串类型主键，则可以使用 selectKey 子元素：selectKey 元素将会首先运行，id 会被设置，然后插入语句会被调用！</p><p>使用 <code>selectKey</code> 帮助插入UUID作为字符串类型主键示例：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.String&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">        SELECT UUID() as id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    INSERT INTO user (id, username, password) </span><br><span class="line">    VALUES (</span><br><span class="line">        #&#123;id&#125;,</span><br><span class="line">        #&#123;username&#125;,</span><br><span class="line">        #&#123;password&#125;</span><br><span class="line">    )</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在上例中，我们定义了一个 <code>insertUser</code> 的插入语句来将 <code>User</code> 对象插入到 <code>user</code> 表中。我们使用 <code>selectKey</code> 来查询 UUID 并设置到 <code>id</code> 字段中。</p><p>通过 <code>keyProperty</code> 属性来指定查询到的 UUID 赋值给对象中的 <code>id</code> 属性，而 <code>resultType</code> 属性指定了 UUID 的类型为 <code>java.lang.String</code>。</p><p>需要注意的是，我们将 <code>selectKey</code> 放在了插入语句的前面，这是因为 MySQL 在 <code>insert</code> 语句中只支持一个 <code>select</code> 子句，而 <code>selectKey</code> 中查询 UUID 的语句就是一个 <code>select</code> 子句，因此我们需要将其放在前面。</p><p>最后，在将 <code>User</code> 对象插入到 <code>user</code> 表中时，我们直接使用对象中的 <code>id</code> 属性来插入主键值。</p><p>使用这种方式，我们可以方便地插入 UUID 作为字符串类型主键。当然，还有其他插入方式可以使用，如使用Java代码生成UUID并在类中显式设置值等。需要根据具体应用场景和需求选择合适的插入方式。</p></li></ol><h4 id="3-7-实体类属性和数据库字段对应关系"><a href="#3-7-实体类属性和数据库字段对应关系" class="headerlink" title="3.7 实体类属性和数据库字段对应关系"></a>3.7 实体类属性和数据库字段对应关系</h4><ol><li><p>别名对应</p><p>将字段的别名设置成和实体类属性一致。</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 编写具体的SQL语句，使用id属性唯一的标记一条SQL语句 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- resultType属性：指定封装查询结果的Java实体类的全类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployee&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wzb.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Mybatis负责把SQL语句中的#&#123;&#125;部分替换成“?”占位符 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 给每一个字段设置一个别名，让别名和Java实体类中属性名一致 --&gt;</span></span><br><span class="line">  select emp_id empId,emp_name empName,emp_salary empSalary from t_emp where emp_id=#&#123;maomi&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>关于实体类属性的约定：<br>getXxx()方法、setXxx()方法把方法名中的get或set去掉，首字母小写。</p></blockquote></li><li><p>全局配置自动识别驼峰式命名规则</p><p>在Mybatis全局配置文件加入如下配置：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用settings对Mybatis全局进行设置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 将xxx_xxx这样的列名自动映射到xxXxx这样驼峰式命名的属性名 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SQL语句中可以不使用别名</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Employee selectEmployee(Integer empId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployee&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wzb.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">select emp_id,emp_name,emp_salary from t_emp where emp_id=#&#123;empId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>使用resultMap</p><p>使用resultMap标签定义对应关系，再在后面的SQL语句中引用这个对应关系</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 专门声明一个resultMap设定column到property之间的对应关系 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployeeByRMResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.wzb.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 使用id标签设置主键列和主键属性之间的对应关系 --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- column属性用于指定字段名；property属性用于指定Java实体类属性名 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 使用result标签设置普通字段和Java实体类属性之间的关系 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;emp_salary&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empSalary&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Employee selectEmployeeByRM(Integer empId); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployeeByRM&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;selectEmployeeByRMResultMap&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      select emp_id,emp_name,emp_salary from t_emp where emp_id=#&#123;empId&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="4-CRUD强化练习"><a href="#4-CRUD强化练习" class="headerlink" title="4. CRUD强化练习"></a>4. CRUD强化练习</h3><ol><li><p>准备数据库数据</p><p>首先，我们需要准备一张名为 <code>user</code> 的表。该表包含字段 id（主键）、username、password。创建SQL如下：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">  `id` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `password` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>实体类准备</p><p>接下来，我们需要定义一个实体类 <code>User</code>，来对应 user 表的一行数据。</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Data</span></span><br><span class="line">public class <span class="keyword">User</span> &#123;</span><br><span class="line">  private <span class="type">Integer</span> id;</span><br><span class="line">  private String username;</span><br><span class="line">  private String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Mapper接口定义</p><p>定义一个 Mapper 接口 <code>UserMapper</code>，并在其中添加 user 表的增、删、改、查方法。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">  User <span class="title function_">selectById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">  List&lt;User&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>MapperXML编写</p><p>在 resources &#x2F;mappers目录下创建一个名为 <code>UserMapper.xml</code> 的 XML 文件，包含与 Mapper 接口中相同的五个 SQL 语句，并在其中，将查询结果映射到 <code>User</code> 实体中。</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace等于mapper接口类的全限定名,这样实现对应 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.wzb.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 定义一个插入语句，并获取主键值 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    INSERT INTO user(username, password)</span><br><span class="line">                VALUES(#&#123;username&#125;, #&#123;password&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">    UPDATE user SET username=#&#123;username&#125;, password=#&#123;password&#125;</span><br><span class="line">    WHERE id=#&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delete&quot;</span>&gt;</span></span><br><span class="line">    DELETE FROM user WHERE id=#&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- resultType使用user别名，稍后需要配置！--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    SELECT id, username, password FROM user WHERE id=#&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- resultType返回值类型为集合，所以只写范型即可！ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    SELECT id, username, password FROM user</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>MyBatis配置文件</p><p>位置：resources: mybatis-config.xml&#x20;</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 开启驼峰式映射--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 开启logback日志输出--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SLF4J&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 给实体类起别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.wzb.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- environments表示配置Mybatis的开发环境，可以配置多个环境，在众多具体环境中，使用default属性指定实际运行时使用的环境。default属性的取值是environment标签的id属性的值。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- environment表示配置Mybatis的一个具体的环境 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Mybatis的内置的事务管理器 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置数据源 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 建立数据库连接的具体信息 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis-example&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Mapper注册：指定Mybatis映射文件的具体位置 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mapper标签：配置一个具体的Mapper映射文件 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- resource属性：指定Mapper映射文件的实际存储位置，这里需要使用一个以类路径根目录为基准的相对路径 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    对Maven工程的目录结构来说，resources目录下的内容会直接放入类路径，所以这里我们可以以resources目录为基准 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>效果测试</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wzb.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wzb.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.wzb.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.AfterEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * projectName: com.wzb.test</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="comment">// junit会在每一个@Test方法前执行@BeforeEach方法</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        session = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>()</span><br><span class="line">                .build(</span><br><span class="line">                        Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>))</span><br><span class="line">                .openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> session.getMapper(UserMapper.class);</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> session.getMapper(UserMapper.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1</span>);</span><br><span class="line">        user.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;111111&quot;</span>);</span><br><span class="line">        userMapper.update(user);</span><br><span class="line">        user = userMapper.selectById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> session.getMapper(UserMapper.class);</span><br><span class="line">        userMapper.delete(<span class="number">1</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectByIdTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> session.getMapper(UserMapper.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectAllTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> session.getMapper(UserMapper.class);</span><br><span class="line">        List&lt;User&gt; userList = userMapper.selectAll();</span><br><span class="line">        System.out.println(<span class="string">&quot;userList = &quot;</span> + userList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// junit会在每一个@Test方法后执行@@AfterEach方法</span></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="5-mapperXML标签总结"><a href="#5-mapperXML标签总结" class="headerlink" title="5. mapperXML标签总结"></a>5. mapperXML标签总结</h3><p>MyBatis 的真正强大在于它的语句映射，这是它的魔力所在。由于它的异常强大，映射器的 XML 文件就显得相对简单。如果拿它跟具有相同功能的 JDBC 代码进行对比，你会立即发现省掉了将近 95% 的代码。MyBatis 致力于减少使用成本，让用户能更专注于 SQL 代码。</p><p>SQL 映射文件只有很少的几个顶级元素（按照应被定义的顺序列出）：</p><ul><li><code>insert</code> – 映射插入语句。</li><li><code>update</code> – 映射更新语句。</li><li><code>delete</code> – 映射删除语句。</li><li><code>select</code> – 映射查询语句。</li></ul><p><strong>select标签：</strong></p><p>MyBatis 在查询和结果映射做了相当多的改进。一个简单查询的 select 元素是非常简单：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPerson&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">resultType</span>=<span class="string">&quot;hashmap&quot;</span>&gt;</span> SELECT * FROM PERSON WHERE ID = #&#123;id&#125; <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个语句名为 selectPerson，接受一个 int（或 Integer）类型的参数，并返回一个 HashMap 类型的对象，其中的键是列名，值便是结果行中的对应值。</p><p>注意参数符号：#{id}</p><p>MyBatis 创建一个预处理语句（PreparedStatement）参数，在 JDBC 中，这样的一个参数在 SQL 中会由一个“?”来标识，并被传递到一个新的预处理语句中，就像这样：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 近似的 JDBC 代码，非 MyBatis 代码...</span></span><br><span class="line"><span class="type">String</span> <span class="variable">selectPerson</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM PERSON WHERE ID=?&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(selectPerson);</span><br><span class="line">ps.setInt(<span class="number">1</span>,id);</span><br></pre></td></tr></table></figure><p>select 元素允许你配置很多属性来配置每条语句的行为细节：</p><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td><code>id</code></td><td>在命名空间中唯一的标识符，可以被用来引用这条语句。</td></tr><tr><td><code>resultType</code></td><td>期望从这条语句中返回结果的类全限定名或别名。 注意，如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身的类型。 resultType 和 resultMap 之间只能同时使用一个。</td></tr><tr><td><code>resultMap</code></td><td>对外部 resultMap 的命名引用。结果映射是 MyBatis 最强大的特性，如果你对其理解透彻，许多复杂的映射问题都能迎刃而解。 resultType 和 resultMap 之间只能同时使用一个。</td></tr><tr><td><code>timeout</code></td><td>这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。</td></tr><tr><td><code>statementType</code></td><td>可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。</td></tr></tbody></table><p><strong>insert, update 和 delete标签：</strong></p><p>数据变更语句 insert，update 和 delete 的实现非常接近：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;insertAuthor&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">keyProperty</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">keyColumn</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;updateAuthor&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;deleteAuthor&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td><code>id</code></td><td>在命名空间中唯一的标识符，可以被用来引用这条语句。</td></tr><tr><td><code>timeout</code></td><td>这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。默认值为未设置（unset）（依赖数据库驱动）。</td></tr><tr><td><code>statementType</code></td><td>可选 STATEMENT，PREPARED 或 CALLABLE。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。</td></tr><tr><td><code>useGeneratedKeys</code></td><td>（仅适用于 insert 和 update）这会令 MyBatis 使用 JDBC 的 getGeneratedKeys 方法来取出由数据库内部生成的主键（比如：像 MySQL 和 SQL Server 这样的关系型数据库管理系统的自动递增字段），默认值：false。</td></tr><tr><td><code>keyProperty</code></td><td>（仅适用于 insert 和 update）指定能够唯一识别对象的属性，MyBatis 会使用 getGeneratedKeys 的返回值或 insert 语句的 selectKey 子元素设置它的值，默认值：未设置（<code>unset</code>）。如果生成列不止一个，可以用逗号分隔多个属性名称。</td></tr><tr><td><code>keyColumn</code></td><td>（仅适用于 insert 和 update）设置生成键值在表中的列名，在某些数据库（像 PostgreSQL）中，当主键列不是表中的第一列的时候，是必须设置的。如果生成列不止一个，可以用逗号分隔多个属性名称。</td></tr></tbody></table><h3 id="6-mybatis配置文件设计标签和顶层结构如下："><a href="#6-mybatis配置文件设计标签和顶层结构如下：" class="headerlink" title="6.mybatis配置文件设计标签和顶层结构如下："></a>6.mybatis配置文件设计标签和顶层结构如下：</h3><ul><li>configuration（配置）<ul><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#properties" title="properties（属性）">properties（属性）</a></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#settings" title="settings（设置）">settings（设置）</a></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#typeAliases" title="typeAliases（类型别名）">typeAliases（类型别名）</a></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers" title="typeHandlers（类型处理器）">typeHandlers（类型处理器）</a></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#objectFactory" title="objectFactory（对象工厂）">objectFactory（对象工厂）</a></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#plugins" title="plugins（插件）">plugins（插件）</a></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#environments" title="environments（环境配置）">environments（环境配置）</a><ul><li>environment（环境变量）<ul><li>transactionManager（事务管理器）</li><li>dataSource（数据源）</li></ul></li></ul></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#databaseIdProvider" title="databaseIdProvider（数据库厂商标识）">databaseIdProvider（数据库厂商标识）</a></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#mappers" title="mappers（映射器）">mappers（映射器）</a></li></ul></li></ul><p>settings设置项：</p><table><thead><tr><th>设置名</th><th>描述</th><th>有效值</th><th>默认值</th></tr></thead><tbody><tr><td>cacheEnabled</td><td>全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td><td>true | false</td><td>true</td></tr><tr><td>lazyLoadingEnabled</td><td>延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态。</td><td>true | false</td><td>false</td></tr><tr><td>aggressiveLazyLoading</td><td>开启时，任一方法的调用都会加载该对象的所有延迟加载属性。 否则，每个延迟加载属性会按需加载（参考 <code>lazyLoadTriggerMethods</code>)。</td><td>true | false</td><td>false （在 3.4.1 及之前的版本中默认为 true）</td></tr><tr><td>multipleResultSetsEnabled</td><td>是否允许单个语句返回多结果集（需要数据库驱动支持）。</td><td>true | false</td><td>true</td></tr><tr><td>useColumnLabel</td><td>使用列标签代替列名。实际表现依赖于数据库驱动，具体可参考数据库驱动的相关文档，或通过对比测试来观察。</td><td>true | false</td><td>true</td></tr><tr><td>useGeneratedKeys</td><td>允许 JDBC 支持自动生成主键，需要数据库驱动支持。如果设置为 true，将强制使用自动生成主键。尽管一些数据库驱动不支持此特性，但仍可正常工作（如 Derby）。</td><td>true | false</td><td>False</td></tr><tr><td>autoMappingBehavior</td><td>指定 MyBatis 应如何自动映射列到字段或属性。 NONE 表示关闭自动映射；PARTIAL 只会自动映射没有定义嵌套结果映射的字段。 FULL 会自动映射任何复杂的结果集（无论是否嵌套）。</td><td>NONE, PARTIAL, FULL</td><td>PARTIAL</td></tr><tr><td>autoMapping UnknownColumnBehavior</td><td>指定发现自动映射目标未知列（或未知属性类型）的行为。 *   <code>NONE</code>: 不做任何反应 *   <code>WARNING</code>: 输出警告日志（<code>&#39;org.apache.ibatis.session.AutoMappingUnknownColumnBehavior&#39;</code> 的日志等级必须设置为 <code>WARN</code>） *   <code>FAILING</code>: 映射失败 (抛出 <code>SqlSessionException</code>)</td><td>NONE, WARNING, FAILING</td><td>NONE</td></tr><tr><td>safeRowBoundsEnabled</td><td>是否允许在嵌套语句中使用分页（RowBounds）。如果允许使用则设置为 false。</td><td>true | false</td><td>False</td></tr><tr><td>safeResultHandlerEnabled</td><td>是否允许在嵌套语句中使用结果处理器（ResultHandler）。如果允许使用则设置为 false。</td><td>true | false</td><td>True</td></tr><tr><td>mapUnderscoreToCamelCase</td><td>是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn。</td><td>true | false</td><td>False</td></tr><tr><td>localCacheScope</td><td>MyBatis 利用本地缓存机制（Local Cache）防止循环引用和加速重复的嵌套查询。 默认值为 SESSION，会缓存一个会话中执行的所有查询。 若设置值为 STATEMENT，本地缓存将仅用于执行语句，对相同 SqlSession 的不同查询将不会进行缓存。</td><td>SESSION | STATEMENT</td><td>SESSION</td></tr><tr><td>jdbcTypeForNull</td><td>当没有为参数指定特定的 JDBC 类型时，空值的默认 JDBC 类型。 某些数据库驱动需要指定列的 JDBC 类型，多数情况直接用一般类型即可，比如 NULL、VARCHAR 或 OTHER。</td><td>JdbcType 常量，常用值：NULL、VARCHAR 或 OTHER。</td><td>OTHER</td></tr><tr><td>lazyLoadTriggerMethods</td><td>指定对象的哪些方法触发一次延迟加载。</td><td>用逗号分隔的方法列表。</td><td>equals,clone,hashCode,toString</td></tr><tr><td>defaultScriptingLanguage</td><td>指定动态 SQL 生成使用的默认脚本语言。</td><td>一个类型别名或全限定类名。</td><td>org.apache.ibatis.scripting.xmltags.XMLLanguageDriver</td></tr><tr><td>defaultEnumTypeHandler</td><td>指定 Enum 使用的默认 <code>TypeHandler</code> 。（新增于 3.4.5）</td><td>一个类型别名或全限定类名。</td><td>org.apache.ibatis.type.EnumTypeHandler</td></tr><tr><td>callSettersOnNulls</td><td>指定当结果集中值为 null 的时候是否调用映射对象的 setter（map 对象时为 put）方法，这在依赖于 Map.keySet() 或 null 值进行初始化时比较有用。注意基本类型（int、boolean 等）是不能设置成 null 的。</td><td>true | false</td><td>false</td></tr><tr><td>returnInstanceForEmptyRow</td><td>当返回行的所有列都是空时，MyBatis默认返回 <code>null</code>。 当开启这个设置时，MyBatis会返回一个空实例。 请注意，它也适用于嵌套的结果集（如集合或关联）。（新增于 3.4.2）</td><td>true | false</td><td>false</td></tr><tr><td>logPrefix</td><td>指定 MyBatis 增加到日志名称的前缀。</td><td>任何字符串</td><td>未设置</td></tr><tr><td>logImpl</td><td>指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</td><td>SLF4J | LOG4J（3.5.9 起废弃） | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</td><td>未设置</td></tr><tr><td>proxyFactory</td><td>指定 Mybatis 创建可延迟加载对象所用到的代理工具。</td><td>CGLIB （3.5.10 起废弃） | JAVASSIST</td><td>JAVASSIST （MyBatis 3.3 以上）</td></tr><tr><td>vfsImpl</td><td>指定 VFS 的实现</td><td>自定义 VFS 的实现的类全限定名，以逗号分隔。</td><td>未设置</td></tr><tr><td>useActualParamName</td><td>允许使用方法签名中的名称作为语句参数名称。 为了使用该特性，你的项目必须采用 Java 8 编译，并且加上 <code>-parameters</code> 选项。（新增于 3.4.1）</td><td>true | false</td><td>true</td></tr><tr><td>configurationFactory</td><td>指定一个提供 <code>Configuration</code> 实例的类。 这个被返回的 Configuration 实例用来加载被反序列化对象的延迟加载属性值。 这个类必须包含一个签名为<code>static Configuration getConfiguration()</code> 的方法。（新增于 3.2.3）</td><td>一个类型别名或完全限定类名。</td><td>未设置</td></tr><tr><td>shrinkWhitespacesInSql</td><td>从SQL中删除多余的空格字符。请注意，这也会影响SQL中的文字字符串。 (新增于 3.5.5)</td><td>true | false</td><td>false</td></tr><tr><td>defaultSqlProviderType</td><td>指定一个拥有 provider 方法的 sql provider 类 （新增于 3.5.6）. 这个类适用于指定 sql provider 注解上的<code>type</code>（或 <code>value</code>） 属性（当这些属性在注解中被忽略时）。 (e.g. <code>@SelectProvider</code>)</td><td>类型别名或者全限定名</td><td>未设置</td></tr><tr><td>nullableOnForEach</td><td>为 ‘foreach’ 标签的 ‘nullable’ 属性指定默认值。（新增于 3.5.9）</td><td>true | false</td><td>false</td></tr><tr><td>argNameBased ConstructorAutoMapping</td><td>当应用构造器自动映射时，参数名称被用来搜索要映射的列，而不再依赖列的顺序。（新增于 3.5.10）</td><td>true | false</td><td>false</td></tr></tbody></table><h2 id="四、MyBatis多表映射"><a href="#四、MyBatis多表映射" class="headerlink" title="四、MyBatis多表映射"></a>四、MyBatis多表映射</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">回顾数据库知识：</span><br><span class="line">1) 实体(Entity)和实体之间的关系</span><br><span class="line">   一对一、一对多、多对多</span><br><span class="line">   一对一主键关联:</span><br><span class="line">   人员基本信息表 、  身份证信息维护表</span><br><span class="line">   id(pk)  name        id(pk)    cardNo  </span><br><span class="line">   1       jim         1         321281199910011232</span><br><span class="line">   2       tom         2     </span><br><span class="line">   一对一唯一外键关联</span><br><span class="line">   男生表       、  女生表</span><br><span class="line">   boyid   boyname       girlid   girlname   bodyID(unique)</span><br><span class="line">   1       jim           5        lina        1</span><br><span class="line">   2       tom           6        rose        2</span><br><span class="line">2) 数据库的设计范式</span><br><span class="line">   第一范式：列不可再分</span><br><span class="line">           假设有一列：收货地址。这一列的值是：广东省深圳市宝安区航城街道西部硅谷尚某谷分谷</span><br><span class="line">   第二范式：一张表只描述一件事</span><br><span class="line">           假设有学员表，其中包含如下的列： 学号、姓名、出生年月、性别、籍贯、父母姓名、血型</span><br><span class="line">           我认为学号、姓名、出生年月、性别 这四个作为学员表是必备的。但是父母姓名、父母学历、父母的工作性质等这些信息并不是学员本身的信息。因此这张学员表不符合第二范式。应该拆分成两张表。</span><br><span class="line">   第三范式：表中的每一列和主键是直接相关，而不是间接相关。</span><br><span class="line">          假设有学员成绩表，不符合第三范式的表设计如下： </span><br><span class="line">          id    stuid    stuname  subjectid   subjectname   score</span><br><span class="line">          1     s001     jim      sub001      语文           90</span><br><span class="line">          上面这张表不符合第三范式，因为学员的姓名以及科目名称都可以通过他们的id和学员表以及科目表进行表连接查询到。</span><br><span class="line">          符合第三范式的设计方案应该如下：</span><br><span class="line">          id    stuid     subid    score</span><br><span class="line">          1     s001      sub001    90</span><br><span class="line">3) 数据库范式和数据库的查询性能之间的权衡</span><br><span class="line">   我们到底是想让数据库设计的更规范，还是想让数据库的查询性能更高？</span><br><span class="line">   就拿上面的成绩表的例子来说，我们应该降低数据库的范式，从而获得更好的查询性能。</span><br><span class="line">   相反的，对于一些固定不变的，数据量较小的，我们应该尽可能的提高数据库的规范度，从而最大程度减少冗余(性能方面可以通过其他技术手段解决，例如缓存)</span><br><span class="line">4) 表连接的基础知识点：</span><br><span class="line">   左外连接、右外连接、内连接、全连接（mysql不支持）</span><br><span class="line">   </span><br><span class="line">   mysql&gt; create database mydb charset utf8;</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use mydb;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">Empty set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table t1</span><br><span class="line">    -&gt; (</span><br><span class="line">    -&gt; c1 varchar(5),</span><br><span class="line">    -&gt; c2 varchar(5)</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table t2</span><br><span class="line">    -&gt; (</span><br><span class="line">    -&gt; c3 varchar(5),</span><br><span class="line">    -&gt; c4 varchar(5)</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t1 values</span><br><span class="line">    -&gt; (&#x27;a&#x27;,&#x27;b&#x27;),(&#x27;b&#x27;,&#x27;c&#x27;),(&#x27;c&#x27;,&#x27;d&#x27;);</span><br><span class="line">Query OK, 3 rows affected (0.02 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t2 values</span><br><span class="line">    -&gt; (&#x27;b&#x27;,&#x27;d&#x27;),(&#x27;e&#x27;,&#x27;f&#x27;);</span><br><span class="line">Query OK, 2 rows affected (0.02 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line">   </span><br><span class="line">表连接的基本语句如下：</span><br><span class="line">mysql&gt; select * from t1 , t2 ;</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| c1   | c2   | c3   | c4   |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| a    | b    | e    | f    |</span><br><span class="line">| a    | b    | b    | d    |</span><br><span class="line">| b    | c    | e    | f    |</span><br><span class="line">| b    | c    | b    | d    |</span><br><span class="line">| c    | d    | e    | f    |</span><br><span class="line">| c    | d    | b    | d    |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t1 inner join t2 on 1 = 1 ;</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| c1   | c2   | c3   | c4   |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| a    | b    | e    | f    |</span><br><span class="line">| a    | b    | b    | d    |</span><br><span class="line">| b    | c    | e    | f    |</span><br><span class="line">| b    | c    | b    | d    |</span><br><span class="line">| c    | d    | e    | f    |</span><br><span class="line">| c    | d    | b    | d    |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t1 inner join t2 on c1 = c3 ;</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| c1   | c2   | c3   | c4   |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| b    | c    | b    | d    |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t1 left join t2 on c1 = c3 ;</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| c1   | c2   | c3   | c4   |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| a    | b    | NULL | NULL |</span><br><span class="line">| b    | c    | b    | d    |</span><br><span class="line">| c    | d    | NULL | NULL |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t1 right join t2 on c1 = c3 ;</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| c1   | c2   | c3   | c4   |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| b    | c    | b    | d    |</span><br><span class="line">| NULL | NULL | e    | f    |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t1 full join t2 on c1 = c3 ;</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| c1   | c2   | c3   | c4   |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| b    | c    | b    | d    |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t1 left join t2 on c1 = c3</span><br><span class="line">    -&gt; union</span><br><span class="line">    -&gt; select * from t1 right join t2 on c1 = c3 ;</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| c1   | c2   | c3   | c4   |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">| a    | b    | NULL | NULL |</span><br><span class="line">| b    | c    | b    | d    |</span><br><span class="line">| c    | d    | NULL | NULL |</span><br><span class="line">| NULL | NULL | e    | f    |</span><br><span class="line">+------+------+------+------+</span><br><span class="line">4 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mybatis中对于对象关联分为两大类：对一关联、对多关联</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">对多关联： 一个学员拥有多本书。 </span><br><span class="line">Student、Book</span><br><span class="line">Student：sid , sname , bookList</span><br><span class="line">Book: bid , bname</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">对一关联：一本书只属于一个学员</span><br><span class="line">Student、Book</span><br><span class="line">Student：sid , sname , bookList</span><br><span class="line">Book: bid , bname , student</span><br></pre></td></tr></table></figure><h3 id="1-多表映射概念"><a href="#1-多表映射概念" class="headerlink" title="1. 多表映射概念"></a>1. 多表映射概念</h3><ol><li><p><strong>多表查询结果映射思路</strong></p><p>上面课程中，我全面讲解了单表的mybatis操作！但是开发中更多的是<strong>多表查询</strong>需求，这种情况我们如何让进行处理？</p><p>MyBatis 思想是：数据库不可能永远是你所想或所需的那个样子。 我们希望每个数据库都具备良好的第三范式或 BCNF 范式，可惜它们并不都是那样。 如果能有一种数据库映射模式，完美适配所有的应用程序查询需求，那就太好了，而 ResultMap 就是 MyBatis 的完美答案。&#x20;</p><p>官方例子：我们如何映射下面这个语句？&#x20;</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 非常复杂的语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlogDetails&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;detailedBlogResultMap&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">       B.id as blog_id,</span><br><span class="line">       B.title as blog_title,</span><br><span class="line">       B.author_id as blog_author_id,</span><br><span class="line">       A.id as author_id,</span><br><span class="line">       A.username as author_username,</span><br><span class="line">       A.password as author_password,</span><br><span class="line">       A.email as author_email,</span><br><span class="line">       A.bio as author_bio,</span><br><span class="line">       A.favourite_section as author_favourite_section,</span><br><span class="line">       P.id as post_id,</span><br><span class="line">       P.blog_id as post_blog_id,</span><br><span class="line">       P.author_id as post_author_id,</span><br><span class="line">       P.created_on as post_created_on,</span><br><span class="line">       P.section as post_section,</span><br><span class="line">       P.subject as post_subject,</span><br><span class="line">       P.draft as draft,</span><br><span class="line">       P.body as post_body,</span><br><span class="line">       C.id as comment_id,</span><br><span class="line">       C.post_id as comment_post_id,</span><br><span class="line">       C.name as comment_name,</span><br><span class="line">       C.comment as comment_text,</span><br><span class="line">       T.id as tag_id,</span><br><span class="line">       T.name as tag_name</span><br><span class="line">  from Blog B</span><br><span class="line">       left outer join Author A on B.author_id = A.id</span><br><span class="line">       left outer join Post P on B.id = P.blog_id</span><br><span class="line">       left outer join Comment C on P.id = C.post_id</span><br><span class="line">       left outer join Post_Tag PT on PT.post_id = P.id</span><br><span class="line">       left outer join Tag T on PT.tag_id = T.id</span><br><span class="line">  where B.id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>你可能想把它映射到一个智能的对象模型，这个对象表示了一篇博客，它由某位作者所写，有很多的博文，每篇博文有零或多条的评论和标签。 我们先来看看下面这个完整的例子，它是一个非常复杂的结果映射（假设作者，博客，博文，评论和标签都是类型别名）。 虽然它看起来令人望而生畏，但其实非常简单。&#x20;</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!-- 非常复杂的结果映射 --&gt;</span><br><span class="line">&lt;resultMap id=<span class="string">&quot;detailedBlogResultMap&quot;</span> type=<span class="string">&quot;Blog&quot;</span>&gt;</span><br><span class="line">  &lt;constructor&gt;</span><br><span class="line">    &lt;idArg column=<span class="string">&quot;blog_id&quot;</span> javaType=<span class="string">&quot;int&quot;</span>/&gt;</span><br><span class="line">  &lt;/constructor&gt;</span><br><span class="line">  &lt;result property=<span class="string">&quot;title&quot;</span> column=<span class="string">&quot;blog_title&quot;</span>/&gt;</span><br><span class="line">  &lt;association property=<span class="string">&quot;author&quot;</span> javaType=<span class="string">&quot;Author&quot;</span>&gt;</span><br><span class="line">    &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;author_id&quot;</span>/&gt;</span><br><span class="line">    &lt;result property=<span class="string">&quot;username&quot;</span> column=<span class="string">&quot;author_username&quot;</span>/&gt;</span><br><span class="line">    &lt;result property=<span class="string">&quot;password&quot;</span> column=<span class="string">&quot;author_password&quot;</span>/&gt;</span><br><span class="line">    &lt;result property=<span class="string">&quot;email&quot;</span> column=<span class="string">&quot;author_email&quot;</span>/&gt;</span><br><span class="line">    &lt;result property=<span class="string">&quot;bio&quot;</span> column=<span class="string">&quot;author_bio&quot;</span>/&gt;</span><br><span class="line">    &lt;result property=<span class="string">&quot;favouriteSection&quot;</span> column=<span class="string">&quot;author_favourite_section&quot;</span>/&gt;</span><br><span class="line">  &lt;/association&gt;</span><br><span class="line">  &lt;collection property=<span class="string">&quot;posts&quot;</span> ofType=<span class="string">&quot;Post&quot;</span>&gt;</span><br><span class="line">    &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;post_id&quot;</span>/&gt;</span><br><span class="line">    &lt;result property=<span class="string">&quot;subject&quot;</span> column=<span class="string">&quot;post_subject&quot;</span>/&gt;</span><br><span class="line">    &lt;association property=<span class="string">&quot;author&quot;</span> javaType=<span class="string">&quot;Author&quot;</span>/&gt;</span><br><span class="line">    &lt;collection property=<span class="string">&quot;comments&quot;</span> ofType=<span class="string">&quot;Comment&quot;</span>&gt;</span><br><span class="line">      &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;comment_id&quot;</span>/&gt;</span><br><span class="line">    &lt;/collection&gt;</span><br><span class="line">    &lt;collection property=<span class="string">&quot;tags&quot;</span> ofType=<span class="string">&quot;Tag&quot;</span> &gt;</span><br><span class="line">      &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;tag_id&quot;</span>/&gt;</span><br><span class="line">    &lt;/collection&gt;</span><br><span class="line">  &lt;/collection&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure><p>你现在可能看不懂，接下来我们要学习将多表查询结果使用ResultMap标签映射到实体类对象上！</p><p><strong>我们的学习目标：</strong></p><p>多表查询语句复习</p><p>多表结果承接实体类设计</p><p>使用ResultMap完成多表结果映射</p></li><li><p><strong>实体类设计方案</strong></p><p>多表关系回顾：（双向查看）</p><ul><li><p>一对一</p><p>夫妻关系，人和身份证号</p></li></ul></li></ol><ul><li><p>一对多</p><pre><code>用户和用户的订单，锁和钥匙</code></pre><ul><li><p>多对多</p><p>老师和学生，部门和员工</p></li></ul><p>实体类设计关系：（单向查看）</p></li><li><p>对一 ： 夫妻一方对应另一方，订单对应用户都是对一关系</p><pre><code>实体类设计：对一关系下，类中只要包含单个对方对象类型属性即可！</code></pre><p>例如：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br></pre></td></tr></table></figure><br><br>  private Integer customerId;<br>  private String customerName;</p><p>}</p><pre><code>public class Order {</code></pre><p>  private Integer orderId;<br>  private String orderName;<br>  private Customer customer;&#x2F;&#x2F; 体现的是对一的关系</p><pre><code>}  </code></pre><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 对多: 用户对应的订单，讲师对应的学生或者学生对应的讲师都是对多关系：</span><br><span class="line"></span><br><span class="line">  实体类设计：对多关系下，类中只要包含对方类型集合属性即可！</span><br><span class="line">  ```java</span><br><span class="line">  public class Customer &#123;</span><br><span class="line">  </span><br><span class="line">    private Integer customerId;</span><br><span class="line">    private String customerName;</span><br><span class="line">    private List&lt;Order&gt; orderList;// 体现的是对多的关系</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  public class Order &#123;</span><br><span class="line">  </span><br><span class="line">    private Integer orderId;</span><br><span class="line">    private String orderName;</span><br><span class="line">    </span><br><span class="line">    private Customer customer;// 体现的是对一的关系</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ul>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">多表结果实体类设计小技巧：</span><br><span class="line">  </span><br><span class="line">​对一，属性中包含对方对象</span><br><span class="line">  </span><br><span class="line">​对多，属性中包含对方对象集合</span><br><span class="line">  </span><br><span class="line">  只有真实发生多表查询时，才需要设计和修改实体类，否则不提前设计和修改实体类！</span><br><span class="line">    </span><br><span class="line">  ​无论多少张表联查，实体类设计都是两两考虑!</span><br><span class="line">    </span><br><span class="line">  ​在查询映射的时候，只需要关注本次查询相关的属性！例如：查询订单和对应的客户，就不要关注客户中的订单集合！</span><br><span class="line">  </span><br></pre></td></tr></table></figure>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure><ol start="3"><li><p><strong>多表映射案例准备</strong></p><p>数据库：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `t_customer` (`customer_id` <span class="type">INT</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT, `customer_name` <span class="type">CHAR</span>(<span class="number">100</span>), <span class="keyword">PRIMARY KEY</span> (`customer_id`) );</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> `t_order` ( `order_id` <span class="type">INT</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT, `order_name` <span class="type">CHAR</span>(<span class="number">100</span>), `customer_id` <span class="type">INT</span>, <span class="keyword">PRIMARY KEY</span> (`order_id`) ); </span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> `t_customer` (`customer_name`) <span class="keyword">VALUES</span> (<span class="string">&#x27;c01&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> `t_order` (`order_name`, `customer_id`) <span class="keyword">VALUES</span> (<span class="string">&#x27;o1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> `t_order` (`order_name`, `customer_id`) <span class="keyword">VALUES</span> (<span class="string">&#x27;o2&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> `t_order` (`order_name`, `customer_id`) <span class="keyword">VALUES</span> (<span class="string">&#x27;o3&#x27;</span>, <span class="string">&#x27;1&#x27;</span>); </span><br></pre></td></tr></table></figure><p>实际开发时，一般在开发过程中，不给数据库表设置外键约束。<br>原因是避免调试不方便。<br>一般是功能开发完成，再加外键约束检查是否有bug。</p><p>实体类设计：</p><p>稍后会进行订单关联客户查询，也会进行客户关联订单查询，所以在这先练习设计</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Integer customerId;</span><br><span class="line">  <span class="keyword">private</span> String customerName;</span><br><span class="line">  <span class="keyword">private</span> List&lt;Order&gt; orderList;<span class="comment">// 体现的是对多的关系</span></span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Integer orderId;</span><br><span class="line">  <span class="keyword">private</span> String orderName;</span><br><span class="line">  <span class="keyword">private</span> Customer customer;<span class="comment">// 体现的是对一的关系</span></span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="2-对一映射"><a href="#2-对一映射" class="headerlink" title="2. 对一映射"></a>2. 对一映射</h3><ol><li><p>需求说明</p><p>根据ID查询订单，以及订单关联的用户的信息！</p></li><li><p>OrderMapper接口</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> &#123;</span><br><span class="line">  Order <span class="title function_">selectOrderWithCustomer</span><span class="params">(Integer orderId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>OrderMapper.xml配置文件</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 创建resultMap实现“对一”关联关系映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- id属性：通常设置为这个resultMap所服务的那条SQL语句的id加上“ResultMap” --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- type属性：要设置为这个resultMap所服务的那条SQL语句最终要返回的类型 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;selectOrderWithCustomerResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;order&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 先设置Order自身属性和字段的对应关系 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;order_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderId&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;order_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderName&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 使用association标签配置“对一”关联关系 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- property属性：在Order类中对一的一端进行引用时使用的属性名 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- javaType属性：一的一端类的全类名 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;customer&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;customer&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置Customer类的属性和字段名之间的对应关系 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;customer_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;customerId&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;customer_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;customerName&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Order selectOrderWithCustomer(Integer orderId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectOrderWithCustomer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;selectOrderWithCustomerResultMap&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  SELECT order_id,order_name,c.customer_id,customer_name</span><br><span class="line">  FROM t_order o</span><br><span class="line">  LEFT JOIN t_customer c</span><br><span class="line">  ON o.customer_id=c.customer_id</span><br><span class="line">  WHERE o.order_id=#&#123;orderId&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>对应关系可以参考下图：</p><p><img src="http://heavy_code_industry.gitee.io/code_heavy_industry/assets/img/img018.6c3cfc17.png"></p></li><li><p>Mybatis全局注册Mapper文件</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册Mapper配置文件：告诉Mybatis我们的Mapper配置文件的位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 在mapper标签的resource属性中指定Mapper配置文件以“类路径根目录”为基准的相对路径 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/OrderMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>junit测试程序</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="comment">// junit会在每一个@Test方法前执行@BeforeEach方法</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        session = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>()</span><br><span class="line">                .build(</span><br><span class="line">                        Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>))</span><br><span class="line">                .openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRelationshipToOne</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">      <span class="type">OrderMapper</span> <span class="variable">orderMapper</span> <span class="operator">=</span> session.getMapper(OrderMapper.class);</span><br><span class="line">      <span class="comment">// 查询Order对象，检查是否同时查询了关联的Customer对象</span></span><br><span class="line">      <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.selectOrderWithCustomer(<span class="number">2</span>);</span><br><span class="line">      log.info(<span class="string">&quot;order = &quot;</span> + order);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// junit会在每一个@Test方法后执行@@AfterEach方法</span></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>关键词</p><p>在“对一”关联关系中，我们的配置比较多，但是关键词就只有：<strong>association</strong>和<strong>javaType</strong></p></li></ol><h3 id="3-对多映射"><a href="#3-对多映射" class="headerlink" title="3. 对多映射"></a>3. 对多映射</h3><ol><li><p>需求说明</p><p>查询客户和客户关联的订单信息！</p></li><li><p>CustomerMapper接口</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CustomerMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">  Customer <span class="title function_">selectCustomerWithOrderList</span><span class="params">(Integer customerId)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>CustomerMapper.xml文件</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!-- 配置resultMap实现从Customer到OrderList的“对多”关联关系 --&gt;</span><br><span class="line">&lt;resultMap id=<span class="string">&quot;selectCustomerWithOrderListResultMap&quot;</span></span><br><span class="line"></span><br><span class="line">  type=<span class="string">&quot;customer&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 映射Customer本身的属性 --&gt;</span><br><span class="line">  &lt;id column=<span class="string">&quot;customer_id&quot;</span> property=<span class="string">&quot;customerId&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;result column=<span class="string">&quot;customer_name&quot;</span> property=<span class="string">&quot;customerName&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- collection标签：映射“对多”的关联关系 --&gt;</span><br><span class="line">  &lt;!-- property属性：在Customer类中，关联“多”的一端的属性名 --&gt;</span><br><span class="line">  &lt;!-- ofType属性：集合属性中元素的类型 --&gt;</span><br><span class="line">  &lt;collection property=<span class="string">&quot;orderList&quot;</span> ofType=<span class="string">&quot;order&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 映射Order的属性 --&gt;</span><br><span class="line">    &lt;id column=<span class="string">&quot;order_id&quot;</span> property=<span class="string">&quot;orderId&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;result column=<span class="string">&quot;order_name&quot;</span> property=<span class="string">&quot;orderName&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/collection&gt;</span><br><span class="line"></span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Customer <span class="title function_">selectCustomerWithOrderList</span><span class="params">(Integer customerId)</span>; --&gt;</span><br><span class="line">&lt;select id=<span class="string">&quot;selectCustomerWithOrderList&quot;</span> resultMap=<span class="string">&quot;selectCustomerWithOrderListResultMap&quot;</span>&gt;</span><br><span class="line">  SELECT c.customer_id,c.customer_name,o.order_id,o.order_name</span><br><span class="line">  FROM t_customer c</span><br><span class="line">  LEFT JOIN t_order o</span><br><span class="line">  ON c.customer_id=o.customer_id</span><br><span class="line">  WHERE c.customer_id=#&#123;customerId&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><p>对应关系可以参考下图：</p><p><img src="http://heavy_code_industry.gitee.io/code_heavy_industry/assets/img/img019.dba418c1.png"></p></li><li><p>Mybatis全局注册Mapper文件</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册Mapper配置文件：告诉Mybatis我们的Mapper配置文件的位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 在mapper标签的resource属性中指定Mapper配置文件以“类路径根目录”为基准的相对路径 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/OrderMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/CustomerMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>junit测试程序</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRelationshipToMulti</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">CustomerMapper</span> <span class="variable">customerMapper</span> <span class="operator">=</span> session.getMapper(CustomerMapper.class);</span><br><span class="line">  <span class="comment">// 查询Customer对象同时将关联的Order集合查询出来</span></span><br><span class="line">  <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> customerMapper.selectCustomerWithOrderList(<span class="number">1</span>);</span><br><span class="line">  log.info(<span class="string">&quot;customer.getCustomerId() = &quot;</span> + customer.getCustomerId());</span><br><span class="line">  log.info(<span class="string">&quot;customer.getCustomerName() = &quot;</span> + customer.getCustomerName());</span><br><span class="line">  List&lt;Order&gt; orderList = customer.getOrderList();</span><br><span class="line">  <span class="keyword">for</span> (Order order : orderList) &#123;</span><br><span class="line">    log.info(<span class="string">&quot;order = &quot;</span> + order);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>关键词</p><p>在“对多”关联关系中，同样有很多配置，但是提炼出来最关键的就是：“collection”和“ofType”</p></li></ol><h3 id="4-多对多映射"><a href="#4-多对多映射" class="headerlink" title="4. 多对多映射"></a>4. 多对多映射</h3><blockquote><p>多对多其实就是两个对多</p></blockquote><p>多对多是表关系，实体关系单向来看就是对多！只不过需要三表查询（中间表）！！！</p><p>多对多表关系示意图：</p><p><img src="image_2LrhO3TtMz.png"></p><p>多对多具体业务实现：</p><ol><li><p>数据库脚本</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">-- 创建讲师表</span><br><span class="line">CREATE TABLE <span class="title function_">t_teacher</span> <span class="params">(</span></span><br><span class="line"><span class="params">  t_id INT PRIMARY KEY,</span></span><br><span class="line"><span class="params">  t_name VARCHAR(<span class="number">50</span>)</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 创建学生表</span><br><span class="line">CREATE TABLE <span class="title function_">t_student</span> <span class="params">(</span></span><br><span class="line"><span class="params">  s_id INT PRIMARY KEY,</span></span><br><span class="line"><span class="params">  s_name VARCHAR(<span class="number">50</span>)</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 创建中间表</span><br><span class="line">CREATE TABLE <span class="title function_">t_inner</span> <span class="params">(</span></span><br><span class="line"><span class="params">  t_id INT,</span></span><br><span class="line"><span class="params">  s_id INT,</span></span><br><span class="line"><span class="params">  PRIMARY KEY (t_id, s_id)</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 向讲师表中插入测试数据</span><br><span class="line">INSERT INTO t_teacher <span class="title function_">VALUES</span> <span class="params">(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>)</span>;</span><br><span class="line">INSERT INTO t_teacher <span class="title function_">VALUES</span> <span class="params">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>)</span>;</span><br><span class="line">INSERT INTO t_teacher <span class="title function_">VALUES</span> <span class="params">(<span class="number">3</span>, <span class="string">&#x27;王五&#x27;</span>)</span>;</span><br><span class="line"></span><br><span class="line">-- 向学生表中插入测试数据</span><br><span class="line">INSERT INTO t_student <span class="title function_">VALUES</span> <span class="params">(<span class="number">1</span>, <span class="string">&#x27;小明&#x27;</span>)</span>;</span><br><span class="line">INSERT INTO t_student <span class="title function_">VALUES</span> <span class="params">(<span class="number">2</span>, <span class="string">&#x27;小红&#x27;</span>)</span>;</span><br><span class="line">INSERT INTO t_student <span class="title function_">VALUES</span> <span class="params">(<span class="number">3</span>, <span class="string">&#x27;小刚&#x27;</span>)</span>;</span><br><span class="line"></span><br><span class="line">-- 向中间表中插入测试数据</span><br><span class="line">INSERT INTO t_inner <span class="title function_">VALUES</span> <span class="params">(<span class="number">1</span>, <span class="number">1</span>)</span>;</span><br><span class="line">INSERT INTO t_inner <span class="title function_">VALUES</span> <span class="params">(<span class="number">1</span>, <span class="number">3</span>)</span>;</span><br><span class="line">INSERT INTO t_inner <span class="title function_">VALUES</span> <span class="params">(<span class="number">2</span>, <span class="number">2</span>)</span>;</span><br><span class="line">INSERT INTO t_inner <span class="title function_">VALUES</span> <span class="params">(<span class="number">3</span>, <span class="number">1</span>)</span>;</span><br><span class="line">INSERT INTO t_inner <span class="title function_">VALUES</span> <span class="params">(<span class="number">3</span>, <span class="number">3</span>)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>查询需求分析</p><p>查询讲师信息，并且查询每名讲师关联的学生信息！</p></li><li><p>实体类设计</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer tId;</span><br><span class="line">    <span class="keyword">private</span> String tName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; students;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer sId;</span><br><span class="line">    <span class="keyword">private</span> String sName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>TeacherMapper接口</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TeacherMapper</span> &#123;</span><br><span class="line">    List&lt;Teacher&gt; <span class="title function_">findAllTeachers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>TeacherMapperXML文件</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;mapper namespace=<span class="string">&quot;com.example.mapper.TeacherMapper&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;findAllTeachers&quot;</span> resultMap=<span class="string">&quot;teacherMap&quot;</span>&gt;</span><br><span class="line">        SELECT t.t_id, t.t_name, s.s_id, s.s_name</span><br><span class="line">        FROM t_teacher t LEFT OUTER JOIN t_inner i ON t.t_id = i.t_id</span><br><span class="line">        LEFT OUTER JOIN t_student s ON i.s_id = s.s_id</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;resultMap id=<span class="string">&quot;teacherMap&quot;</span> type=<span class="string">&quot;teacher&quot;</span>&gt;</span><br><span class="line">        &lt;id property=<span class="string">&quot;tId&quot;</span> column=<span class="string">&quot;t_id&quot;</span> /&gt;</span><br><span class="line">        &lt;result property=<span class="string">&quot;tName&quot;</span> column=<span class="string">&quot;t_name&quot;</span> /&gt;</span><br><span class="line">        &lt;collection property=<span class="string">&quot;students&quot;</span> ofType=<span class="string">&quot;student&quot;</span> &gt;</span><br><span class="line">          &lt;id property=<span class="string">&quot;sId&quot;</span> column=<span class="string">&quot;s_id&quot;</span> /&gt;</span><br><span class="line">          &lt;result property=<span class="string">&quot;sName&quot;</span> column=<span class="string">&quot;s_name&quot;</span> /&gt;</span><br><span class="line">        &lt;/collection&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Mybatis全局注册Mapper文件</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册Mapper配置文件：告诉Mybatis我们的Mapper配置文件的位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 在mapper标签的resource属性中指定Mapper配置文件以“类路径根目录”为基准的相对路径 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/OrderMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/CustomerMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/TeacherMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>junit测试程序</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTeacherRelationshipToMulti</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">TeacherMapper</span> <span class="variable">teacherMapper</span> <span class="operator">=</span> session.getMapper(TeacherMapper.class);</span><br><span class="line">    <span class="comment">// 查询Customer对象同时将关联的Order集合查询出来</span></span><br><span class="line">    List&lt;Teacher&gt; allTeachers = teacherMapper.findAllTeachers();</span><br><span class="line">    log.info(<span class="string">&quot;allTeachers = &quot;</span> + allTeachers);</span><br><span class="line">    <span class="keyword">for</span> (Teacher teacher : allTeachers) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;teacher = &quot;</span> + teacher);</span><br><span class="line">        log.info(<span class="string">&quot;teacher.students = &quot;</span> + teacher.getStudents());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="5-多表映射总结"><a href="#5-多表映射总结" class="headerlink" title="5. 多表映射总结"></a>5. 多表映射总结</h3><h4 id="5-1-多表映射优化"><a href="#5-1-多表映射优化" class="headerlink" title="5.1 多表映射优化"></a>5.1 多表映射优化</h4><table><thead><tr><th>setting属性</th><th>属性含义</th><th>可选值</th><th>默认值</th></tr></thead><tbody><tr><td>autoMappingBehavior</td><td>指定 MyBatis 应如何自动映射列到字段或属性。 NONE 表示关闭自动映射；PARTIAL 只会自动映射没有定义嵌套结果映射的字段。 FULL 会自动映射任何复杂的结果集（无论是否嵌套）。</td><td>NONE, PARTIAL, FULL</td><td>PARTIAL</td></tr></tbody></table><p>我们可以将autoMappingBehavior设置为full,进行多表resultMap映射的时候，可以省略符合列和属性命名映射规则（列名&#x3D;属性名，或者开启驼峰映射也可以自定映射）的result标签！</p><p>修改mybati-sconfig.xml:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启resultMap自动映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;FULL&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>修改teacherMapper.xml</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;teacherMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;tId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;t_id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启自动映射,并且开启驼峰式支持!可以省略 result!--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;result property=&quot;tName&quot; column=&quot;t_name&quot; /&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;student&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;s_id&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;result property=&quot;sName&quot; column=&quot;s_name&quot; /&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="5-2-多表映射总结"><a href="#5-2-多表映射总结" class="headerlink" title="5.2 多表映射总结"></a>5.2 多表映射总结</h4><table><thead><tr><th>关联关系</th><th>配置项关键词</th><th>所在配置文件和具体位置</th></tr></thead><tbody><tr><td>对一</td><td>association标签&#x2F;javaType属性&#x2F;property属性</td><td>Mapper配置文件中的resultMap标签内</td></tr><tr><td>对多</td><td>collection标签&#x2F;ofType属性&#x2F;property属性</td><td>Mapper配置文件中的resultMap标签内</td></tr></tbody></table><h4 id="5-3-分步查询"><a href="#5-3-分步查询" class="headerlink" title="5.3 分步查询"></a>5.3 分步查询</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在StudentMapper中添加一个方法：</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">    <span class="comment">//演示分步查询,根据sid查询特定的Student信息，包含Book集合</span></span><br><span class="line">    Student <span class="title function_">getStudentWithBookList</span><span class="params">(String sid )</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在StudentMapper.xml文件中添加如下配置: --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 演示分步查询 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    根据sid查询特定的学员信息，包括他关联的book集合。</span></span><br><span class="line"><span class="comment">    上面这个功能其实可以分为两个步骤：</span></span><br><span class="line"><span class="comment">    1. 根据sid查询特定学员本身的信息 - 查学员表</span></span><br><span class="line"><span class="comment">       select * from t_stu where sid = 1</span></span><br><span class="line"><span class="comment">    2. 根据sid查询book集合        - 查图书表</span></span><br><span class="line"><span class="comment">       select * from t_book where stuid = 1</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudentWithBookList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentWithBookListResultMap3&quot;</span>&gt;</span></span><br><span class="line">    select * from t_stu where sid = #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentWithBookListResultMap3&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;bookList&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.wzb.mybatis.mapper.BookMapper.getBookListBySid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 新知识点仅仅是上面的两个属性： select , column --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 上面的select引入的是如下的查询配置： --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在BookMapper.xml文件中添加如下配置： --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 查询特定学员的图书列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getBookListBySid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Book&quot;</span>&gt;</span></span><br><span class="line">    select * from t_book where stuid = #&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="5-4-延迟加载"><a href="#5-4-延迟加载" class="headerlink" title="5.4 延迟加载"></a>5.4 延迟加载</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--  为什么需要延迟加载 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  如何设置延迟加载：--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在mybatis-config.xml文件中开启全局的延迟加载 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//单元测试方法如下：</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//System.out.println(studentMapper.getStudentWithBookList(&quot;s001&quot;));</span></span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> studentMapper.getStudentWithBookList(<span class="string">&quot;s001&quot;</span>);</span><br><span class="line">    System.out.println(student.getSid()+<span class="string">&quot;-&quot;</span>+student.getSname());</span><br><span class="line">    <span class="comment">//下面这句话如果注释，那么就不会查询t_book表</span></span><br><span class="line">    System.out.println(student.getBookList().size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>延迟加载的前提条件是：分步查询。</p></blockquote><h2 id="五、MyBatis动态语句-动态SQL"><a href="#五、MyBatis动态语句-动态SQL" class="headerlink" title="五、MyBatis动态语句(动态SQL)"></a>五、MyBatis动态语句(动态SQL)</h2><h3 id="1-动态语句需求和简介"><a href="#1-动态语句需求和简介" class="headerlink" title="1. 动态语句需求和简介"></a>1. 动态语句需求和简介</h3><p>经常遇到很多按照很多查询条件进行查询的情况，比如智联招聘的职位搜索等。其中经常出现很多条件不取值的情况，在后台应该如何完成最终的SQL语句呢？</p><p><img src="image_vfoh_vetQw.png"></p><p>动态 SQL 是 MyBatis 的强大特性之一。如果你使用过 JDBC 或其它类似的框架，你应该能理解根据不同条件拼接 SQL 语句有多痛苦，例如拼接时要确保不能忘记添加必要的空格，还要注意去掉列表最后一个列名的逗号。利用动态 SQL，可以彻底摆脱这种痛苦。</p><p>使用动态 SQL 并非一件易事，但借助可用于任何 SQL 映射语句中的强大的动态 SQL 语言，MyBatis 显著地提升了这一特性的易用性。</p><p>如果你之前用过 JSTL 或任何基于类 XML 语言的文本处理器，你对动态 SQL 元素可能会感觉似曾相识。在 MyBatis 之前的版本中，需要花时间了解大量的元素。借助功能强大的基于 OGNL 的表达式，MyBatis 3 替换了之前的大部分元素，大大精简了元素种类，现在要学习的元素种类比原来的一半还要少。</p><h3 id="2-if和where标签"><a href="#2-if和where标签" class="headerlink" title="2. if和where标签"></a>2. if和where标签</h3><p>使用动态 SQL 最常见情景是根据条件包含 where  &#x2F; if 子句的一部分。比如：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;Employee&gt; selectEmployeeByCondition(Employee employee); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployeeByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;employee&quot;</span>&gt;</span></span><br><span class="line">    select emp_id,emp_name,emp_salary from t_emp</span><br><span class="line">    <span class="comment">&lt;!-- where标签会自动去掉“标签体内前面多余的and/or” --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用if标签，让我们可以有选择的加入SQL语句的片段。这个SQL语句片段是否要加入整个SQL语句，就看if标签判断的结果是否为true --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 在if标签的test属性中，可以访问实体类的属性，不可以访问数据库表的字段 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 在if标签内部，需要访问接口的参数时还是正常写#&#123;&#125; --&gt;</span></span><br><span class="line">            or emp_name=#&#123;empName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empSalary <span class="symbol">&amp;gt;</span> 2000&quot;</span>&gt;</span></span><br><span class="line">            or emp_salary&gt;#&#123;empSalary&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         第一种情况：所有条件都满足 WHERE emp_name=? or emp_salary&gt;?</span></span><br><span class="line"><span class="comment">         第二种情况：部分条件满足 WHERE emp_salary&gt;?</span></span><br><span class="line"><span class="comment">         第三种情况：所有条件都不满足 没有where子句</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-set标签"><a href="#3-set标签" class="headerlink" title="3. set标签"></a>3. set标签</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- void updateEmployeeDynamic(Employee employee) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmployeeDynamic&quot;</span>&gt;</span></span><br><span class="line">    update t_emp</span><br><span class="line">    <span class="comment">&lt;!-- set emp_name=#&#123;empName&#125;,emp_salary=#&#123;empSalary&#125; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用set标签动态管理set子句，并且动态去掉两端多余的逗号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null&quot;</span>&gt;</span></span><br><span class="line">            emp_name=#&#123;empName&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empSalary <span class="symbol">&amp;lt;</span> 3000&quot;</span>&gt;</span></span><br><span class="line">            emp_salary=#&#123;empSalary&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where emp_id=#&#123;empId&#125;</span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         第一种情况：所有条件都满足 SET emp_name=?, emp_salary=?</span></span><br><span class="line"><span class="comment">         第二种情况：部分条件满足 SET emp_salary=?</span></span><br><span class="line"><span class="comment">         第三种情况：所有条件都不满足 update t_emp where emp_id=?</span></span><br><span class="line"><span class="comment">            没有set子句的update语句会导致SQL语法错误</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-trim标签-了解"><a href="#4-trim标签-了解" class="headerlink" title="4. trim标签(了解)"></a>4. trim标签(了解)</h3><p>使用trim标签控制条件部分两端是否包含某些字符</p><ul><li>prefix属性：指定要动态添加的前缀</li><li>suffix属性：指定要动态添加的后缀</li><li>prefixOverrides属性：指定要动态去掉的前缀，使用“|”分隔有可能的多个值</li><li>suffixOverrides属性：指定要动态去掉的后缀，使用“|”分隔有可能的多个值</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;Employee&gt; selectEmployeeByConditionByTrim(Employee employee) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployeeByConditionByTrim&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wzb.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">    select emp_id,emp_name,emp_age,emp_salary,emp_gender</span><br><span class="line">    from t_emp</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- prefix属性指定要动态添加的前缀 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- suffix属性指定要动态添加的后缀 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- prefixOverrides属性指定要动态去掉的前缀，使用“|”分隔有可能的多个值 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- suffixOverrides属性指定要动态去掉的后缀，使用“|”分隔有可能的多个值 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当前例子用where标签实现更简洁，但是trim标签更灵活，可以用在任何有需要的地方 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and|or&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null&quot;</span>&gt;</span></span><br><span class="line">            emp_name=#&#123;empName&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empSalary <span class="symbol">&amp;gt;</span> 3000&quot;</span>&gt;</span></span><br><span class="line">            emp_salary&gt;#&#123;empSalary&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empAge <span class="symbol">&amp;lt;</span>= 20&quot;</span>&gt;</span></span><br><span class="line">            emp_age=#&#123;empAge&#125; or</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empGender==&#x27;male&#x27;&quot;</span>&gt;</span></span><br><span class="line">            emp_gender=#&#123;empGender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-choose-when-otherwise标签"><a href="#5-choose-when-otherwise标签" class="headerlink" title="5. choose&#x2F;when&#x2F;otherwise标签"></a>5. choose&#x2F;when&#x2F;otherwise标签</h3><p>在多个分支条件中，仅执行一个。</p><ul><li>从上到下依次执行条件判断</li><li>遇到的第一个满足条件的分支会被采纳</li><li>被采纳分支后面的分支都将不被考虑</li><li>如果所有的when分支都不满足，那么就执行otherwise分支</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;Employee&gt; selectEmployeeByConditionByChoose(Employee employee) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectEmployeeByConditionByChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wzb.mybatis.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">    select emp_id,emp_name,emp_salary from t_emp</span><br><span class="line">    where</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empName != null&quot;</span>&gt;</span>emp_name=#&#123;empName&#125;<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empSalary <span class="symbol">&amp;lt;</span> 3000&quot;</span>&gt;</span>emp_salary <span class="symbol">&amp;lt;</span> 3000<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span>1=1<span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     第一种情况：第一个when满足条件 where emp_name=?</span></span><br><span class="line"><span class="comment">     第二种情况：第二个when满足条件 where emp_salary &lt; 3000</span></span><br><span class="line"><span class="comment">     第三种情况：两个when都不满足 where 1=1 执行了otherwise</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-foreach标签"><a href="#6-foreach标签" class="headerlink" title="6. foreach标签"></a>6. foreach标签</h3><p><strong>基本用法</strong></p><p>用批量插入举例</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    collection属性：要遍历的集合</span></span><br><span class="line"><span class="comment">    item属性：遍历集合的过程中能得到每一个具体对象，在item属性中设置一个名字，将来通过这个名字引用遍历出来的对象</span></span><br><span class="line"><span class="comment">    separator属性：指定当foreach标签的标签体重复拼接字符串时，各个标签体字符串之间的分隔符</span></span><br><span class="line"><span class="comment">    open属性：指定整个循环把字符串拼好后，字符串整体的前面要添加的字符串</span></span><br><span class="line"><span class="comment">    close属性：指定整个循环把字符串拼好后，字符串整体的后面要添加的字符串</span></span><br><span class="line"><span class="comment">    index属性：这里起一个名字，便于后面引用</span></span><br><span class="line"><span class="comment">        遍历List集合，这里能够得到List集合的索引值</span></span><br><span class="line"><span class="comment">        遍历Map集合，这里能够得到Map集合的key</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;empList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;values&quot;</span> <span class="attr">index</span>=<span class="string">&quot;myIndex&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 在foreach标签内部如果需要引用遍历得到的具体的一个对象，需要使用item属性声明的名称 --&gt;</span></span><br><span class="line">    (#&#123;emp.empName&#125;,#&#123;myIndex&#125;,#&#123;emp.empSalary&#125;,#&#123;emp.empGender&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>批量更新时需要注意</strong></p><p>上面批量插入的例子本质上是一条SQL语句，而实现批量更新则需要多条SQL语句拼起来，用分号分开。也就是一次性发送多条SQL语句让数据库执行。此时需要在数据库连接信息的URL地址中设置：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wzb.dev.url=jdbc:mysql:///mybatis-example?allowMultiQueries=true</span><br></pre></td></tr></table></figure><p>对应的foreach标签如下：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- int updateEmployeeBatch(@Param(&quot;empList&quot;) List&lt;Employee&gt; empList) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmployeeBatch&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;empList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;;&quot;</span>&gt;</span></span><br><span class="line">        update t_emp set emp_name=#&#123;emp.empName&#125; where emp_id=#&#123;emp.empId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>关于foreach标签的collection属性</strong></p><p>如果没有给接口中List类型的参数使用@Param注解指定一个具体的名字，那么在collection属性中默认可以使用collection或list来引用这个list集合。这一点可以通过异常信息看出来：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">Parameter &#x27;empList&#x27; not found. Available parameters are [arg0, collection, list]</span><br></pre></td></tr></table></figure><p>在实际开发中，为了避免隐晦的表达造成一定的误会，建议使用@Param注解明确声明变量的名称，然后在foreach标签的collection属性中按照@Param注解指定的名称来引用传入的参数。</p><h3 id="7-sql片段"><a href="#7-sql片段" class="headerlink" title="7. sql片段"></a>7. sql片段</h3><p><strong>抽取重复的SQL片段</strong></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用sql标签抽取重复出现的SQL片段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;mySelectSql&quot;</span>&gt;</span></span><br><span class="line">    select emp_id,emp_name,emp_age,emp_salary,emp_gender from t_emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure><p>引用已抽取的SQL片段</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用include标签引用声明的SQL片段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;mySelectSql&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="六、MyBatis高级扩展"><a href="#六、MyBatis高级扩展" class="headerlink" title="六、MyBatis高级扩展"></a>六、MyBatis高级扩展</h2><h3 id="1-Mapper批量映射优化"><a href="#1-Mapper批量映射优化" class="headerlink" title="1. Mapper批量映射优化"></a>1. Mapper批量映射优化</h3><ol><li><p>需求</p><p>Mapper 配置文件很多时，在全局配置文件中一个一个注册太麻烦，希望有一个办法能够一劳永逸。</p></li><li><p>配置方式</p><p>Mybatis 允许在指定 Mapper 映射文件时，只指定其所在的包：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.wzb.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时这个包下的所有 Mapper 配置文件将被自动加载、注册，比较方便。</p></li><li><p>资源创建要求</p></li></ol><ul><li>Mapper 接口和 Mapper 配置文件名称一致<ul><li>Mapper 接口：EmployeeMapper.java</li><li>Mapper 配置文件：EmployeeMapper.xml</li></ul></li><li>Mapper 配置文件放在 Mapper 接口所在的包内<ul><li><p>可以将mapperxml文件放在mapper接口所在的包！</p></li><li><p>可以在sources下创建mapper接口包一致的文件夹结构存放mapperxml文件</p><p><img src="image_sYJdBGnrob.png"></p><p><img src="image_LHdRXUdP5D.png"></p></li></ul></li></ul><h3 id="2-插件和分页插件PageHelper"><a href="#2-插件和分页插件PageHelper" class="headerlink" title="2. 插件和分页插件PageHelper"></a>2. 插件和分页插件PageHelper</h3><h4 id="2-1-插件机制和PageHelper插件介绍"><a href="#2-1-插件机制和PageHelper插件介绍" class="headerlink" title="2.1 插件机制和PageHelper插件介绍"></a>2.1 插件机制和PageHelper插件介绍</h4><p>MyBatis 对插件进行了标准化的设计，并提供了一套可扩展的插件机制。插件可以在用于语句执行过程中进行拦截，并允许通过自定义处理程序来拦截和修改 SQL 语句、映射语句的结果等。</p><p>具体来说，MyBatis 的插件机制包括以下三个组件：</p><ol><li><code>Interceptor</code>（拦截器）：定义一个拦截方法 <code>intercept</code>，该方法在执行 SQL 语句、执行查询、查询结果的映射时会被调用。</li><li><code>Invocation</code>（调用）：实际上是对被拦截的方法的封装，封装了 <code>Object target</code>、<code>Method method</code> 和 <code>Object[] args</code> 这三个字段。</li><li><code>InterceptorChain</code>（拦截器链）：对所有的拦截器进行管理，包括将所有的 Interceptor 链接成一条链，并在执行 SQL 语句时按顺序调用。</li></ol><p>插件的开发非常简单，只需要实现 Interceptor 接口，并使用注解 <code>@Intercepts</code> 来标注需要拦截的对象和方法，然后在 MyBatis 的配置文件中添加插件即可。</p><p>PageHelper 是 MyBatis 中比较著名的分页插件，它提供了多种分页方式（例如 MySQL 和 Oracle 分页方式），支持多种数据库，并且使用非常简单。下面就介绍一下 PageHelper 的使用方式。</p><p><a href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/zh/HowToUse.md#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%B9%E8%A8%80">https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/zh/HowToUse.md#如何配置数据库方言</a></p><h4 id="2-2-PageHelper插件使用"><a href="#2-2-PageHelper插件使用" class="headerlink" title="2.2 PageHelper插件使用"></a>2.2 PageHelper插件使用</h4><ol><li><p>pom.xml引入依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>mybatis-config.xml配置分页插件</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;helperDialect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>其中，<code>com.github.pagehelper.PageInterceptor</code> 是 PageHelper 插件的名称，<code>dialect</code> 属性用于指定数据库类型（支持多种数据库）</p></blockquote></li><li><p>页插件使用</p><p>在查询方法中使用分页：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTeacherRelationshipToMulti</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">TeacherMapper</span> <span class="variable">teacherMapper</span> <span class="operator">=</span> session.getMapper(TeacherMapper.class);</span><br><span class="line"></span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 查询Customer对象同时将关联的Order集合查询出来</span></span><br><span class="line">    List&lt;Teacher&gt; allTeachers = teacherMapper.findAllTeachers();</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">    PageInfo&lt;Teacher&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(allTeachers);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;pageInfo = &quot;</span> + pageInfo);</span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> pageInfo.getTotal(); <span class="comment">// 获取总记录数</span></span><br><span class="line">    System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line">    <span class="type">int</span> <span class="variable">pages</span> <span class="operator">=</span> pageInfo.getPages();  <span class="comment">// 获取总页数</span></span><br><span class="line">    System.out.println(<span class="string">&quot;pages = &quot;</span> + pages);</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> pageInfo.getPageNum(); <span class="comment">// 获取当前页码</span></span><br><span class="line">    System.out.println(<span class="string">&quot;pageNum = &quot;</span> + pageNum);</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> pageInfo.getPageSize(); <span class="comment">// 获取每页显示记录数</span></span><br><span class="line">    System.out.println(<span class="string">&quot;pageSize = &quot;</span> + pageSize);</span><br><span class="line">    List&lt;Teacher&gt; teachers = pageInfo.getList(); <span class="comment">//获取查询页的数据集合</span></span><br><span class="line">    System.out.println(<span class="string">&quot;teachers = &quot;</span> + teachers);</span><br><span class="line">    teachers.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-逆向工程和MybatisX插件"><a href="#3-逆向工程和MybatisX插件" class="headerlink" title="3. 逆向工程和MybatisX插件"></a>3. 逆向工程和MybatisX插件</h3><h4 id="3-1-ORM思维介绍"><a href="#3-1-ORM思维介绍" class="headerlink" title="3.1 ORM思维介绍"></a>3.1 ORM思维介绍</h4><p>ORM（Object-Relational Mapping，对象-关系映射）是一种将数据库和面向对象编程语言中的对象之间进行转换的技术。它将对象和关系数据库的概念进行映射，通过一系列的操作将对象关联到数据表中的一行或多行上。</p><p>让我们可以使用面向对象思维进行数据库操作！！！</p><p><strong>ORM 框架通常有半自动和全自动两种方式。</strong></p><ul><li>半自动 ORM 通常需要程序员手动编写 SQL 语句或者配置文件，将实体类和数据表进行映射，还需要手动将查询的结果集转换成实体对象。</li><li>全自动 ORM 则是将实体类和数据表进行自动映射，使用 API 进行数据库操作时，ORM 框架会自动执行 SQL 语句并将查询结果转换成实体对象，程序员无需再手动编写 SQL 语句和转换代码。</li></ul><p><strong>下面是半自动和全自动 ORM 框架的区别：</strong></p><ol><li>映射方式：半自动 ORM 框架需要程序员手动指定实体类和数据表之间的映射关系，通常使用 XML 文件或注解方式来指定；全自动 ORM 框架则可以自动进行实体类和数据表的映射，无需手动干预。</li><li>查询方式：半自动 ORM 框架通常需要程序员手动编写 SQL 语句并将查询结果集转换成实体对象；全自动 ORM 框架可以自动组装 SQL 语句、执行查询操作，并将查询结果转换成实体对象。</li><li>性能：由于半自动 ORM 框架需要手动编写 SQL 语句，因此程序员必须对 SQL 语句和数据库的底层知识有一定的了解，才能编写高效的 SQL 语句；而全自动 ORM 框架通过自动优化生成的 SQL 语句来提高性能，程序员无需进行优化。</li><li>学习成本：半自动 ORM 框架需要程序员手动编写 SQL 语句和映射配置，要求程序员具备较高的数据库和 SQL 知识；全自动 ORM 框架可以自动生成 SQL 语句和映射配置，程序员无需了解过多的数据库和 SQL 知识。</li></ol><p>常见的半自动 ORM 框架包括 MyBatis 等；常见的全自动 ORM 框架包括 Hibernate、Spring Data JPA、MyBatis-Plus 等。</p><h4 id="3-2-逆向工程"><a href="#3-2-逆向工程" class="headerlink" title="3.2 逆向工程"></a>3.2 逆向工程</h4><p>&#x20;   MyBatis 的逆向工程是一种自动化生成持久层代码和映射文件的工具，它可以根据数据库表结构和设置的参数生成对应的实体类、Mapper.xml 文件、Mapper 接口等代码文件，简化了开发者手动生成的过程。逆向工程使开发者可以快速地构建起 DAO 层，并快速上手进行业务开发。<br>&#x20;  MyBatis 的逆向工程有两种方式：通过 MyBatis Generator 插件实现和通过 Maven 插件实现。无论是哪种方式，逆向工程一般需要指定一些配置参数，例如数据库连接 URL、用户名、密码、要生成的表名、生成的文件路径等等。<br>&#x20;  总的来说，MyBatis 的逆向工程为程序员提供了一种方便快捷的方式，能够快速地生成持久层代码和映射文件，是半自动 ORM 思维像全自动发展的过程，提高程序员的开发效率。</p><p><strong>注意：逆向工程只能生成单表crud的操作，多表查询依然需要我们自己编写！</strong></p><h4 id="3-3-逆向工程插件MyBatisX使用"><a href="#3-3-逆向工程插件MyBatisX使用" class="headerlink" title="3.3 逆向工程插件MyBatisX使用"></a>3.3 逆向工程插件MyBatisX使用</h4><p>&#x20;  MyBatisX 是一个 MyBatis 的代码生成插件，可以通过简单的配置和操作快速生成 MyBatis Mapper、pojo 类和 Mapper.xml 文件。下面是使用 MyBatisX 插件实现逆向工程的步骤：</p><ol><li><p>安装插件：</p><p>在 IntelliJ IDEA 中打开插件市场，搜索 MyBatisX 并安装。</p></li><li><p>使用 IntelliJ IDEA连接数据库</p><ul><li><p>连接数据库</p><p><img src="image_fm-MFSwW33.png"></p></li><li><p>填写信息</p><p><img src="image_c54BDsubkg.png"></p></li><li><p>展示库表</p><p><img src="image_7J4tAEH5JE.png"></p></li><li><p>逆向工程使用</p><p><img src="image_AohjPJQ-7l.png"></p><p><img src="image_FIuODxPKf7.png"></p><p><img src="image_uRRJaZzTo8.png"></p></li></ul></li><li><p>查看生成结果</p><p><img src="image_xhjGu_4Ce4.png"></p></li><li><p>逆向工程案例使用</p><p>正常使用即可，自动生成单表的crud方法！</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wzb.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wzb.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Jackiechan</span></span><br><span class="line"><span class="comment">* <span class="doctag">@description</span> 针对表【user】的数据库操作Mapper</span></span><br><span class="line"><span class="comment">* <span class="doctag">@createDate</span> 2023-06-02 16:55:32</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Entity</span> com.wzb.pojo.User</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteByPrimaryKey</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(User record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertSelective</span><span class="params">(User record)</span>;</span><br><span class="line"></span><br><span class="line">    User <span class="title function_">selectByPrimaryKey</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateByPrimaryKeySelective</span><span class="params">(User record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateByPrimaryKey</span><span class="params">(User record)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h2 id="七、MyBatis总结"><a href="#七、MyBatis总结" class="headerlink" title="七、MyBatis总结"></a>七、MyBatis总结</h2><p><img src="http://heavy_code_industry.gitee.io/code_heavy_industry/assets/img/img014.4d03b574.png"></p><ul><li>Mybatis环境所需依赖 ★</li><li>配置<ul><li>Mybatis全局配置</li><li>Mapper配置 ★</li></ul></li><li>Mapper接口 ★</li><li>API<ul><li>SqlSessionFactory</li><li>SqlSession</li></ul></li><li>逆向工程&#x20;</li><li>分页插件</li></ul>]]></content>
      
      
      <categories>
          
          <category> java开发 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>利用Hexo搭建个人博客</title>
      <link href="/2024/01/30/%E5%88%A9%E7%94%A8Hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
      <url>/2024/01/30/%E5%88%A9%E7%94%A8Hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<h2 id="1-环境及工具准备"><a href="#1-环境及工具准备" class="headerlink" title="1.环境及工具准备"></a>1.环境及工具准备</h2><p>需要安装git和nodejs</p><p>安装完成后打开cmd控制台，输入命令<code>npm install hexo-cli -g</code>，安装Hexo</p><h2 id="2-仓库搭建"><a href="#2-仓库搭建" class="headerlink" title="2.仓库搭建"></a>2.仓库搭建</h2><p>进入github网站后，点击创建仓库<code>create repository</code></p><p><img src="1.png"></p><p>仓库名字最好是用户名+.github.io,设置为公开仓库，公选设置生成readme文件</p><p><img src="2.png"></p><h2 id="3-配置ssh-key"><a href="#3-配置ssh-key" class="headerlink" title="3.配置ssh key"></a>3.配置ssh key</h2><p>回到桌面右击鼠标选择G0it Bash Here</p><p>在命令行中输入：<code>ssh-keygen -t rsa -C &quot;邮箱地址&quot;</code></p><p>后面提示一直按enter回车键就行</p><p>之后进入本地磁盘C:\Users\用户名字\ .ssh</p><p>打开.pub文件，将里面的内容复制</p><p>之后回到github网站页面，点击右上角头像，选择setting，之后再点击ssh and gpg keys,然后再new ssh key</p><p><img src="3.png"></p><p>之后标题任意，把复制的ssh key粘贴在key填写框中</p><p><img src="5.png"></p><p>然后点击创建add ssh key</p><p>回到git命令窗口，输入<code>ssh -T git@github.com</code>，出现下方提示就成功了</p><p><img src="6.png"></p><h2 id="4-本地部署"><a href="#4-本地部署" class="headerlink" title="4.本地部署"></a>4.本地部署</h2><p>先在本地磁盘上创建一个文件夹，用于存放博客数据，这里我选择创建的是D:\BlogkFile目录</p><p>然后在此目录下右击鼠标选择git bash here</p><p>在命令窗口输入：<code>hexo init</code> 进行初始化</p><p>​   <code>npx hexo instal</code>l 安装</p><p>​   <code>npx hexo g </code>生成</p><p>​                               <code>npx hexo s</code> 本地部署</p><p>最后命令窗口会有一个链接，打开就可以进入本地部署的hexo了</p><p><img src="7.png"></p><p><img src="8.png"></p><p><strong>ctrl+c 停止本地服务器</strong></p><h2 id="5-上线博客"><a href="#5-上线博客" class="headerlink" title="5.上线博客"></a>5.上线博客</h2><p>打开文件夹中的config文件</p><p><img src="9.png"></p><p>复制这段文字：</p><p>type: git<br>repository:<br>branch: main</p><p>将它粘贴在config文件下面，将原来底部的type：‘ ’替换掉</p><p><img src="10.png"></p><p>之后回到github网站，回到自己的仓库，点击code复制git链接</p><p><img src="11.png"></p><p>将链接粘贴到config文件中的repository：旁边</p><p><img src="12.png"></p><p>保存退出，然后在本地博客文件夹中git bash here，输入命令<code>npx hexo g</code>，<code>npx hexo g</code>上传</p><p><strong>$ npx hexo d</strong><br><strong>INFO Validating config</strong><br><strong>ERROR Deployer not found: git</strong><br><strong>如果出现这个问题，在bash界面输入npm install hexo-deployer-git –save后再输入npx hexo d即可解决</strong></p><p>注意第一次使用要填写git邮箱与用户名字</p><p>然后结束后会弹窗，登入即可</p><h2 id="网站资料"><a href="#网站资料" class="headerlink" title="网站资料"></a>网站资料</h2><p>我们的博客标题还是默认的hexo，整个页面是初始默认的，接下来我们对其进行修改</p><p>用记事本打开我们blog文件夹中的_config.yml文件</p><p>将#Site下面按自己的需求填上</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">## Site</span><br><span class="line">title: 标题</span><br><span class="line">subtitle: 副标题</span><br><span class="line">description: 描述</span><br><span class="line">keywords: 关键词</span><br><span class="line">author: 站主</span><br><span class="line">language: 语言（可以填写zh-CN）</span><br><span class="line">timezone: 时区（可以填写Asia/Shanghai）</span><br></pre></td></tr></table></figure><p>然后保存</p><h2 id="如何上传文章"><a href="#如何上传文章" class="headerlink" title="如何上传文章"></a>如何上传文章</h2><p>我们在Blog文件夹中打开git bash,输入下方代码就可以生成新的文章md文件</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo new 文章标题</span><br></pre></td></tr></table></figure><p>文章是.md格式，在我们的Blog文件夹中的source&#x2F;_posts中</p><p>推荐用Typora软件来编辑.md格式的文件</p><p>然后我们用Typora软件打开该.md文件就可以开始写文章了</p><p>写好以后，我们还是一样打开git bash生成、上传</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><hr><p>至此，我们就成功搭建好基本的博客了，剩下的就是对博客的一些优化和美化了。</p><p>推荐主题：<a href="https://butterfly.js.org/posts/21cfbf15/">Butterfly</a>，<a href="http://docs.anheyu.com/">anzhiyu</a></p><h2 id="相关问题解决"><a href="#相关问题解决" class="headerlink" title="相关问题解决"></a>相关问题解决</h2><h3 id="网络问题"><a href="#网络问题" class="headerlink" title="网络问题"></a>网络问题</h3><p>这个错误 <code>fatal: unable to access &#39;https://github.com/mingea/mingea.github.io.git/&#39;: OpenSSL SSL_read: Connection was reset, errno 10054</code> 是一个典型的 <strong>网络连接问题</strong>，通常是 GitHub 连接被重置导致的。</p><p><strong>步骤：</strong></p><ol><li><p><strong>生成 SSH 密钥</strong>（如果你还没有）：</p><p>bash</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;</span><br></pre></td></tr></table></figure><p>直接按回车使用默认路径和空密码。</p></li><li><p><strong>将公钥添加到 GitHub</strong>：</p><ul><li>复制公钥内容：<code>cat ~/.ssh/id_rsa.pub</code></li><li>登录 GitHub → Settings → SSH and GPG keys → New SSH key</li><li>粘贴公钥内容</li></ul></li><li><p><strong>修改部署配置</strong>：<br>将 <code>_config.yml</code> 中的 repository地址改为 SSH 格式：</p><p>yaml</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: git@github.com:mingea/mingea.github.io.git</span><br><span class="line">  branch: main</span><br></pre></td></tr></table></figure></li><li><p><strong>测试 SSH 连接</strong>：</p><p>bash</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p>如果显示 “You’ve successfully authenticated”，说明配置成功。</p></li><li><p><strong>重新部署</strong>：</p><p>bash</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx hexo clean &amp;&amp; npx hexo g &amp;&amp; npx hexo d</span><br></pre></td></tr></table></figure></li></ol><h3 id="图片加载问题"><a href="#图片加载问题" class="headerlink" title="图片加载问题"></a>图片加载问题</h3><ul><li>进入你博客的根目录，然后下面顺序找到<code>index.js</code>:<br><code>node_modules</code> –&gt; <code>hexo-asset-image</code> –&gt; <code>index.js</code></li><li>用<a href="https://zhida.zhihu.com/search?content_id=208599834&content_type=Article&match_order=1&q=VS+Code&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NTk2MzAxMDIsInEiOiJWUyBDb2RlIiwiemhpZGFfc291cmNlIjoiZW50aXR5IiwiY29udGVudF9pZCI6MjA4NTk5ODM0LCJjb250ZW50X3R5cGUiOiJBcnRpY2xlIiwibWF0Y2hfb3JkZXIiOjEsInpkX3Rva2VuIjpudWxsfQ.qFI2a32pQBViRBwWoK2sPR_ButdW9O7vrFdS459m-GM&zhida_source=entity">VS Code</a> 或者 记事本打开 <code>index.js</code></li><li>在第 58 行，可以找到这么一行代码：</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&#x27;src&#x27;</span>, config.<span class="property">root</span> + link + src);</span><br></pre></td></tr></table></figure><ul><li>把这一行代码改成下面这样</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&#x27;src&#x27;</span>, src);</span><br></pre></td></tr></table></figure><ul><li>保存文件</li></ul><h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><ul><li>进入博客的根目录</li><li><code>node_modules</code> –&gt; <code>hexo-asset-image</code> –&gt; 打开 <code>README.md</code>, 里面写了用法。我截了个图：</li></ul><p><img src="https://pic3.zhimg.com/v2-743a77f20e7c4ed5e7dcf3aec2383672_1440w.png" alt="img"></p><p>Usage of hexo-asset-image</p><p><strong>注意</strong></p><ul><li>要先把 <code>_config.yml</code>中的 <code>post_asset_folder: false</code> 改成 <code>post_asset_folder: true</code> (默认是false，如果你没有修改过，那请去修改)</li><li>圆括号里面只要写 图片名.后缀 就可以了，不要多加任何的东西。</li></ul><p>最后，<code>hexo clean</code> <code>hexo g</code> <code>hexo s</code> 三部曲，然后进入浏览器打开<code>localhost:4000</code> 就可以看到你想要的图片.</p>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 标签1 </tag>
            
            <tag> 标签2 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
